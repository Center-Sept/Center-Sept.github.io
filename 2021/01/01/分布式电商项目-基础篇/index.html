<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="这是一个有成分的博客">
    <meta name="author" content="center-sept">
    
    <title>
        
            分布式电商项目-基础篇 |
        
        闲淤唠话
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/favicon.svg">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/css/font-awesome.min.css">
    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"blogs.center-sept.top","root":"/","language":"zh-CN","path":"search.xml"};
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":true,"init_open":true},"style":{"primary_color":"#0066CC","avatar":"/images/avatar.svg","favicon":"/images/favicon.svg","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":true,"scale":true},"first_screen":{"enable":true,"background_img":"/images/bg.svg","description":"这是一个有成分的博客。","header_transparent":true,"hitokoto":true},"scroll":{"progress_bar":{"enable":true},"percent":{"enable":true}}},"local_search":{"enable":true,"preload":true},"code_copy":{"enable":false,"style":"default"},"pjax":{"enable":true},"lazyload":{"enable":true},"version":"3.4.5"};
    KEEP.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"};
  </script>
<meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="闲淤" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fas fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                闲淤唠话
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                首页
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                归档
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/about"
                            >
                                关于
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">首页</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">归档</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/about">关于</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">分布式电商项目-基础篇</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/avatar.svg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">center-sept</span>
                        
                            <span class="author-label">Lv1</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;
        <span class="pc">2021-01-01 00:00:00</span>
        <span class="mobile">2021-01-01 00:00</span>
    </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/SpringCloud-docker-vue/">SpringCloud docker vue</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fas fa-file-word"></i>&nbsp;<span>37.1k 字</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fas fa-clock"></i>&nbsp;<span>198 分钟</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <h2 id="docker环境搭建"><a href="#docker环境搭建" class="headerlink" title="docker环境搭建"></a>docker环境搭建</h2><p>todo</p>
<h3 id="docker-通用命令集"><a href="#docker-通用命令集" class="headerlink" title="docker 通用命令集"></a>docker 通用命令集</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看容器进程</span></span><br><span class="line">docker ps -a </span><br><span class="line">docker ps</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">启动容器</span></span><br><span class="line">docker start $容器id</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">停止容器</span></span><br><span class="line">docker stop $容器id</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">停止所有的容器</span></span><br><span class="line">docker stop $(docker ps -a -q)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">删除容器</span></span><br><span class="line">docker rm -f $容器id</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">删除所有的容器（只删除单个时把后面的变量改为image <span class="built_in">id</span>即可）</span></span><br><span class="line">docker rm $(docker ps -a -q)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">删除指定<span class="built_in">id</span>的镜像</span></span><br><span class="line">docker rmi &lt;image id&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">想要删除untagged images，也就是那些<span class="built_in">id</span>为的image的话可以用</span></span><br><span class="line"></span><br><span class="line">docker rmi $(docker images | grep &quot;^&quot; | awk &quot;&#123;print $3&#125;&quot;)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">设置创建好的容器 开机自动启动</span></span><br><span class="line">docker update $容器id --restart=always</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">讲自己配置好的容器重新生成自己的镜像 上传到Docker Hub 上</span></span><br><span class="line">docker commit $容器id centersept0915/test:redistest</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">登录docker hub 账号</span></span><br><span class="line">docker login</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">你的用户名</span></span><br><span class="line">Username: centersept0915</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">你的密码</span></span><br><span class="line">Password: </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">讲生成好的镜像上传到hub 上</span></span><br><span class="line">docker push centersept0915/test:redistest</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">拉取镜像</span></span><br><span class="line">docker　pull  centersept0915/test:redistest</span><br></pre></td></tr></table></figure>



<h3 id="docker-安装-mysql"><a href="#docker-安装-mysql" class="headerlink" title="docker 安装 mysql"></a>docker 安装 mysql</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 3306:3306 --name mysql  -v /mydata/mysql/log:/var/log/mysql  -v /mydata/mysql/data:/var/lib/mysql  -v /mydata/mysql/conf:/etc/mysql  -e MYSQL_ROOT_PASSWORD=root  -d mysql:5.7</span><br></pre></td></tr></table></figure>

<p>命令解释：todo</p>
<p>使用mysql客户端工具连接服务器 </p>
<p>账户名：root 密码: root </p>
<h3 id="docker-安装以及操作-redis"><a href="#docker-安装以及操作-redis" class="headerlink" title="docker 安装以及操作 redis"></a>docker 安装以及操作 redis</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建redis 容器</span></span><br><span class="line">docker run -p 6379:6379 --name redis -v /mydata/redis/data:/data -v /mydata/redis/conf/redis.conf:/etc/redis/redis.conf -d redis redis-server /etc/redis/redis.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">运行redis 客户端</span></span><br><span class="line">docker exec -it redis redis-cli</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以下载redis的客户端（redis desktop manageer）</p>
<p>[redis desktop manageer]: <a class="link"   target="_blank" rel="noopener" href="https://redisdesktop.com/" >https://redisdesktop.com/<i class="fas fa-external-link-alt"></i></a>	“redis 桌面管理器”</p>
<p>进行界面操作</p>
<h2 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h2><p>重新编辑 maven 的 setting.xml ，添加一下配置到文件中 </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#配置阿里云镜像</span><br><span class="line"><span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-aliyun<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirror0f</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirror0f</span>&gt;</span>mirror0f&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>Nexus aliyun<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">utl</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">配置jdk1.8编译项目</span><br><span class="line"><span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">id</span>&gt;</span>jdk-1.8<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">jdl</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">jdk</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1 8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">maven.compiler.compilerVersion</span>&gt;</span> 1.8<span class="tag">&lt;/<span class="name">maven.compiler.compilerVersion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="IDEA-amp-VSCode"><a href="#IDEA-amp-VSCode" class="headerlink" title="IDEA &amp; VSCode"></a>IDEA &amp; VSCode</h2><h3 id="idea-配置-（后端开发工具）"><a href="#idea-配置-（后端开发工具）" class="headerlink" title="idea 配置 （后端开发工具）"></a>idea 配置 （后端开发工具）</h3><p>1.安装lombok插件 </p>
<p>快速生成类的构造函数，get&#x2F;set 方法等</p>
<p>2.安装mybatisx插件 </p>
<p>快速定位mapper 文件</p>
<h3 id="VSCode-配置-（前端开发工具）"><a href="#VSCode-配置-（前端开发工具）" class="headerlink" title="VSCode 配置 （前端开发工具）"></a>VSCode 配置 （前端开发工具）</h3><h4 id="安装插件"><a href="#安装插件" class="headerlink" title="安装插件"></a>安装插件</h4><p>1.Auto Close Tag </p>
<p>自动添加HTML&#x2F;XML关闭标签</p>
<p>2.Auto Rename Tag </p>
<p>自动重命名成对的HTML&#x2F;XML标签</p>
<p>3.Chinese (Simplified) Language Pack for Visual Studio Code插件 </p>
<p>汉化插件</p>
<p>4.ESLint </p>
<p>检查ES 语法</p>
<p>5.HTML CSS Support</p>
<p>6.HTML Snippets</p>
<p>7.JavaScript (ES6) code snippets</p>
<p>ES 语法提示</p>
<p>8.Live Server</p>
<p>启动一个开发本地服务器与动态页面动态重新加载功能</p>
<p>9.open in browser</p>
<p>这允许您在默认浏览器或应用程序中打开当前文件。</p>
<p>10.Vetur</p>
<p>Vue 语法支持 ，Vue 工具</p>
<h2 id="配置git-ssh"><a href="#配置git-ssh" class="headerlink" title="配置git-ssh"></a>配置git-ssh</h2><p>1.在电脑上安装git</p>
<p>todo</p>
<p>2.配置git的基本用户信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">全局配置git的用户名</span></span><br><span class="line">git config --global user.name &quot;your name&quot;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">全局配置git的邮箱</span></span><br><span class="line">git config --global user.email &quot;your email&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3.配置ssh免登录</p>
<p>在控制台生成个人 ssh 私钥和公钥</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">生成私钥和公钥 连续三次回车确定</span></span><br><span class="line">ssh-keygen -t rsa -C &quot;your email&quot; </span><br></pre></td></tr></table></figure>

<p>执行完成之后，目录下会生成 id_rsa （私钥）和 id_rsa.pub（公钥）两个文件。</p>
<p>然后登录gitee(码云) 或者 github ，在设置中找到SSH KEY配置，将 id_rsa.pub 里的内容复制粘贴到里面去。</p>
<p>最后 使用 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">码云测试是否添加成功</span></span><br><span class="line">ssh-T git@gitee.com </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">github测试是否添加成功</span></span><br><span class="line">ssh-T git@github.com </span><br></pre></td></tr></table></figure>

<h2 id="idea-搭建-后端服务项目环境"><a href="#idea-搭建-后端服务项目环境" class="headerlink" title="idea 搭建 后端服务项目环境"></a>idea 搭建 后端服务项目环境</h2><h3 id="导入码云上的项目"><a href="#导入码云上的项目" class="headerlink" title="导入码云上的项目"></a>导入码云上的项目</h3><p>复制仓库url，在idea新建选择 new &gt; Project from Version Control .. &gt; git 粘贴在URL 中，选择相应的工作目录。</p>
<p>如果没有配置gitee账号，需要自行登录。</p>
<h3 id="在项目上新建相应的微服务项目"><a href="#在项目上新建相应的微服务项目" class="headerlink" title="在项目上新建相应的微服务项目"></a>在项目上新建相应的微服务项目</h3><ol>
<li>商品服务（product）</li>
<li>仓储服务（ware）</li>
<li>订单服务（order）</li>
<li>优惠卷服务（coupon）</li>
<li>用户服务（member）</li>
</ol>
<h4 id="创建微服务模块"><a href="#创建微服务模块" class="headerlink" title="创建微服务模块"></a>创建微服务模块</h4><p>1.右键主项目 &gt; New &gt; Module.. &gt; Spring initializr  输入相关信息</p>
<p>2.每个服务统一包名和模块名称</p>
<p>com.组织名称.项目名称.模块名称….</p>
<p>3.选择微服务必要的maven 依赖</p>
<p>Spring  Web</p>
<p>Spring  Web  Service </p>
<p>OpenFeign 用于微服务之间的互相调用</p>
<p>4.创建完成微服务模块，在父目录下 新建一个 pom 文件，内容如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.centersept.supermall<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>super-mall<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>super-mall<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>baba-project<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>super-mall-coupon<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>super-mall-member<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>super-mall-order<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>super-mall-product<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>super-mall-ware<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>把编辑好的父Pom 文件，添加到 Idea maven 插件 管理中，方便打包部署。</p>
<h4 id="编辑-gitignore"><a href="#编辑-gitignore" class="headerlink" title="编辑.gitignore"></a>编辑.gitignore</h4><p>编辑这个文件可以 忽略提交这些文件，在这个文件中追加如下内容：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">**/mvnw</span><br><span class="line">**/mvnw.cmd</span><br><span class="line">**/.mvn</span><br><span class="line">**/target/</span><br><span class="line">.idea</span><br><span class="line">**/.gitignore</span><br></pre></td></tr></table></figure>

<p>最后提交代码到码云，安装码云插件（gitee）。</p>
<h3 id="数据库-搭建配置"><a href="#数据库-搭建配置" class="headerlink" title="数据库 搭建配置"></a>数据库 搭建配置</h3><p>1.安装 Power Designer 建模软件</p>
<p>[]: <a class="link"   target="_blank" rel="noopener" href="http://forspeed.rbread01.cn/down/powerdesigner1029.zip" >http://forspeed.rbread01.cn/down/powerdesigner1029.zip<i class="fas fa-external-link-alt"></i></a></p>
<p>注：表不做外键关联，因为数据量太大，外键会浪费数据库的性能。</p>
<p>2.根据业务进行数据建模，然后生成相应的 sql 语句</p>
<p>3.点击菜单栏 Database &gt; generate Database &gt; Preview , 查看生成的 sql 语句</p>
<p>4.每个服务模块建立一个数据库，然后分别执行相应的业务sql，创建表结构。</p>
<h3 id="搭建后台管理系统"><a href="#搭建后台管理系统" class="headerlink" title="搭建后台管理系统"></a>搭建后台管理系统</h3><h4 id="人人开源项目"><a href="#人人开源项目" class="headerlink" title="人人开源项目"></a>人人开源项目</h4><p><strong>注：在 git 搜索人人开源，使用别人的构建好的脚手架，进行快速开发</strong></p>
<p>renren-fast 和 renren-fast-vue 能快速构建，后台管理系统。</p>
<p>renren-generator 快速生成代码层</p>
<h4 id="引入后台项目中"><a href="#引入后台项目中" class="headerlink" title="引入后台项目中"></a>引入后台项目中</h4><p>1.打开git bash ,执行，克隆项目到文件夹中</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://gitee.com/renrenio/renren-fast.git </span><br><span class="line"></span><br><span class="line">git <span class="built_in">clone</span> https://gitee.com/renrenio/renren-fast-vue.git</span><br></pre></td></tr></table></figure>

<p>2.删除克隆的项目中的 .git 文件夹，然后 renren-fast 复制整个文件夹到你的项目中，然后更改 父Pom 加上 该模块，更改后的配置为：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.centersept.supermall<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>super-mall<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span>super-mall<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">description</span>&gt;</span>baba-project<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">module</span>&gt;</span>super-mall-coupon<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">module</span>&gt;</span>super-mall-member<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">module</span>&gt;</span>super-mall-order<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">module</span>&gt;</span>super-mall-product<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">module</span>&gt;</span>renren-fast<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">module</span>&gt;</span><span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>3.创建相应的数据库和表，执行项目中db文件夹下的sql文件（根据数据库选择相应的语句），执行完成之后，可以更改项目配置文件夹中关于db数据源的配置，然后启动项目。</p>
<h4 id="构建前端项目"><a href="#构建前端项目" class="headerlink" title="构建前端项目"></a>构建前端项目</h4><p>1.安装 Node.js</p>
<p>todo</p>
<p>2.配置好node，打开前端项目下的终端，执行 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装包文件依赖</span></span><br><span class="line">npm install </span><br><span class="line"><span class="comment"># 启动前端项目</span></span><br><span class="line">npm run dev</span><br></pre></td></tr></table></figure>

<p>2.1 安装中出现了错误</p>
<p>1.node-gyp  这个包需要安装 python 作为依赖 所以我们需要安装python，在管理员powershell 中执行以下语句：</p>
<p>Error: Can’t find Python executable “python”, you can set the PYTHON env variable.</p>
<p>方法一：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装windows-build-tools</span></span><br><span class="line">npm install --global --production windows-build-tools</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装node-gyp</span></span><br><span class="line">npm install --global node-gyp</span><br></pre></td></tr></table></figure>

<p>方法二：</p>
<p>使用管理员运行VSCode 再执行 npm install 命令</p>
<h5 id="注：node-sass-安装报错"><a href="#注：node-sass-安装报错" class="headerlink" title="注：node-sass 安装报错"></a>注：node-sass 安装报错</h5><p>node-sass是一个项目依赖，在一个项目中在使用sass语法的时候，必须通过sass-loader来解析sass，从而使sass语法变成浏览器能够识别的CSS语法，而node-sass模块就是对sass-loader的支持模块，所以不安装node-sass，sass-loader就不能正常工作</p>
<p><strong>要考虑到 node-sass 和 node.js 的版本兼容性</strong></p>
<p>参考：<a class="link"   target="_blank" rel="noopener" href="https://www.npmjs.com/package/node-sass" >https://www.npmjs.com/package/node-sass<i class="fas fa-external-link-alt"></i></a></p>
<p>3.成功之后，浏览器打开 localhost:8001，账号：admin 密码：admin 登录.（没验证码，一定是没有启动后端服务） </p>
<h3 id="逆向工程搭建-amp-使用"><a href="#逆向工程搭建-amp-使用" class="headerlink" title="逆向工程搭建&amp;使用"></a>逆向工程搭建&amp;使用</h3><p>1.克隆项目下来</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://gitee.com/renrenio/renren-generator.git</span><br></pre></td></tr></table></figure>

<p>2.删除.git 配置 ，然后把文件复制到后台工程目录下，修改pom 文件，引入该项目。</p>
<p>3.修改逆向工程的application.yml 配置文件的数据源配置，修改为自己的</p>
<p>4.修改generator.properties 生成代码的基本配置，主要修改以下配置</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mainPath</span>=<span class="string">com.centersept.supermall</span></span><br><span class="line"><span class="comment">#包名</span></span><br><span class="line"><span class="attr">package</span>=<span class="string">com.centersept.supermall</span></span><br><span class="line"><span class="comment">#需要生成的模块</span></span><br><span class="line"><span class="attr">moduleName</span>=<span class="string">product</span></span><br><span class="line"><span class="comment">#作者</span></span><br><span class="line"><span class="attr">author</span>=<span class="string">center_sept</span></span><br><span class="line"><span class="comment">#Email</span></span><br><span class="line"><span class="attr">email</span>=<span class="string">253079439@qq.com</span></span><br><span class="line"><span class="comment">#表前缀（类名不会包含表前缀）</span></span><br><span class="line"><span class="attr">tablePrefix</span>=<span class="string">pms_</span></span><br></pre></td></tr></table></figure>

<p>5.直接启动逆向工程，使用浏览器直接输入localhost 访问自动生成代码系统。</p>
<p>5.1 进入菜单 renren-fast , 选择全部的表，点击生成代码来生成代码。</p>
<p>5.2 解压生成的文件，把解压的main文件夹，复制到你生成的模块下。</p>
<p>6.导入代码之后，存在报错，还需要生成一个公共的模块，把公共代码导入进去，其他服务依赖这个公共模块。</p>
<p>6.1 每个模块加入一下依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.centersept.supermall<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>super-mall-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>7.从renren-fast 模块，把utils 和 xss 里的类copy 到 common 模块</p>
<p>7.1 修改pom 的依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    mybatis-plus--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--    lombok  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpcore<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-lang<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;dependency&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;groupId&gt;org.apache.tomcat.embed&lt;/groupId&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;artifactId&gt;tomcat-embed-core&lt;/artifactId&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;version&gt;9.0.36&lt;/version&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;/dependency&gt;--&gt;</span></span><br></pre></td></tr></table></figure>

<p>8.修改逆向工程中的controller模板 Controller.java.vm, 注释掉shiro的注解</p>
<p>9.最后再次生成代码，复制粘贴到项目中。</p>
<h3 id="配置-amp-测试模块的CRUD"><a href="#配置-amp-测试模块的CRUD" class="headerlink" title="配置&amp;测试模块的CRUD"></a>配置&amp;测试模块的CRUD</h3><h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><p>1.配置数据源</p>
<p>1.1 common pom的依赖添加，导入数据库的驱动</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!--        mysql 驱动--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            一般tomcat 里自带的jar包 所以设置为provided 如果存在不需要引入--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>1.2  生成application.yml 配置文件，将数据源配置进去</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.72.130:3306/supermall_pms</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br></pre></td></tr></table></figure>

<p>2.配置mybatis-plus</p>
<p>2.1 配置mybatisPlus ,在启动类加入注解，扫描mapper 接口，生成代理类，注入到spring 容器中，让spring 进行管理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@MapperScan(&quot;com.centersept.supermall.product.dao&quot;)</span><br></pre></td></tr></table></figure>

<p>2.2 在配置文件追加一下内容</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="comment">#mapper 的路径 ，classpath* 全路径扫描，即java的类路径下；classpath 即 resource 路径下</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:/mapper/**/*.xml</span></span><br><span class="line">  <span class="comment">#配置主键使用规则</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="comment">#主键自增</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span></span><br></pre></td></tr></table></figure>

<h4 id="测试是否能crud"><a href="#测试是否能crud" class="headerlink" title="测试是否能crud"></a>测试是否能crud</h4><p>在 test 文件夹下的测试类，添加以下内容测试。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">   BrandService brandService;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="type">BrandEntity</span> <span class="variable">brandEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BrandEntity</span>();</span><br><span class="line">       brandEntity.setDescript(<span class="string">&quot;测试&quot;</span>);</span><br><span class="line">       brandEntity.setName(<span class="string">&quot;测试&quot;</span>);</span><br><span class="line">       <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> brandService.save(brandEntity);</span><br><span class="line">       System.out.println(b);</span><br><span class="line">       brandEntity.setBrandId(<span class="number">1L</span>);</span><br><span class="line">       brandEntity.setDescript(<span class="string">&quot;修改测试&quot;</span>);</span><br><span class="line">       b = brandService.updateById(brandEntity);</span><br><span class="line">       System.out.println(b);</span><br><span class="line">        List&lt;BrandEntity&gt; queryListDto = brandService.list(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;BrandEntity&gt;().eq(<span class="string">&quot;brand_id&quot;</span>,<span class="number">1L</span>));</span><br><span class="line">       System.out.println(queryListDto.toString());</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="逆向工程生成全部模块的业务代码"><a href="#逆向工程生成全部模块的业务代码" class="headerlink" title="逆向工程生成全部模块的业务代码"></a>逆向工程生成全部模块的业务代码</h3><p>1.每个模块的pom 都加上common 模块的依赖</p>
<p>2.配置每个模块的数据库Url 为对应的库</p>
<p>3.每个模块的端口号都修改，从8000开始，+1000 递增，方便每个模块生成多个服务，直接在后面加1。</p>
<p>即 订单模块定义8000 开始，再加一个订单服务则对用端口为8001。仓储模块则使用9000。</p>
<h2 id="分布式组件"><a href="#分布式组件" class="headerlink" title="分布式组件"></a>分布式组件</h2><h3 id="Spring-cloud-netflix"><a href="#Spring-cloud-netflix" class="headerlink" title="Spring-cloud-netflix"></a>Spring-cloud-netflix</h3><p>todo</p>
<h3 id="Spring-cloud-alibaba-分布式框架解决方案"><a href="#Spring-cloud-alibaba-分布式框架解决方案" class="headerlink" title="Spring-cloud-alibaba 分布式框架解决方案"></a>Spring-cloud-alibaba 分布式框架解决方案</h3><p>SpringCloud Alibaba-Nacos: 注册中心(服务发现&#x2F;注册 )<br>SpringCloud Alibaba-Nacos配置中心(动态配置管理)<br>SpringCloud- Ribbon:负载均衡<br>SpringCloud- Feign:声明式HTTP客户端(调用远程服务)<br>SpringCloud Alibaba-Sentinel:服务容错(限流、降级、熔断)<br>SpringCloud- Gateway: API 网关(webflux 编程模式)<br>SpringCloud- Sleuth:调用链监控<br>SpringCloud Alibaba-Seata:原Fescar, 即分布式事务解决方案</p>
<h3 id="引入分布式框架Spring-cloud-alibaba"><a href="#引入分布式框架Spring-cloud-alibaba" class="headerlink" title="引入分布式框架Spring-cloud-alibaba"></a>引入分布式框架Spring-cloud-alibaba</h3><p>在公共模块common 的pom 加入 一下配置：</p>
<p><strong>注：框架的版本和spring-boot的版本要同步</strong>，具体参考官方文档。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="Nacos-注册中心"><a href="#Nacos-注册中心" class="headerlink" title="Nacos 注册中心"></a>Nacos 注册中心</h4><p>1.首先，修改 pom.xml 文件，引入在公共common模块引入 Nacos Discovery Starter。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="2-Nacos-server-配置"><a href="#2-Nacos-server-配置" class="headerlink" title="2.Nacos server 配置"></a>2.Nacos server 配置</h5><p><strong>注：window下操作</strong></p>
<p>2.1 <a class="link"   target="_blank" rel="noopener" href="https://github.com/alibaba/nacos/releases" >https://github.com/alibaba/nacos/releases<i class="fas fa-external-link-alt"></i></a>  下载 Nacos server , 我下载的是这个版本 </p>
<p>2.2 下载完成后，解压，startup.cmd 启动</p>
<p>2.2.1 出现启动不了，窗口一闪的情况。</p>
<p>解决：你的jdk环境变量没有配置好，必须把jdk环境置顶，也就是上移，让系统优先选择。</p>
<p>最后，在微服务业务模块中加入以下配置</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.cloud.nacos.discovery.server-addr</span>=<span class="string">127.0.0.1:8848</span></span><br></pre></td></tr></table></figure>

<p>3.使用 @EnableDiscoveryClient 注解开启服务注册与发现功能，启动项目</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"> <span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProviderApplication</span> &#123;</span><br><span class="line"></span><br><span class="line"> 	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"> 		SpringApplication.run(Application.class, args);</span><br><span class="line"> 	&#125;</span><br><span class="line"></span><br><span class="line"> 	<span class="meta">@RestController</span></span><br><span class="line"> 	<span class="keyword">class</span> <span class="title class_">EchoController</span> &#123;</span><br><span class="line"> 		<span class="meta">@GetMapping(value = &quot;/echo/&#123;string&#125;&quot;)</span></span><br><span class="line"> 		<span class="keyword">public</span> String <span class="title function_">echo</span><span class="params">(<span class="meta">@PathVariable</span> String string)</span> &#123;</span><br><span class="line"> 				<span class="keyword">return</span> string;</span><br><span class="line"> 		&#125;</span><br><span class="line"> 	&#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>4.使用浏览器登录 <a class="link"   target="_blank" rel="noopener" href="http://localhost:8848/nacos/" >http://localhost:8848/nacos/<i class="fas fa-external-link-alt"></i></a> ，账号密码 nacos ,但是并没有我们注册的服务。</p>
<p>那是因为微服务模块配置文件没有配置apllication.name 这个属性，加入之后就可以发现了。</p>
<p>4.1 修改配置文件之后出现</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.boot.context.properties.ConfigurationPropertiesBean</span><br></pre></td></tr></table></figure>

<p>因为 springboot版本和springcloud版本不兼容，换一个版本试试。换成Greenwich.SR3 版本的。</p>
<h5 id="Nacos服务中心-部署到-docker"><a href="#Nacos服务中心-部署到-docker" class="headerlink" title="Nacos服务中心 部署到 docker"></a>Nacos服务中心 部署到 docker</h5><p>1.获取镜像</p>
<p>todo</p>
<h4 id="OpenFeigh-测试远程调用"><a href="#OpenFeigh-测试远程调用" class="headerlink" title="OpenFeigh 测试远程调用"></a>OpenFeigh 测试远程调用</h4><h5 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h5><p>todo</p>
<h5 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h5><p>1.引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2.项目接入feigh</p>
<p>2.1在优惠券服务取一个controller类文件，定义一个数据返回List</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/member/list&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> R <span class="title function_">membercoupons</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="type">CouponEntity</span> <span class="variable">couponEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CouponEntity</span>();</span><br><span class="line">       couponEntity.setCouponName(<span class="string">&quot;测试优惠券&quot;</span>);</span><br><span class="line">       <span class="keyword">return</span> R.ok().put(<span class="string">&quot;coupons&quot;</span>,Arrays.asList(couponEntity));</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>2.2 在会员模块下创建feigh包，这个文件夹用于声明feigh接口。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;supermall-coupon&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CouponFeighService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/coupon/coupon/member/list&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">membercoupons</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.3 在会员服务的启动类中加入注解，开启远程调用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@EnableFeignClients(basePackages = &quot;com.centersept.supermall.member.feigh&quot;)</span><br></pre></td></tr></table></figure>

<p>也可以在可以在接口上加入@Component 注解，交给spring 注入。</p>
<p>2.4 在会员模块下的MemberController类中加入一下内容，远程调用优惠券服务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">    CouponFeighService couponFeignService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/coupons&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">MemberEntity</span> <span class="variable">memberEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MemberEntity</span>();</span><br><span class="line">        memberEntity.setNickname(<span class="string">&quot;大帅逼&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">R</span> <span class="variable">membercoupons</span> <span class="operator">=</span> couponFeignService.membercoupons();</span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;member&quot;</span>,memberEntity).put(<span class="string">&quot;coupons&quot;</span>,membercoupons.get(<span class="string">&quot;coupons&quot;</span>));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>2.5 浏览器输入<a class="link"   target="_blank" rel="noopener" href="http://localhost:9000/member/member/coupons%EF%BC%8C%E6%B5%8B%E8%AF%95%E6%98%AF%E5%90%A6%E8%BF%9E%E9%80%9A%E3%80%82" >http://localhost:9000/member/member/coupons，测试是否连通。<i class="fas fa-external-link-alt"></i></a></p>
<h4 id="Nacos-配置中心"><a href="#Nacos-配置中心" class="headerlink" title="Nacos 配置中心"></a>Nacos 配置中心</h4><h5 id="简单配置实例"><a href="#简单配置实例" class="headerlink" title="简单配置实例"></a>简单配置实例</h5><p>1.在common 模块引入nacos 配置中心的依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2.在应用的&#x2F;src&#x2F;main&#x2F;resources&#x2F;bootstrap.properties 配置文件中配置Nacos Config 元数据，现在 coupon 模块创建</p>
<p>3.在controller层 创建一个测试的用户代码，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value(&quot;$&#123;user.testname&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String testUserName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;user.age&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer testAge;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;testUserName&quot;</span>,testUserName).put(<span class="string">&quot;testAge&quot;</span>,testAge);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>注：user.name   spring 会自动去读取计算机的名字</strong></p>
<p>4.在 application.properties 中配置相应的属性，如下</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">user.testname</span>=<span class="string">超人</span></span><br><span class="line"><span class="attr">user.age</span>=<span class="string">25</span></span><br></pre></td></tr></table></figure>

<p>5.为了不让我们重新打包重启，则在配置中心加上配置。启动的如下日志已经提醒，从 nacos 配置中心获取配置信息的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2020-07-16 21:00:46.045  INFO 14188 --- [           main] b.c.PropertySourceBootstrapConfiguration : Located property source: CompositePropertySource &#123;name=&#x27;NACOS&#x27;, propertySources=[NacosPropertySource &#123;name=&#x27;supermall-coupon.properties&#x27;&#125;]&#125;</span><br></pre></td></tr></table></figure>

<p>我们需要在 Nacos 配置中心配置相应的配置文件</p>
<p>6.打开Nacos 管理界面，点击配置列表，然后新建一个 DataId 为 supermall-coupon.properties 的命名，再然后把配置的内容写到配置内容栏里面，发布。</p>
<p>7.这个时候还没有结束，还需要在配置属性的类里面，加上@RefreshScope 注解，才能达到热更新的效果。</p>
<p>8.因为配置中心是bootstrap.properties 中配置加载的，所以相同的配置项，优先加载Nacos 配置中心的配置。</p>
<h5 id="命名空间与配置分组"><a href="#命名空间与配置分组" class="headerlink" title="命名空间与配置分组"></a>命名空间与配置分组</h5><p>1.命名空间</p>
<p>配置隔离   </p>
<p>默认：public </p>
<p>1.开发，测试，生产</p>
<h6 id="配置命名空间"><a href="#配置命名空间" class="headerlink" title="配置命名空间"></a>配置命名空间</h6><p>1.在命名空间中，分别添加开发，测试，生产 的命名空间。</p>
<p>2.打开配置列表，发现页面上已经有我们添加的命名空间。</p>
<p>3.然后我们在新的命名空间中添加我们的配置项。我们可以直接在public 的命名空间中，选择已经配置好的配置，然后克隆到其他命名空间就可以了。</p>
<p>4.如果我们要在不同环境切换配置命名空间，可以在bootstrap.properties 中 增加命名空间配置项</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.cloud.nacos.config.namespace</span>=<span class="string">98af8d57-dd3a-4b68-b1a1-945ee78f1239</span></span><br></pre></td></tr></table></figure>

<p>5.也可以每个微服务创建一个命名空间。</p>
<hr>
<p>2.配置集</p>
<p>所有的配置的集合</p>
<p>3.配置集ID</p>
<p>类似配置文件名</p>
<p>4.配置分组</p>
<p>默认所有的配置集都属于：DEFAULT_GROUP</p>
<p>需要在boostrap.properties 加入以下配置</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#配置分组的命名</span></span><br><span class="line"><span class="attr">spring.cloud.nacos.config.group</span>=<span class="string">test  </span></span><br></pre></td></tr></table></figure>

<p><strong>一般来说一个微服务使用命名空间来隔离，然后使用分组来隔离环境的配置。</strong></p>
<h5 id="加载多配置源"><a href="#加载多配置源" class="headerlink" title="加载多配置源"></a>加载多配置源</h5><p>1.新建一个配置 ，把数据源的配置当道这个配置中来，Data ID 为 datasource.yml ,Group 为 dev, 配置格式为YAML 配置内容为以下内容：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.72.130:3306/supermall_sms</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br></pre></td></tr></table></figure>

<p>2.mybatis 的配置，也可以创建一个出来进行加载,配置如下：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="comment">#mapper 的路径 ，classpath* 全路径扫描，即java的类路径下；classpath 即 resource 路径下</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:/mapper/**/*.xml</span></span><br><span class="line">  <span class="comment">#配置主键使用规则</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="comment">#主键自增</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span></span><br></pre></td></tr></table></figure>

<p>3.新建一个其他的配置，统一进行管理</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">supermall-coupon</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8000</span></span><br></pre></td></tr></table></figure>

<p>4.把这些创建好的配置，配置到项目中，在bootstrap.properties 中加入以下配置</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># datasource</span></span><br><span class="line"><span class="string">spring.cloud.nacos.config.ext-config[0].data-id=datasource.yml</span></span><br><span class="line"><span class="string">spring.cloud.nacos.config.ext-config[0].group=dev</span></span><br><span class="line"><span class="comment">#是否动态刷新</span></span><br><span class="line"><span class="string">spring.cloud.nacos.config.ext-config[0].refresh=true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># mybatis</span></span><br><span class="line"><span class="string">spring.cloud.nacos.config.ext-config[1].data-id=mybatis.yml</span></span><br><span class="line"><span class="string">spring.cloud.nacos.config.ext-config[1].group=dev</span></span><br><span class="line"><span class="comment">#是否动态刷新</span></span><br><span class="line"><span class="string">spring.cloud.nacos.config.ext-config[1].refresh=true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#other</span></span><br><span class="line"><span class="string">spring.cloud.nacos.config.ext-config[2].data-id=other.yml</span></span><br><span class="line"><span class="string">spring.cloud.nacos.config.ext-config[2].group=dev</span></span><br><span class="line"><span class="comment">#是否动态刷新</span></span><br><span class="line"><span class="string">spring.cloud.nacos.config.ext-config[2].refresh=true</span></span><br></pre></td></tr></table></figure>



<h4 id="SpringCloud-Gateway-网关"><a href="#SpringCloud-Gateway-网关" class="headerlink" title="SpringCloud-Gateway 网关"></a>SpringCloud-Gateway 网关</h4><p>网关作为流量的入口，常用功能包括路由转发、权限校验、限流控制等。而springcloud gateway<br>作为SpringCloud官方推出的第二代网关框架，取代了Zuul 网关（网飞）。</p>
<p><strong>主要作用 ：动态路由，鉴权</strong></p>
<p>rps：32213  每秒请求数</p>
<p>组件：Route,Predicate,Filter</p>
<p><strong>注：官方文档中有很多配置实例，可以直接上去查看。</strong></p>
<p>1.创建gatewey 模块，加入网关模块，以及引入common 模块</p>
<p>2.加入nacos 依赖，然后配置nacos的配置，新建bootstrap.properties ,加入以下配置：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.application.name</span>=<span class="string">&lt;你的应用名称&gt;</span></span><br><span class="line"><span class="attr">spring.cloud.nacos.discovery.server-addr</span>=<span class="string">&lt;服务所在ip&gt;:8848</span></span><br><span class="line"><span class="attr">spring.cloud.nacos.config.server-addr</span>=<span class="string">&lt;服务所在ip&gt;:8848</span></span><br></pre></td></tr></table></figure>

<p>3.排除数据库配置,在启动类上加入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@EnableDiscoveryClient</span><br><span class="line">@SpringBootApplication(exclude = &#123;DataSourceAutoConfiguration.class&#125;)</span><br></pre></td></tr></table></figure>

<p>4.测试路由断言</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line"><span class="comment">#        - id: test_route</span></span><br><span class="line"><span class="comment">#          uri: https://www.baidu.com</span></span><br><span class="line"><span class="comment">#          predicates:</span></span><br><span class="line"><span class="comment">#            - Query=url,baidu</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#        - id: qq_route</span></span><br><span class="line"><span class="comment">#          uri: https://www.qq.com</span></span><br><span class="line"><span class="comment">#          predicates:</span></span><br><span class="line"><span class="comment">#            - Query=url,qq</span></span><br><span class="line"></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">product_route</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://supermall-product</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/api/product/**</span></span><br><span class="line">          <span class="attr">filters:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">RewritePath=/api/(?&lt;segment&gt;.*),/$\&#123;segment&#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">admin_route</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://renren-fast</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/api/**</span></span><br><span class="line">          <span class="attr">filters:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">RewritePath=/api/(?&lt;segment&gt;.*),/renren-fast/$\&#123;segment&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="前端基础"><a href="#前端基础" class="headerlink" title="前端基础"></a>前端基础</h2><h3 id="技术栈简介"><a href="#技术栈简介" class="headerlink" title="技术栈简介"></a>技术栈简介</h3><h4 id="ES6-语法"><a href="#ES6-语法" class="headerlink" title="ES6 语法"></a>ES6 语法</h4><p>JavaScript 是它的实现</p>
<h5 id="前端基础-1"><a href="#前端基础-1" class="headerlink" title="前端基础"></a>前端基础</h5><p>1.let 声明变量</p>
<p>var 声明的变量往往会越域<br>let 声明的变量有严格局部作用域</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a - <span class="number">1</span>;</span><br><span class="line"><span class="keyword">let</span> b - <span class="number">2</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a); <span class="number">1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b);1<span class="attr">ReferenceError</span>:b is not defined</span><br></pre></td></tr></table></figure>

<p>var 会存在变量提升<br>let 不存在变量提升</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">console.log(×); /l undefined</span><br><span class="line">var x =10;</span><br><span class="line">console.log(y); //ReferenceError: y is not defined</span><br><span class="line">let y = 20;</span><br></pre></td></tr></table></figure>

<p>2.const 声明常量（只读变量）</p>
<p>声明之后不允许改变</p>
<p>一旦声明必须初始化，否则报错</p>
<p>3.解构表达式</p>
<p>数组解构</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">12</span>,<span class="number">3</span>]</span><br><span class="line"><span class="comment">// let a = arr[0]</span></span><br><span class="line"><span class="comment">// let b = arr[1]</span></span><br><span class="line"><span class="comment">// let c = arr[2]</span></span><br><span class="line"><span class="keyword">let</span> [a,b,c] = arr</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a,b,c)</span><br></pre></td></tr></table></figure>

<p>对象解构</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> person = &#123;</span><br><span class="line"><span class="attr">name</span>: <span class="string">&quot;jack&quot;</span>,</span><br><span class="line"><span class="attr">age</span>: <span class="number">21</span>,</span><br><span class="line"><span class="attr">language</span>: [<span class="string">&quot;java&quot;</span>, <span class="string">&quot;js&quot;</span>, <span class="string">&quot;css&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> name = person.<span class="property">name</span></span><br><span class="line"><span class="keyword">const</span> age = person.<span class="property">age</span></span><br><span class="line"><span class="keyword">const</span> language = person.<span class="property">language</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123;name,age,language&#125; = person</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(name,age,language)</span><br><span class="line"><span class="comment">// 别名解构</span></span><br><span class="line"><span class="keyword">const</span> &#123;name：userName,<span class="attr">age</span>:superAge,language&#125; = person</span><br></pre></td></tr></table></figure>

<p>4.字符串扩展</p>
<p>字符串API</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> str = <span class="string">&quot;hello.wue&quot;</span><span class="string">&quot;;</span></span><br><span class="line"><span class="string">console.log(str.startswith(hello&quot;</span>))<span class="comment">//trui</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(str.<span class="title function_">endswith</span>(<span class="string">&quot;.vue&quot;</span>)<span class="comment">//true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(str.<span class="title function_">includes</span>(<span class="string">&quot;e&quot;</span>));<span class="comment">//true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(str.<span class="title function_">includes</span>(<span class="string">&quot;hello&quot;</span>)<span class="comment">//true</span></span><br></pre></td></tr></table></figure>

<p>字符串模板</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 反引号 `</span><br><span class="line">//1、多行字符串</span><br><span class="line">let ss = `</span><br><span class="line">&lt;div&gt;</span><br><span class="line">&lt;span&gt;hello world&lt;span&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">`</span><br><span class="line">console.log(ss)</span><br></pre></td></tr></table></figure>

<p>字符串插入变量</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2、字符串插入变量和表达式。变量名写在$&#123;&#125;中，$&#123;&#125;中可以放入JavaScript表达式。</span></span><br><span class="line"><span class="keyword">let</span> info = 我是$&#123;abc&#125;，今年$&#123;age+<span class="number">10</span>&#125;了,我想说$&#123;<span class="title function_">fun</span>()&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">logo</span>(info)</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fun</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>5.函数优化</p>
<p>5.1 函数参数默认值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在ES6以前，我们无法给一个函数的设置默认值，只能采用变通写去:</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">a，b</span>)&#123;</span><br><span class="line">/判斯b是否为空，为空就拾认值<span class="number">1</span></span><br><span class="line">b  = b || <span class="number">1</span> ;</span><br><span class="line"><span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 传一个参数</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">add</span>(<span class="number">10</span>));</span><br><span class="line"><span class="comment">// 现在可以这么写：直接给参数写上默认值，没传就会自动使用默认值</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">a，b=<span class="number">1</span></span>)&#123;</span><br><span class="line"><span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>5.2 不定参数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">fun</span>(<span class="params">..values</span>)&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(values.<span class="property">length</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">fun</span>(<span class="number">1</span>，<span class="number">2</span>) <span class="comment">//2</span></span><br><span class="line"><span class="title function_">fun</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>) <span class="comment">//4</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>5.3 箭头函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 原来声明一个函数</span></span><br><span class="line"><span class="keyword">var</span> func = <span class="keyword">function</span> (<span class="params">obj</span>) &#123;</span><br><span class="line"> <span class="variable language_">console</span>.<span class="title function_">log</span>(obj)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 现在</span></span><br><span class="line"><span class="keyword">var</span> <span class="title function_">funcNew</span> = obj =&gt; <span class="variable language_">console</span>.<span class="title function_">log</span>(obj)</span><br><span class="line"><span class="comment">// 原来</span></span><br><span class="line"><span class="keyword">var</span> sum = <span class="keyword">function</span>(<span class="params">a,b</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> a+b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 现在</span></span><br><span class="line"><span class="keyword">var</span> <span class="title function_">sum2</span> = (<span class="params">a,b</span>) =&gt; a+b;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span>  <span class="title function_">hello</span> (person) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hello,&quot;</span>+person.<span class="property">name</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 箭头函数，加解构表达式</span></span><br><span class="line"><span class="keyword">var</span> <span class="title function_">hello2</span> = (<span class="params">&#123;name&#125;</span>) =&gt; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hello,&quot;</span>+person.<span class="property">name</span>)</span><br><span class="line"><span class="title function_">hello2</span>(person)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>6.对象优化</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> person = &#123;</span><br><span class="line"><span class="attr">name</span>: <span class="string">&quot;jack&quot;</span>,</span><br><span class="line"><span class="attr">age</span>: <span class="number">21</span>,</span><br><span class="line"><span class="attr">language</span>: [<span class="string">&quot;java&quot;</span>, <span class="string">&quot;js&quot;</span>, <span class="string">&quot;css&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">keys</span>(person));/[<span class="string">&quot;name&quot;</span>,<span class="string">&quot;age&quot;</span>，<span class="string">&quot;language&quot;</span>l</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">values</span>(person));<span class="number">77</span>[<span class="string">&quot;jack&quot;</span>， <span class="number">21</span>，<span class="title class_">Array</span>(<span class="number">3</span>)]</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">entries</span>(person));<span class="comment">//[Array(2)，Array(2)，Array(2)]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> target = &#123;<span class="attr">a</span>:<span class="number">1</span>&#125;</span><br><span class="line"><span class="keyword">const</span> source1 = &#123;<span class="attr">b</span>:<span class="number">2</span>&#125;</span><br><span class="line"><span class="keyword">const</span> source2 = &#123;<span class="attr">c</span>:<span class="number">3</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//&#123;a:1,b:2,c:3&#125;</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">assign</span>(target,source1,source2)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 声明对象简写</span></span><br><span class="line"><span class="keyword">const</span> age = <span class="number">23</span></span><br><span class="line"><span class="keyword">const</span> name = <span class="string">&quot;张三&quot;</span></span><br><span class="line"><span class="keyword">const</span> person1 =  &#123;<span class="attr">age</span>:age,<span class="attr">name</span>:name&#125;</span><br><span class="line"><span class="comment">// 属性名和变量值一样 直接一下简写</span></span><br><span class="line"><span class="keyword">const</span> person2 = &#123;age,name&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对象函数属性简写</span></span><br><span class="line"><span class="keyword">let</span> person3 = &#123;</span><br><span class="line">    <span class="attr">name</span>:<span class="string">&quot;jack&quot;</span>,</span><br><span class="line">    <span class="attr">eat</span>: <span class="keyword">function</span> (<span class="params">food</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&quot;在吃&quot;</span> + food)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 箭头函数不能用this, 用 对象.属性</span></span><br><span class="line">    <span class="attr">eat</span>: <span class="function"><span class="params">foot</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(person3.<span class="property">name</span> + <span class="string">&quot;在吃&quot;</span> + food),</span><br><span class="line">    eat3 (foot) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span> + <span class="string">&quot;在吃&quot;</span> + food)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对象扩展运算符</span></span><br><span class="line"><span class="comment">// 拷贝对象（深拷贝）</span></span><br><span class="line"><span class="keyword">let</span> p1 = &#123;<span class="attr">name</span>:<span class="string">&quot;tom&quot;</span>,<span class="attr">age</span>:<span class="number">12</span>&#125;</span><br><span class="line"><span class="keyword">let</span> someone = &#123;...person1&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(someone) <span class="comment">// &#123;name:&quot;tom&quot;,age:12&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 合并对象</span></span><br><span class="line"><span class="keyword">let</span> age1 = &#123;<span class="attr">age</span>:<span class="number">12</span>&#125;</span><br><span class="line"><span class="keyword">let</span> name1 = &#123;<span class="attr">name</span>:<span class="string">&quot;tom&quot;</span>&#125;</span><br><span class="line"><span class="keyword">let</span> p2 = &#123;<span class="attr">name1</span>:<span class="string">&quot;am&quot;</span>&#125;</span><br><span class="line"> p2 = &#123;...age1,...name1&#125; </span><br></pre></td></tr></table></figure>



<p>7.map 和 reduce</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//数组中新增了map和reduce 方法</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//map():接收一个函数，将原数组中的所有元素用这个函数处理后放入新数组返回</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> arr = [<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;20&#x27;</span>,<span class="string">&#x27;-3&#x27;</span>,<span class="string">&#x27;222&#x27;</span>]</span><br><span class="line"></span><br><span class="line">arr = arr.<span class="title function_">map</span>(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123;item*<span class="number">2</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// reduce() 为数组中的每个元素一次执行回调函数，不包括数组中被删除或从未被赋值的元素</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// arr.reduce(callback,[initialValue])</span></span><br><span class="line"></span><br><span class="line"><span class="number">1.</span><span class="title function_">previousValue</span>(上一次调用回调返回的值，或者是提供的初始值（initialvalue）</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span><span class="title function_">currentvalue</span>(数组中当前被处理的元素)</span><br><span class="line"><span class="number">3.</span>index（当前元素在数组中的素引)</span><br><span class="line"><span class="number">4.</span>array (调用reduce的数组)</span><br><span class="line"></span><br><span class="line">arr.<span class="title function_">reduce</span>(<span class="function">(<span class="params">a,b</span>)=&gt;</span>&#123;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;上次值&quot;</span>+a)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;当前值&quot;</span>+b)</span><br><span class="line"><span class="keyword">return</span> a+b</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<p>8.Promise (异步编排)</p>
<p>问题：ajax 一步一步的递归调用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.Promise 可以封装异步操作</span></span><br><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="comment">// 1.异步操作</span></span><br><span class="line">	&amp;.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">	<span class="attr">url</span>:<span class="string">&quot;mock/user.json&quot;</span>,</span><br><span class="line">	<span class="attr">success</span>:<span class="keyword">function</span>(<span class="params">data</span>)&#123;</span><br><span class="line">		<span class="title function_">resolve</span>(data)</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">error</span>:<span class="keyword">function</span>(<span class="params">err</span>)&#123;</span><br><span class="line">		<span class="title function_">reject</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="keyword">if</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">		<span class="title function_">resolve</span>(data)</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="title function_">reject</span>(error)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br><span class="line">p.<span class="title function_">then</span>(<span class="function">(<span class="params">obj</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">return</span>	<span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="comment">// 1.异步操作</span></span><br><span class="line">	&amp;.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">	<span class="attr">url</span>:<span class="string">`mock/user_corse_<span class="subst">$&#123;obj.id&#125;</span>.json`</span>,</span><br><span class="line">	<span class="attr">success</span>:<span class="keyword">function</span>(<span class="params">data</span>)&#123;</span><br><span class="line">		<span class="title function_">resolve</span>(data)</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">error</span>:<span class="keyword">function</span>(<span class="params">err</span>)&#123;</span><br><span class="line">		<span class="title function_">reject</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;).<span class="title function_">catch</span>((err)&#123;</span><br><span class="line"></span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>)=&gt;</span>&#123;</span><br><span class="line"><span class="comment">// 1.异步操作</span></span><br><span class="line">	&amp;.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">	<span class="attr">url</span>:<span class="string">`mock/cors_score_<span class="subst">$&#123;data.id&#125;</span>.json`</span>,</span><br><span class="line">	<span class="attr">success</span>:<span class="keyword">function</span>(<span class="params">data</span>)&#123;</span><br><span class="line">		<span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">error</span>:<span class="keyword">function</span>(<span class="params">err</span>)&#123;</span><br><span class="line">		<span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">get</span>(<span class="params">url, data</span>)&#123;	</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Proeise</span>((resolve,reject)-&gt;&#123;</span><br><span class="line">	$.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">		<span class="attr">url</span>: url,</span><br><span class="line">		<span class="attr">data</span>: data,</span><br><span class="line">		<span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">data</span>)&#123;</span><br><span class="line">			<span class="title function_">resolve</span>(data);</span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="attr">error</span>: <span class="keyword">function</span> (<span class="params">err</span>)&#123;</span><br><span class="line">			<span class="title function_">reject</span>(err)</span><br><span class="line">        &#125;)</span><br><span class="line">&#125;); </span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">get</span>(<span class="string">&quot;mock/user.json&quot;</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">get</span>(<span class="string">`mock/user_corse_<span class="subst">$&#123;data.id&#125;</span>.json`</span>)</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">get</span>(<span class="string">`mock/cors_score_<span class="subst">$&#123;data.id&#125;</span>.json`</span>)</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>)=&gt;</span>&#123;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>)=&gt;</span>&#123;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>9.模块化</p>
<p>9.1 什么是模块化</p>
<p>模块化就是把代码进行拆分，方便重复利用。类似java中的导包，要使用一个包，必须先导包。而s中没有包的概念，换来的是模块。<br>模块功能主要由两个命令构成.’export”和”import’.<br>export：命令用于规定模块的对外接口。<br>import：命令用于导入其他模块提供的功能。</p>
<p>9.2  export 导出</p>
<p>给导入另外起名，使用以下格式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  sum (a,b) &#123;</span><br><span class="line">    <span class="keyword">return</span> a+b;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>9.3  import 导入</p>
<h4 id="vue"><a href="#vue" class="headerlink" title="vue"></a>vue</h4><h5 id="MVVM"><a href="#MVVM" class="headerlink" title="MVVM"></a>MVVM</h5><p>todo</p>
<p>官网看引入教程</p>
<h4 id="nodejs"><a href="#nodejs" class="headerlink" title="nodejs"></a>nodejs</h4><h4 id=""><a href="#" class="headerlink" title=""></a></h4><hr>
<h2 id="开始搭建前端模块"><a href="#开始搭建前端模块" class="headerlink" title="开始搭建前端模块"></a>开始搭建前端模块</h2><h3 id="Vue模块化开发"><a href="#Vue模块化开发" class="headerlink" title="Vue模块化开发"></a>Vue模块化开发</h3><h4 id="搭建Vue脚手架"><a href="#搭建Vue脚手架" class="headerlink" title="搭建Vue脚手架"></a>搭建Vue脚手架</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">全局安装webpack</span></span><br><span class="line">npm install webpack -g </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">全局安装Vue的脚手架</span></span><br><span class="line">npm install -g @vue/cli-init</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">新建一个项目工作文件，然后vue脚手架使用webpack模块初始化一个(自己的项目名称)</span></span><br><span class="line">vue init webpack super-mall-vue</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动新建好的vue项目</span></span><br><span class="line">npm run dev</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">打包项目</span></span><br><span class="line">npm run build</span><br></pre></td></tr></table></figure>

<h4 id="创建一个组件"><a href="#创建一个组件" class="headerlink" title="创建一个组件"></a>创建一个组件</h4><p>1.在src&#x2F;components 下创建vue 文件，内容是vue的基本三大属性</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  </span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style lang=&quot;sass&quot; scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>2.在src&#x2F;router 下，编辑index.js，添加一下代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import hello from &#x27;@/components/&#123;你的文件名&#125;&#x27;</span><br><span class="line"></span><br><span class="line">export default new Router(&#123;</span><br><span class="line">  routes: [</span><br><span class="line">    &#123;</span><br><span class="line">      path:&#x27;/&#123;你的文件名&#125;&#x27;,</span><br><span class="line">      name:&#x27;&#123;你的组件命名&#125;&#x27;,</span><br><span class="line">      component:hello</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="引用ElementUI"><a href="#引用ElementUI" class="headerlink" title="引用ElementUI"></a>引用ElementUI</h4><h5 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i element-ui</span><br></pre></td></tr></table></figure>

<h5 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h5><p>在 main.js 中写入以下内容：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ElementUI</span> <span class="keyword">from</span> <span class="string">&#x27;element-ui&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;element-ui/lib/theme-chalk/index.css&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">ElementUI</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">  <span class="attr">render</span>: <span class="function"><span class="params">h</span> =&gt;</span> <span class="title function_">h</span>(<span class="title class_">App</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="使用elementUI-提供的布局以及配置动态路由菜单"><a href="#使用elementUI-提供的布局以及配置动态路由菜单" class="headerlink" title="使用elementUI 提供的布局以及配置动态路由菜单"></a>使用elementUI 提供的布局以及配置动态路由菜单</h3><p>1.替换App.vue 中的内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-container style=&quot;height: 500px; border: 1px solid #eee&quot;&gt;</span><br><span class="line">  &lt;el-aside width=&quot;200px&quot; style=&quot;background-color: rgb(238, 241, 246)&quot;&gt;</span><br><span class="line">    &lt;el-menu :default-openeds=&quot;[&#x27;1&#x27;, &#x27;3&#x27;]&quot; router=&#x27;true&#x27;&gt;</span><br><span class="line">      &lt;el-submenu index=&quot;1&quot;&gt;</span><br><span class="line">        &lt;template slot=&quot;title&quot;&gt;&lt;i class=&quot;el-icon-message&quot;&gt;&lt;/i&gt;导航一&lt;/template&gt;</span><br><span class="line">        &lt;el-menu-item-group&gt;</span><br><span class="line">          &lt;template slot=&quot;title&quot;&gt;分组一&lt;/template&gt;</span><br><span class="line">          &lt;el-menu-item index=&quot;1-1&quot;&gt;选项1&lt;/el-menu-item&gt;</span><br><span class="line">          &lt;el-menu-item index=&quot;1-2&quot;&gt;选项2&lt;/el-menu-item&gt;</span><br><span class="line">        &lt;/el-menu-item-group&gt;</span><br><span class="line">        &lt;el-menu-item-group title=&quot;分组2&quot;&gt;</span><br><span class="line">          &lt;el-menu-item index=&quot;1-3&quot;&gt;选项3&lt;/el-menu-item&gt;</span><br><span class="line">        &lt;/el-menu-item-group&gt;</span><br><span class="line">        &lt;el-submenu index=&quot;1-4&quot;&gt;</span><br><span class="line">          &lt;template slot=&quot;title&quot;&gt;选项4&lt;/template&gt;</span><br><span class="line">          &lt;el-menu-item index=&quot;1-4-1&quot;&gt;选项4-1&lt;/el-menu-item&gt;</span><br><span class="line">        &lt;/el-submenu&gt;</span><br><span class="line">      &lt;/el-submenu&gt;</span><br><span class="line">      &lt;el-submenu index=&quot;2&quot;&gt;</span><br><span class="line">        &lt;template slot=&quot;title&quot;&gt;&lt;i class=&quot;el-icon-menu&quot;&gt;&lt;/i&gt;导航二&lt;/template&gt;</span><br><span class="line">        &lt;el-menu-item-group&gt;</span><br><span class="line">          &lt;template slot=&quot;title&quot;&gt;分组一&lt;/template&gt;</span><br><span class="line">          &lt;el-menu-item index=&quot;2-1&quot;&gt;选项1&lt;/el-menu-item&gt;</span><br><span class="line">          &lt;el-menu-item index=&quot;2-2&quot;&gt;选项2&lt;/el-menu-item&gt;</span><br><span class="line">        &lt;/el-menu-item-group&gt;</span><br><span class="line">        &lt;el-menu-item-group title=&quot;分组2&quot;&gt;</span><br><span class="line">          &lt;el-menu-item index=&quot;2-3&quot;&gt;选项3&lt;/el-menu-item&gt;</span><br><span class="line">        &lt;/el-menu-item-group&gt;</span><br><span class="line">        &lt;el-submenu index=&quot;2-4&quot;&gt;</span><br><span class="line">          &lt;template slot=&quot;title&quot;&gt;选项4&lt;/template&gt;</span><br><span class="line">          &lt;el-menu-item index=&quot;2-4-1&quot;&gt;选项4-1&lt;/el-menu-item&gt;</span><br><span class="line">        &lt;/el-submenu&gt;</span><br><span class="line">      &lt;/el-submenu&gt;</span><br><span class="line">      &lt;el-submenu index=&quot;3&quot;&gt;</span><br><span class="line">        &lt;template slot=&quot;title&quot;&gt;&lt;i class=&quot;el-icon-setting&quot;&gt;&lt;/i&gt;导航三&lt;/template&gt;</span><br><span class="line">        &lt;el-menu-item-group&gt;</span><br><span class="line">          &lt;template slot=&quot;title&quot;&gt;分组一&lt;/template&gt;</span><br><span class="line">          &lt;el-menu-item index=&quot;3-1&quot;&gt;选项1&lt;/el-menu-item&gt;</span><br><span class="line">          &lt;el-menu-item index=&quot;3-2&quot;&gt;选项2&lt;/el-menu-item&gt;</span><br><span class="line">        &lt;/el-menu-item-group&gt;</span><br><span class="line">        &lt;el-menu-item-group title=&quot;分组2&quot;&gt;</span><br><span class="line">          &lt;el-menu-item index=&quot;3-3&quot;&gt;选项3&lt;/el-menu-item&gt;</span><br><span class="line">        &lt;/el-menu-item-group&gt;</span><br><span class="line">        &lt;el-submenu index=&quot;3-4&quot;&gt;</span><br><span class="line">          &lt;template slot=&quot;title&quot;&gt;选项4&lt;/template&gt;</span><br><span class="line">          &lt;el-menu-item index=&quot;3-4-1&quot;&gt;选项4-1&lt;/el-menu-item&gt;</span><br><span class="line">        &lt;/el-submenu&gt;</span><br><span class="line">      &lt;/el-submenu&gt;</span><br><span class="line">    &lt;/el-menu&gt;</span><br><span class="line">  &lt;/el-aside&gt;</span><br><span class="line"></span><br><span class="line">  &lt;el-container&gt;</span><br><span class="line">    &lt;el-header style=&quot;text-align: right; font-size: 12px&quot;&gt;</span><br><span class="line">      &lt;el-dropdown&gt;</span><br><span class="line">        &lt;i class=&quot;el-icon-setting&quot; style=&quot;margin-right: 15px&quot;&gt;&lt;/i&gt;</span><br><span class="line">        &lt;el-dropdown-menu slot=&quot;dropdown&quot;&gt;</span><br><span class="line">          &lt;el-dropdown-item&gt;查看&lt;/el-dropdown-item&gt;</span><br><span class="line">          &lt;el-dropdown-item&gt;新增&lt;/el-dropdown-item&gt;</span><br><span class="line">          &lt;el-dropdown-item&gt;删除&lt;/el-dropdown-item&gt;</span><br><span class="line">        &lt;/el-dropdown-menu&gt;</span><br><span class="line">      &lt;/el-dropdown&gt;</span><br><span class="line">      &lt;span&gt;王小虎&lt;/span&gt;</span><br><span class="line">    &lt;/el-header&gt;</span><br><span class="line"></span><br><span class="line">    &lt;el-main&gt;</span><br><span class="line">      &lt;el-table :data=&quot;tableData&quot;&gt;</span><br><span class="line">        &lt;el-table-column prop=&quot;date&quot; label=&quot;日期&quot; width=&quot;140&quot;&gt;</span><br><span class="line">        &lt;/el-table-column&gt;</span><br><span class="line">        &lt;el-table-column prop=&quot;name&quot; label=&quot;姓名&quot; width=&quot;120&quot;&gt;</span><br><span class="line">        &lt;/el-table-column&gt;</span><br><span class="line">        &lt;el-table-column prop=&quot;address&quot; label=&quot;地址&quot;&gt;</span><br><span class="line">        &lt;/el-table-column&gt;</span><br><span class="line">      &lt;/el-table&gt;</span><br><span class="line">    &lt;/el-main&gt;</span><br><span class="line">  &lt;/el-container&gt;</span><br><span class="line">&lt;/el-container&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">    data() &#123;</span><br><span class="line">      const item = &#123;</span><br><span class="line">        date: &#x27;2016-05-02&#x27;,</span><br><span class="line">        name: &#x27;王小虎&#x27;,</span><br><span class="line">        address: &#x27;上海市普陀区金沙江路 1518 弄&#x27;</span><br><span class="line">      &#125;;</span><br><span class="line">      return &#123;</span><br><span class="line">        tableData: Array(20).fill(item)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">  .el-header &#123;</span><br><span class="line">    background-color: #B3C0D1;</span><br><span class="line">    color: #333;</span><br><span class="line">    line-height: 60px;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .el-aside &#123;</span><br><span class="line">    color: #333;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2.删除<code>&lt;el-main&gt;</code>中的内容，替换成<router-link/>的标签，然后在<el-menu>中加入属性router&#x3D;”true”,最后<el-menu-item>标签中加入route&#x3D;’&#x2F;{Vue Router 路径对象}’，是为了点击菜单达到替换内容的目的</p>
<h3 id="VSCode-加入vue代码片段"><a href="#VSCode-加入vue代码片段" class="headerlink" title="VSCode,加入vue代码片段"></a>VSCode,加入vue代码片段</h3><p>1.点击文件-首选项-用户代码-点击新建代码片段-取名vue.json,然后替换一下内容</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;Print to console&quot;</span>: &#123;</span><br><span class="line">	<span class="string">&quot;prefix&quot;</span>: <span class="string">&quot;vue&quot;</span>,</span><br><span class="line">	<span class="string">&quot;body&quot;</span>: [</span><br><span class="line">		<span class="string">&quot;&lt;template&gt;&quot;</span>,</span><br><span class="line">		<span class="string">&quot;  &lt;div&gt;&quot;</span>,</span><br><span class="line">		<span class="string">&quot;  &lt;/div&gt;&quot;</span>,</span><br><span class="line">		<span class="string">&quot;&lt;/template&gt;&quot;</span>,</span><br><span class="line">		<span class="string">&quot;&quot;</span>,</span><br><span class="line">		<span class="string">&quot;&lt;script&gt;&quot;</span>,</span><br><span class="line">		<span class="string">&quot;  export default &#123;&quot;</span>,</span><br><span class="line">		<span class="string">&quot;  data() &#123;&quot;</span>,</span><br><span class="line">		<span class="string">&quot;    return &#123;&quot;</span>,</span><br><span class="line">		<span class="string">&quot;&quot;</span>,</span><br><span class="line">		<span class="string">&quot;    &#125;;&quot;</span>,</span><br><span class="line">		<span class="string">&quot;  &#125;,&quot;</span>,</span><br><span class="line">		<span class="string">&quot;  created() &#123;&quot;</span>,</span><br><span class="line">		<span class="string">&quot;&quot;</span>,</span><br><span class="line">		<span class="string">&quot;  &#125;,&quot;</span>,</span><br><span class="line">		<span class="string">&quot;  mounted() &#123;&quot;</span>,</span><br><span class="line">		<span class="string">&quot;&quot;</span>,</span><br><span class="line">		<span class="string">&quot;  &#125;,&quot;</span>,</span><br><span class="line">		<span class="string">&quot;  methods: &#123;&quot;</span>,</span><br><span class="line">		<span class="string">&quot;&quot;</span>,</span><br><span class="line">		<span class="string">&quot;  &#125;,&quot;</span>,</span><br><span class="line">		<span class="string">&quot;&#125;&quot;</span>,</span><br><span class="line">		<span class="string">&quot;&lt;/script&gt;&quot;</span>,</span><br><span class="line">		<span class="string">&quot;&quot;</span>,</span><br><span class="line">		<span class="string">&quot;&lt;style lang=&#x27;scss&#x27; scoped&gt;&quot;</span>,</span><br><span class="line">		<span class="string">&quot;$4&quot;</span>,</span><br><span class="line">		<span class="string">&quot;&lt;/style&gt;&quot;</span></span><br><span class="line">	],</span><br><span class="line">	<span class="string">&quot;description&quot;</span>: <span class="string">&quot;Log output to console&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="商品服务"><a href="#商品服务" class="headerlink" title="商品服务"></a>商品服务</h2><h3 id="三级分类"><a href="#三级分类" class="headerlink" title="三级分类"></a>三级分类</h3><h4 id="查询树形展示三级分类数据"><a href="#查询树形展示三级分类数据" class="headerlink" title="查询树形展示三级分类数据"></a>查询树形展示三级分类数据</h4><p>1.在PMS库中的pms_category表，导入菜单分类数据</p>
<p>2.然后在product模块中，对应的service文件中编写三级分类业务逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;CategoryEntity&gt; <span class="title function_">menu</span><span class="params">()</span> &#123;</span><br><span class="line">       List&lt;CategoryEntity&gt; allList = baseMapper.selectList(<span class="literal">null</span>);</span><br><span class="line">       <span class="comment">// 找到所有的一级分类</span></span><br><span class="line">       List&lt;CategoryEntity&gt; level1Nenus = allList.stream().filter(categoryEntity -&gt; categoryEntity.getParentCid() == <span class="number">0</span></span><br><span class="line">       ).map((item) -&gt; &#123;</span><br><span class="line">           item.setChildren(getChildren(item, allList));</span><br><span class="line">           <span class="keyword">return</span> item;</span><br><span class="line">       &#125;).sorted((item1, item2) -&gt; &#123;</span><br><span class="line">           <span class="keyword">return</span> (item1.getSort() == <span class="literal">null</span> ? <span class="number">0</span> : item1.getSort()) - (item2.getSort() == <span class="literal">null</span> ? <span class="number">0</span> : item2.getSort());</span><br><span class="line">       &#125;).collect(Collectors.toList());</span><br><span class="line">       <span class="keyword">return</span> level1Nenus;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> List&lt;CategoryEntity&gt; <span class="title function_">getChildren</span><span class="params">(CategoryEntity currentItem, List&lt;CategoryEntity&gt; allList)</span> &#123;</span><br><span class="line">       List&lt;CategoryEntity&gt; collect = allList.stream().filter((item) -&gt; &#123;</span><br><span class="line">           <span class="keyword">return</span> item.getParentCid().equals(currentItem.getCatId());</span><br><span class="line">       &#125;).map((item) -&gt; &#123;</span><br><span class="line">           item.setChildren(getChildren(item, allList));</span><br><span class="line">           <span class="keyword">return</span> item;</span><br><span class="line">       &#125;).sorted((item1, item2) -&gt; &#123;</span><br><span class="line">           <span class="keyword">return</span> (item1.getSort() == <span class="literal">null</span> ? <span class="number">0</span> : item1.getSort()) - (item2.getSort() == <span class="literal">null</span> ? <span class="number">0</span> : item2.getSort());</span><br><span class="line">       &#125;).collect(Collectors.toList());</span><br><span class="line">       <span class="keyword">return</span> collect;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h4 id="配置网关路由与路径重写和网关统一配置跨域"><a href="#配置网关路由与路径重写和网关统一配置跨域" class="headerlink" title="配置网关路由与路径重写和网关统一配置跨域"></a>配置网关路由与路径重写和网关统一配置跨域</h4><p>1.启动前端代码，再启动后端服务，进入系统的系统管理-&gt;菜单管理，添加商品系统的一级目录，然后再添加这个一级目录的分类维护的子目录，path为product&#x2F;category。</p>
<p>2.然后根据这个path的属性，在前端src&#x2F;views&#x2F;modules 下创建一个product文件夹，然后在这个文件夹下创建category.vue 文件，文件内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;el-tree :data=&quot;data&quot; :props=&quot;defaultProps&quot; @node-click=&quot;handleNodeClick&quot;&gt;&lt;/el-tree&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">data() &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        data: [&#123;</span><br><span class="line">          label: &#x27;一级 1&#x27;,</span><br><span class="line">          children: [&#123;</span><br><span class="line">            label: &#x27;二级 1-1&#x27;,</span><br><span class="line">            children: [&#123;</span><br><span class="line">              label: &#x27;三级 1-1-1&#x27;</span><br><span class="line">            &#125;]</span><br><span class="line">          &#125;]</span><br><span class="line">        &#125;, &#123;</span><br><span class="line">          label: &#x27;一级 2&#x27;,</span><br><span class="line">          children: [&#123;</span><br><span class="line">            label: &#x27;二级 2-1&#x27;,</span><br><span class="line">            children: [&#123;</span><br><span class="line">              label: &#x27;三级 2-1-1&#x27;</span><br><span class="line">            &#125;]</span><br><span class="line">          &#125;, &#123;</span><br><span class="line">            label: &#x27;二级 2-2&#x27;,</span><br><span class="line">            children: [&#123;</span><br><span class="line">              label: &#x27;三级 2-2-1&#x27;</span><br><span class="line">            &#125;]</span><br><span class="line">          &#125;]</span><br><span class="line">        &#125;, &#123;</span><br><span class="line">          label: &#x27;一级 3&#x27;,</span><br><span class="line">          children: [&#123;</span><br><span class="line">            label: &#x27;二级 3-1&#x27;,</span><br><span class="line">            children: [&#123;</span><br><span class="line">              label: &#x27;三级 3-1-1&#x27;</span><br><span class="line">            &#125;]</span><br><span class="line">          &#125;, &#123;</span><br><span class="line">            label: &#x27;二级 3-2&#x27;,</span><br><span class="line">            children: [&#123;</span><br><span class="line">              label: &#x27;三级 3-2-1&#x27;</span><br><span class="line">            &#125;]</span><br><span class="line">          &#125;]</span><br><span class="line">        &#125;],</span><br><span class="line">        defaultProps: &#123;</span><br><span class="line">          children: &#x27;children&#x27;,</span><br><span class="line">          label: &#x27;label&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      handleNodeClick(data) &#123;</span><br><span class="line">        console.log(data);</span><br><span class="line">      &#125;,</span><br><span class="line">      getMenu()&#123;</span><br><span class="line">        this.$http(&#123;</span><br><span class="line">          url: this.$http.adornUrl(&#x27;/product/category/menu&#x27;),</span><br><span class="line">          method: &#x27;get&#x27;</span><br><span class="line">        &#125;).then((&#123;data&#125;) =&gt; &#123;</span><br><span class="line">          console.log(&#x27;菜单&#x27;+data)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">     activated () &#123;</span><br><span class="line">      this.getMenu()</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3.配置好请求，打开页面，发现请求404，我们要配置项目父目录下static-&gt;config的index.js 文件中的api请求接口路径，把所有服务请求都提交到网关服务去，修改如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 开发环境</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">;(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">SITE_CONFIG</span> = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// api接口请求地址</span></span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">SITE_CONFIG</span>[<span class="string">&#x27;baseUrl&#x27;</span>] = <span class="string">&#x27;http://localhost:88/api&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// cdn地址 = 域名 + 版本号</span></span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">SITE_CONFIG</span>[<span class="string">&#x27;domain&#x27;</span>]  = <span class="string">&#x27;./&#x27;</span>; <span class="comment">// 域名</span></span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">SITE_CONFIG</span>[<span class="string">&#x27;version&#x27;</span>] = <span class="string">&#x27;&#x27;</span>;   <span class="comment">// 版本号(年月日时分)</span></span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">SITE_CONFIG</span>[<span class="string">&#x27;cdnUrl&#x27;</span>]  = <span class="variable language_">window</span>.<span class="property">SITE_CONFIG</span>.<span class="property">domain</span> + <span class="variable language_">window</span>.<span class="property">SITE_CONFIG</span>.<span class="property">version</span>;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>4.配置好之后，还需要配置网关模块的配置文件，修改如下：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">product_route</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://supermall-product</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/api/product/**</span></span><br><span class="line">          <span class="attr">filters:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">RewritePath=/api/(?&lt;segment&gt;.*),/$\&#123;segment&#125;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">admin_route</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">lb://renren-fast</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/api/**</span></span><br><span class="line">          <span class="attr">filters:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">RewritePath=/api/(?&lt;segment&gt;.*),/renren-fast/$\&#123;segment&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>5.再把后端管理项目加入到nacos 服务发现中，配置nacos服务发现，重启网关服务。</p>
<p>6.但是我们发现，请求给了403，看控制台报错是没有配置跨域策略，所以我们必须在网关配置跨域策略，加入以下文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.cors.CorsConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.cors.reactive.CorsWebFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.cors.reactive.UrlBasedCorsConfigurationSource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SupermallCorsConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CorsWebFilter <span class="title function_">corsWebFilter</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">UrlBasedCorsConfigurationSource</span> <span class="variable">source</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UrlBasedCorsConfigurationSource</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">CorsConfiguration</span> <span class="variable">corsConfiguration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorsConfiguration</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1、配置跨域</span></span><br><span class="line">        corsConfiguration.addAllowedHeader(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        corsConfiguration.addAllowedMethod(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        corsConfiguration.addAllowedOrigin(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="comment">// 允许携带cookie</span></span><br><span class="line">        corsConfiguration.setAllowCredentials(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        source.registerCorsConfiguration(<span class="string">&quot;/**&quot;</span>,corsConfiguration);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CorsWebFilter</span>(source);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>7.重新请求，发现还是403，看了错误显示跨域配置了多个值，导致的报错，经过查找发现，后台管理服务中也增加了跨域策略，所以我们需要删除它，在io.renren.config目录下的CorsConfig 。</p>
<h4 id="树型展示三级分类数据"><a href="#树型展示三级分类数据" class="headerlink" title="树型展示三级分类数据"></a>树型展示三级分类数据</h4><p>1.修改category.vue文件，如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;el-tree :data=&quot;menus&quot; :props=&quot;defaultProps&quot; @node-click=&quot;handleNodeClick&quot;&gt;&lt;/el-tree&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">data() &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        menus: [],</span><br><span class="line">        defaultProps: &#123;</span><br><span class="line">          children: &#x27;children&#x27;,</span><br><span class="line">          label: &#x27;name&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      handleNodeClick(data) &#123;</span><br><span class="line">        console.log(data);</span><br><span class="line">      &#125;,</span><br><span class="line">      getMenu()&#123;</span><br><span class="line">        this.$http(&#123;</span><br><span class="line">          url: this.$http.adornUrl(&#x27;/product/category/menu&#x27;),</span><br><span class="line">          method: &#x27;get&#x27;</span><br><span class="line">        &#125;).then((&#123;data&#125;) =&gt; &#123;</span><br><span class="line">          this.menus = data.data</span><br><span class="line">          console.log(&#x27;菜单=========&#x27;,data.data)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">     activated () &#123;</span><br><span class="line">      this.getMenu()</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="页面效果"><a href="#页面效果" class="headerlink" title="页面效果"></a>页面效果</h4><p>修改过的页面内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-tree</span><br><span class="line">    :data=&quot;menus&quot;</span><br><span class="line">    :props=&quot;defaultProps&quot;</span><br><span class="line">    :expand-on-click-node=&quot;false&quot;</span><br><span class="line">    default-expand-all</span><br><span class="line">    show-checkbox</span><br><span class="line">    node-key=&quot;catId&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;span class=&quot;custom-tree-node&quot; slot-scope=&quot;&#123; node, data &#125;&quot;&gt;</span><br><span class="line">      &lt;span&gt;&#123;&#123; node.label &#125;&#125;&lt;/span&gt;</span><br><span class="line">      &lt;span&gt;</span><br><span class="line">        &lt;el-button</span><br><span class="line">          v-if=&quot;node.level &lt;= 2&quot;</span><br><span class="line">          type=&quot;text&quot;</span><br><span class="line">          size=&quot;mini&quot;</span><br><span class="line">          @click=&quot;() =&gt; append(data)&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          Append</span><br><span class="line">        &lt;/el-button&gt;</span><br><span class="line">        &lt;el-button</span><br><span class="line">          v-if=&quot;node.childNodes.length == 0&quot;</span><br><span class="line">          type=&quot;text&quot;</span><br><span class="line">          size=&quot;mini&quot;</span><br><span class="line">          @click=&quot;() =&gt; remove(node, data)&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          Delete</span><br><span class="line">        &lt;/el-button&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">    &lt;/span&gt;&lt;/el-tree</span><br><span class="line">  &gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      menus: [],</span><br><span class="line">      defaultProps: &#123;</span><br><span class="line">        children: &quot;children&quot;,</span><br><span class="line">        label: &quot;name&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    append(data) &#123;</span><br><span class="line">      console.log(&quot;append&quot;, data);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    remove(node, data) &#123;</span><br><span class="line">      console.log(&quot;remove&quot;, node, data);</span><br><span class="line">    &#125;,</span><br><span class="line">    getMenu() &#123;</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(&quot;/product/category/menu&quot;),</span><br><span class="line">        method: &quot;get&quot;</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        this.menus = data.data;</span><br><span class="line">        console.log(&quot;菜单=========&quot;, data.data);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  activated() &#123;</span><br><span class="line">    this.getMenu();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h4 id="逻辑删除"><a href="#逻辑删除" class="headerlink" title="逻辑删除"></a>逻辑删除</h4><p>以下为官方操作文档路径</p>
<p><a class="link"   target="_blank" rel="noopener" href="https://baomidou.com/guide/logic-delete.html#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%EF%BC%9A" >https://baomidou.com/guide/logic-delete.html#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%EF%BC%9A<i class="fas fa-external-link-alt"></i></a></p>
<p>1.使用mybatis-plus插件集成的便利性，修改application.yml，加上如下配置</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="comment">#mapper 的路径 ，classpath* 全路径扫描，即java的类路径下；classpath 即 resource 路径下</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:/mapper/**/*.xml</span></span><br><span class="line">  <span class="comment">#配置主键使用规则</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="comment">#主键自增</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span></span><br><span class="line">      <span class="attr">logic-delete-value:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">logic-not-delete-value:</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>2.修改DO实体类，把逻辑删除的字段加上@TableLogic 注解</p>
<p>3.然后使用postman 调用请求接口，为了看到逻辑删除执行的语句，我们需要修改日志框架的日志级别为debug级别，配置文件加入以下配置</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">com.centersept.supermall:</span> <span class="string">debug</span></span><br></pre></td></tr></table></figure>

<h4 id="删除效果细化"><a href="#删除效果细化" class="headerlink" title="删除效果细化"></a>删除效果细化</h4><p>category.vue 修改之后的内容为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-tree</span><br><span class="line">    :data=&quot;menus&quot;</span><br><span class="line">    :props=&quot;defaultProps&quot;</span><br><span class="line">    :expand-on-click-node=&quot;false&quot;</span><br><span class="line">    show-checkbox</span><br><span class="line">    node-key=&quot;catId&quot;</span><br><span class="line">    :default-expanded-keys=&quot;expandedKey&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;span class=&quot;custom-tree-node&quot; slot-scope=&quot;&#123; node, data &#125;&quot;&gt;</span><br><span class="line">      &lt;span&gt;&#123;&#123; node.label &#125;&#125;&lt;/span&gt;</span><br><span class="line">      &lt;span&gt;</span><br><span class="line">        &lt;el-button</span><br><span class="line">          v-if=&quot;node.level &lt;= 2&quot;</span><br><span class="line">          type=&quot;text&quot;</span><br><span class="line">          size=&quot;mini&quot;</span><br><span class="line">          @click=&quot;() =&gt; append(data)&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          Append</span><br><span class="line">        &lt;/el-button&gt;</span><br><span class="line">        &lt;el-button</span><br><span class="line">          v-if=&quot;node.childNodes.length == 0&quot;</span><br><span class="line">          type=&quot;text&quot;</span><br><span class="line">          size=&quot;mini&quot;</span><br><span class="line">          @click=&quot;() =&gt; remove(node, data)&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          Delete</span><br><span class="line">        &lt;/el-button&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">    &lt;/span&gt;&lt;/el-tree</span><br><span class="line">  &gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      menus: [],</span><br><span class="line">      expandedKey: [],</span><br><span class="line">      defaultProps: &#123;</span><br><span class="line">        children: &quot;children&quot;,</span><br><span class="line">        label: &quot;name&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    append(data) &#123;</span><br><span class="line">      console.log(&quot;append&quot;, data);</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    remove(node, data) &#123;</span><br><span class="line">      var ids = [data.catId];</span><br><span class="line">      this.$confirm(`是否删除【$&#123;data.name&#125;】菜单?`, &quot;提示&quot;, &#123;</span><br><span class="line">        confirmButtonText: &quot;确定&quot;,</span><br><span class="line">        cancelButtonText: &quot;取消&quot;,</span><br><span class="line">        type: &quot;warning&quot;</span><br><span class="line">      &#125;)</span><br><span class="line">        .then(() =&gt; &#123;</span><br><span class="line">          this.$http(&#123;</span><br><span class="line">            url: this.$http.adornUrl(&quot;/product/category/delete&quot;),</span><br><span class="line">            method: &quot;post&quot;,</span><br><span class="line">            data: this.$http.adornData(ids, false)</span><br><span class="line">          &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">            this.$message(&#123;</span><br><span class="line">              message: &quot;菜单删除成功&quot;,</span><br><span class="line">              type: &quot;success&quot;</span><br><span class="line">            &#125;);</span><br><span class="line">            //刷新出新的菜单</span><br><span class="line">            this.getMenus();</span><br><span class="line">            //设置需要默认展开的菜单</span><br><span class="line">            this.expandedKey = [node.parent.data.catId];</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(() =&gt; &#123;&#125;);</span><br><span class="line">      console.log(&quot;remove&quot;, node, data);</span><br><span class="line">    &#125;,</span><br><span class="line">    getMenus() &#123;</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(&quot;/product/category/menu&quot;),</span><br><span class="line">        method: &quot;get&quot;</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        this.menus = data.data;</span><br><span class="line">        console.log(&quot;菜单=========&quot;, data.data);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  activated() &#123;</span><br><span class="line">    this.getMenus();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h4 id="新增效果完成"><a href="#新增效果完成" class="headerlink" title="新增效果完成"></a>新增效果完成</h4><p>category.vue 修改之后的内容为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;el-tree</span><br><span class="line">      :data=&quot;menus&quot;</span><br><span class="line">      :props=&quot;defaultProps&quot;</span><br><span class="line">      :expand-on-click-node=&quot;false&quot;</span><br><span class="line">      show-checkbox</span><br><span class="line">      node-key=&quot;catId&quot;</span><br><span class="line">      :default-expanded-keys=&quot;expandedKey&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;span class=&quot;custom-tree-node&quot; slot-scope=&quot;&#123; node, data &#125;&quot;&gt;</span><br><span class="line">        &lt;span&gt;&#123;&#123; node.label &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;span&gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            v-if=&quot;node.level &lt;= 2&quot;</span><br><span class="line">            type=&quot;text&quot;</span><br><span class="line">            size=&quot;mini&quot;</span><br><span class="line">            @click=&quot;() =&gt; append(data)&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            Append</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            v-if=&quot;node.childNodes.length == 0&quot;</span><br><span class="line">            type=&quot;text&quot;</span><br><span class="line">            size=&quot;mini&quot;</span><br><span class="line">            @click=&quot;() =&gt; remove(node, data)&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            Delete</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">      &lt;/span&gt;&lt;/el-tree</span><br><span class="line">    &gt;</span><br><span class="line">    &lt;el-dialog</span><br><span class="line">      :title=&quot;title&quot;</span><br><span class="line">      :visible.sync=&quot;dialogVisible&quot;</span><br><span class="line">      width=&quot;30%&quot;</span><br><span class="line">      :close-on-click-modal=&quot;false&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;el-form :model=&quot;category&quot;&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;分类名称&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;category.name&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">      &lt;span slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        &lt;el-button @click=&quot;dialogVisible = false&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;addCategory&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      category: &#123;</span><br><span class="line">        name: &quot;&quot;,</span><br><span class="line">        parentCid: 0,</span><br><span class="line">        catLevel: 0,</span><br><span class="line">        showStatus: 1,</span><br><span class="line">        sort: 0,</span><br><span class="line">        productUnit: &quot;&quot;,</span><br><span class="line">        icon: &quot;&quot;,</span><br><span class="line">        catId: null</span><br><span class="line">      &#125;,</span><br><span class="line">      dialogVisible: false,</span><br><span class="line">      menus: [],</span><br><span class="line">      expandedKey: [],</span><br><span class="line">      defaultProps: &#123;</span><br><span class="line">        children: &quot;children&quot;,</span><br><span class="line">        label: &quot;name&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    append(data) &#123;</span><br><span class="line">      console.log(&quot;append&quot;, data);</span><br><span class="line">      this.dialogVisible = true;</span><br><span class="line">      this.category.parentCid = data.catId;</span><br><span class="line">      this.category.catLevel = data.catLevel * 1 + 1;</span><br><span class="line">      this.category.catId = null;</span><br><span class="line">      this.category.name = &quot;&quot;;</span><br><span class="line">      this.category.icon = &quot;&quot;;</span><br><span class="line">      this.category.productUnit = &quot;&quot;;</span><br><span class="line">      this.category.sort = 0;</span><br><span class="line">      this.category.showStatus = 1;</span><br><span class="line">    &#125;,</span><br><span class="line">    //添加三级分类</span><br><span class="line">    addCategory() &#123;</span><br><span class="line">      console.log(&quot;提交的三级分类数据&quot;, this.category);</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(&quot;/product/category/save&quot;),</span><br><span class="line">        method: &quot;post&quot;,</span><br><span class="line">        data: this.$http.adornData(this.category, false)</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        this.$message(&#123;</span><br><span class="line">          message: &quot;菜单保存成功&quot;,</span><br><span class="line">          type: &quot;success&quot;</span><br><span class="line">        &#125;);</span><br><span class="line">        //关闭对话框</span><br><span class="line">        this.dialogVisible = false;</span><br><span class="line">        //刷新出新的菜单</span><br><span class="line">        this.getMenus();</span><br><span class="line">        //设置需要默认展开的菜单</span><br><span class="line">        this.expandedKey = [this.category.parentCid];</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    remove(node, data) &#123;</span><br><span class="line">      var ids = [data.catId];</span><br><span class="line">      this.$confirm(`是否删除【$&#123;data.name&#125;】菜单?`, &quot;提示&quot;, &#123;</span><br><span class="line">        confirmButtonText: &quot;确定&quot;,</span><br><span class="line">        cancelButtonText: &quot;取消&quot;,</span><br><span class="line">        type: &quot;warning&quot;</span><br><span class="line">      &#125;)</span><br><span class="line">        .then(() =&gt; &#123;</span><br><span class="line">          this.$http(&#123;</span><br><span class="line">            url: this.$http.adornUrl(&quot;/product/category/delete&quot;),</span><br><span class="line">            method: &quot;post&quot;,</span><br><span class="line">            data: this.$http.adornData(ids, false)</span><br><span class="line">          &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">            this.$message(&#123;</span><br><span class="line">              message: &quot;菜单删除成功&quot;,</span><br><span class="line">              type: &quot;success&quot;</span><br><span class="line">            &#125;);</span><br><span class="line">            //刷新出新的菜单</span><br><span class="line">            this.getMenus();</span><br><span class="line">            //设置需要默认展开的菜单</span><br><span class="line">            this.expandedKey = [node.parent.data.catId];</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(() =&gt; &#123;&#125;);</span><br><span class="line">      console.log(&quot;remove&quot;, node, data);</span><br><span class="line">    &#125;,</span><br><span class="line">    getMenus() &#123;</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(&quot;/product/category/menu&quot;),</span><br><span class="line">        method: &quot;get&quot;</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        this.menus = data.data;</span><br><span class="line">        console.log(&quot;菜单=========&quot;, data.data);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  activated() &#123;</span><br><span class="line">    this.getMenus();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h4 id="基本修改效果完成"><a href="#基本修改效果完成" class="headerlink" title="基本修改效果完成"></a>基本修改效果完成</h4><p>category.vue 修改之后的内容为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;el-tree</span><br><span class="line">      :data=&quot;menus&quot;</span><br><span class="line">      :props=&quot;defaultProps&quot;</span><br><span class="line">      :expand-on-click-node=&quot;false&quot;</span><br><span class="line">      show-checkbox</span><br><span class="line">      node-key=&quot;catId&quot;</span><br><span class="line">      :default-expanded-keys=&quot;expandedKey&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;span class=&quot;custom-tree-node&quot; slot-scope=&quot;&#123; node, data &#125;&quot;&gt;</span><br><span class="line">        &lt;span&gt;&#123;&#123; node.label &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;span&gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            v-if=&quot;node.level &lt;= 2&quot;</span><br><span class="line">            type=&quot;text&quot;</span><br><span class="line">            size=&quot;mini&quot;</span><br><span class="line">            @click=&quot;() =&gt; append(data)&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            Append</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line">          &lt;el-button type=&quot;text&quot; size=&quot;mini&quot; @click=&quot;edit(data)&quot;</span><br><span class="line">            &gt;edit&lt;/el-button</span><br><span class="line">          &gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            v-if=&quot;node.childNodes.length == 0&quot;</span><br><span class="line">            type=&quot;text&quot;</span><br><span class="line">            size=&quot;mini&quot;</span><br><span class="line">            @click=&quot;() =&gt; remove(node, data)&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            Delete</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">      &lt;/span&gt;&lt;/el-tree</span><br><span class="line">    &gt;</span><br><span class="line">    &lt;el-dialog</span><br><span class="line">      :title=&quot;title&quot;</span><br><span class="line">      :visible.sync=&quot;dialogVisible&quot;</span><br><span class="line">      width=&quot;30%&quot;</span><br><span class="line">      :close-on-click-modal=&quot;false&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;el-form :model=&quot;category&quot;&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;分类名称&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;category.name&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;图标&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;category.icon&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;计量单位&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;category.productUnit&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">      &lt;span slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        &lt;el-button @click=&quot;dialogVisible = false&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;submitData&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      title: &quot;&quot;,</span><br><span class="line">      dialogType: &quot;&quot;, //edit,add</span><br><span class="line">      category: &#123;</span><br><span class="line">        name: &quot;&quot;,</span><br><span class="line">        parentCid: 0,</span><br><span class="line">        catLevel: 0,</span><br><span class="line">        showStatus: 1,</span><br><span class="line">        sort: 0,</span><br><span class="line">        productUnit: &quot;&quot;,</span><br><span class="line">        icon: &quot;&quot;,</span><br><span class="line">        catId: null</span><br><span class="line">      &#125;,</span><br><span class="line">      dialogVisible: false,</span><br><span class="line">      menus: [],</span><br><span class="line">      expandedKey: [],</span><br><span class="line">      defaultProps: &#123;</span><br><span class="line">        children: &quot;children&quot;,</span><br><span class="line">        label: &quot;name&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    submitData() &#123;</span><br><span class="line">      if (this.dialogType == &quot;add&quot;) &#123;</span><br><span class="line">        this.addCategory();</span><br><span class="line">      &#125;</span><br><span class="line">      if (this.dialogType == &quot;edit&quot;) &#123;</span><br><span class="line">        this.editCategory();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    edit(data) &#123;</span><br><span class="line">      console.log(&quot;要修改的数据&quot;, data);</span><br><span class="line">      this.dialogType = &quot;edit&quot;;</span><br><span class="line">      this.title = &quot;修改分类&quot;;</span><br><span class="line">      this.dialogVisible = true;</span><br><span class="line"></span><br><span class="line">      //发送请求获取当前节点最新的数据</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(`/product/category/info/$&#123;data.catId&#125;`),</span><br><span class="line">        method: &quot;get&quot;</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        //请求成功</span><br><span class="line">        console.log(&quot;要回显的数据&quot;, data);</span><br><span class="line">        this.category.name = data.data.name;</span><br><span class="line">        this.category.catId = data.data.catId;</span><br><span class="line">        this.category.icon = data.data.icon;</span><br><span class="line">        this.category.productUnit = data.data.productUnit;</span><br><span class="line">        this.category.parentCid = data.data.parentCid;</span><br><span class="line">        this.category.catLevel = data.data.catLevel;</span><br><span class="line">        this.category.sort = data.data.sort;</span><br><span class="line">        this.category.showStatus = data.data.showStatus;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    //修改三级分类数据</span><br><span class="line">    editCategory() &#123;</span><br><span class="line">      var &#123; catId, name, icon, productUnit &#125; = this.category;</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(&quot;/product/category/update&quot;),</span><br><span class="line">        method: &quot;post&quot;,</span><br><span class="line">        data: this.$http.adornData(&#123; catId, name, icon, productUnit &#125;, false)</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        this.$message(&#123;</span><br><span class="line">          message: &quot;菜单修改成功&quot;,</span><br><span class="line">          type: &quot;success&quot;</span><br><span class="line">        &#125;);</span><br><span class="line">        //关闭对话框</span><br><span class="line">        this.dialogVisible = false;</span><br><span class="line">        //刷新出新的菜单</span><br><span class="line">        this.getMenus();</span><br><span class="line">        //设置需要默认展开的菜单</span><br><span class="line">        this.expandedKey = [this.category.parentCid];</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    append(data) &#123;</span><br><span class="line">      console.log(&quot;append&quot;, data);</span><br><span class="line">      this.dialogType = &quot;add&quot;;</span><br><span class="line">      this.title = &quot;添加分类&quot;;</span><br><span class="line">      this.dialogVisible = true;</span><br><span class="line">      this.category.parentCid = data.catId;</span><br><span class="line">      this.category.catLevel = data.catLevel * 1 + 1;</span><br><span class="line">      this.category.catId = null;</span><br><span class="line">      this.category.name = &quot;&quot;;</span><br><span class="line">      this.category.icon = &quot;&quot;;</span><br><span class="line">      this.category.productUnit = &quot;&quot;;</span><br><span class="line">      this.category.sort = 0;</span><br><span class="line">      this.category.showStatus = 1;</span><br><span class="line">    &#125;,</span><br><span class="line">    //添加三级分类</span><br><span class="line">    addCategory() &#123;</span><br><span class="line">      console.log(&quot;提交的三级分类数据&quot;, this.category);</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(&quot;/product/category/save&quot;),</span><br><span class="line">        method: &quot;post&quot;,</span><br><span class="line">        data: this.$http.adornData(this.category, false)</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        this.$message(&#123;</span><br><span class="line">          message: &quot;菜单保存成功&quot;,</span><br><span class="line">          type: &quot;success&quot;</span><br><span class="line">        &#125;);</span><br><span class="line">        //关闭对话框</span><br><span class="line">        this.dialogVisible = false;</span><br><span class="line">        //刷新出新的菜单</span><br><span class="line">        this.getMenus();</span><br><span class="line">        //设置需要默认展开的菜单</span><br><span class="line">        this.expandedKey = [this.category.parentCid];</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    remove(node, data) &#123;</span><br><span class="line">      var ids = [data.catId];</span><br><span class="line">      this.$confirm(`是否删除【$&#123;data.name&#125;】菜单?`, &quot;提示&quot;, &#123;</span><br><span class="line">        confirmButtonText: &quot;确定&quot;,</span><br><span class="line">        cancelButtonText: &quot;取消&quot;,</span><br><span class="line">        type: &quot;warning&quot;</span><br><span class="line">      &#125;)</span><br><span class="line">        .then(() =&gt; &#123;</span><br><span class="line">          this.$http(&#123;</span><br><span class="line">            url: this.$http.adornUrl(&quot;/product/category/delete&quot;),</span><br><span class="line">            method: &quot;post&quot;,</span><br><span class="line">            data: this.$http.adornData(ids, false)</span><br><span class="line">          &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">            this.$message(&#123;</span><br><span class="line">              message: &quot;菜单删除成功&quot;,</span><br><span class="line">              type: &quot;success&quot;</span><br><span class="line">            &#125;);</span><br><span class="line">            //刷新出新的菜单</span><br><span class="line">            this.getMenus();</span><br><span class="line">            //设置需要默认展开的菜单</span><br><span class="line">            this.expandedKey = [node.parent.data.catId];</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(() =&gt; &#123;&#125;);</span><br><span class="line">      console.log(&quot;remove&quot;, node, data);</span><br><span class="line">    &#125;,</span><br><span class="line">    getMenus() &#123;</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(&quot;/product/category/menu&quot;),</span><br><span class="line">        method: &quot;get&quot;</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        this.menus = data.data;</span><br><span class="line">        console.log(&quot;菜单=========&quot;, data.data);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  activated() &#123;</span><br><span class="line">    this.getMenus();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h4 id="拖拽效果"><a href="#拖拽效果" class="headerlink" title="拖拽效果"></a>拖拽效果</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;el-tree</span><br><span class="line">      :data=&quot;menus&quot;</span><br><span class="line">      :props=&quot;defaultProps&quot;</span><br><span class="line">      :expand-on-click-node=&quot;false&quot;</span><br><span class="line">      show-checkbox</span><br><span class="line">      :draggable=&quot;draggable&quot;</span><br><span class="line">      :allow-drop=&quot;allowDrop&quot;</span><br><span class="line">      node-key=&quot;catId&quot;</span><br><span class="line">      :default-expanded-keys=&quot;expandedKey&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;span class=&quot;custom-tree-node&quot; slot-scope=&quot;&#123; node, data &#125;&quot;&gt;</span><br><span class="line">        &lt;span&gt;&#123;&#123; node.label &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;span&gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            v-if=&quot;node.level &lt;= 2&quot;</span><br><span class="line">            type=&quot;text&quot;</span><br><span class="line">            size=&quot;mini&quot;</span><br><span class="line">            @click=&quot;() =&gt; append(data)&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            Append</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line">          &lt;el-button type=&quot;text&quot; size=&quot;mini&quot; @click=&quot;edit(data)&quot;</span><br><span class="line">            &gt;edit&lt;/el-button</span><br><span class="line">          &gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            v-if=&quot;node.childNodes.length == 0&quot;</span><br><span class="line">            type=&quot;text&quot;</span><br><span class="line">            size=&quot;mini&quot;</span><br><span class="line">            @click=&quot;() =&gt; remove(node, data)&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            Delete</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">      &lt;/span&gt;&lt;/el-tree</span><br><span class="line">    &gt;</span><br><span class="line">    &lt;el-dialog</span><br><span class="line">      :title=&quot;title&quot;</span><br><span class="line">      :visible.sync=&quot;dialogVisible&quot;</span><br><span class="line">      width=&quot;30%&quot;</span><br><span class="line">      :close-on-click-modal=&quot;false&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;el-form :model=&quot;category&quot;&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;分类名称&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;category.name&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;图标&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;category.icon&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;计量单位&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;category.productUnit&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">      &lt;span slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        &lt;el-button @click=&quot;dialogVisible = false&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;submitData&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      draggable: true,</span><br><span class="line">      maxLevel: 0,</span><br><span class="line">      title: &quot;&quot;,</span><br><span class="line">      dialogType: &quot;&quot;, //edit,add</span><br><span class="line">      category: &#123;</span><br><span class="line">        name: &quot;&quot;,</span><br><span class="line">        parentCid: 0,</span><br><span class="line">        catLevel: 0,</span><br><span class="line">        showStatus: 1,</span><br><span class="line">        sort: 0,</span><br><span class="line">        productUnit: &quot;&quot;,</span><br><span class="line">        icon: &quot;&quot;,</span><br><span class="line">        catId: null</span><br><span class="line">      &#125;,</span><br><span class="line">      dialogVisible: false,</span><br><span class="line">      menus: [],</span><br><span class="line">      expandedKey: [],</span><br><span class="line">      defaultProps: &#123;</span><br><span class="line">        children: &quot;children&quot;,</span><br><span class="line">        label: &quot;name&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    allowDrop(draggingNode, dropNode, type) &#123;</span><br><span class="line">      //1、被拖动的当前节点以及所在的父节点总层数不能大于3</span><br><span class="line"></span><br><span class="line">      //1）、被拖动的当前节点总层数</span><br><span class="line">      console.log(&quot;allowDrop:&quot;, draggingNode, dropNode, type);</span><br><span class="line">      //</span><br><span class="line">      this.countNodeLevel(draggingNode);</span><br><span class="line">      //当前正在拖动的节点+父节点所在的深度不大于3即可</span><br><span class="line">      let deep = Math.abs(this.maxLevel - draggingNode.level) + 1;</span><br><span class="line">      console.log(&quot;深度：&quot;, deep);</span><br><span class="line"></span><br><span class="line">      //   this.maxLevel</span><br><span class="line">      if (type == &quot;inner&quot;) &#123;</span><br><span class="line">        // console.log(</span><br><span class="line">        //   `this.maxLevel：$&#123;this.maxLevel&#125;；draggingNode.data.catLevel：$&#123;draggingNode.data.catLevel&#125;；dropNode.level：$&#123;dropNode.level&#125;`</span><br><span class="line">        // );</span><br><span class="line">        return deep + dropNode.level &lt;= 3;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        return deep + dropNode.parent.level &lt;= 3;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    countNodeLevel(node) &#123;</span><br><span class="line">      //找到所有子节点，求出最大深度</span><br><span class="line">      if (node.childNodes != null &amp;&amp; node.childNodes.length &gt; 0) &#123;</span><br><span class="line">        for (let i = 0; i &lt; node.childNodes.length; i++) &#123;</span><br><span class="line">          if (node.childNodes[i].level &gt; this.maxLevel) &#123;</span><br><span class="line">            this.maxLevel = node.childNodes[i].level;</span><br><span class="line">          &#125;</span><br><span class="line">          this.countNodeLevel(node.childNodes[i]);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    submitData() &#123;</span><br><span class="line">      if (this.dialogType == &quot;add&quot;) &#123;</span><br><span class="line">        this.addCategory();</span><br><span class="line">      &#125;</span><br><span class="line">      if (this.dialogType == &quot;edit&quot;) &#123;</span><br><span class="line">        this.editCategory();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    edit(data) &#123;</span><br><span class="line">      console.log(&quot;要修改的数据&quot;, data);</span><br><span class="line">      this.dialogType = &quot;edit&quot;;</span><br><span class="line">      this.title = &quot;修改分类&quot;;</span><br><span class="line">      this.dialogVisible = true;</span><br><span class="line"></span><br><span class="line">      //发送请求获取当前节点最新的数据</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(`/product/category/info/$&#123;data.catId&#125;`),</span><br><span class="line">        method: &quot;get&quot;</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        //请求成功</span><br><span class="line">        console.log(&quot;要回显的数据&quot;, data);</span><br><span class="line">        this.category.name = data.data.name;</span><br><span class="line">        this.category.catId = data.data.catId;</span><br><span class="line">        this.category.icon = data.data.icon;</span><br><span class="line">        this.category.productUnit = data.data.productUnit;</span><br><span class="line">        this.category.parentCid = data.data.parentCid;</span><br><span class="line">        this.category.catLevel = data.data.catLevel;</span><br><span class="line">        this.category.sort = data.data.sort;</span><br><span class="line">        this.category.showStatus = data.data.showStatus;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    //修改三级分类数据</span><br><span class="line">    editCategory() &#123;</span><br><span class="line">      var &#123; catId, name, icon, productUnit &#125; = this.category;</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(&quot;/product/category/update&quot;),</span><br><span class="line">        method: &quot;post&quot;,</span><br><span class="line">        data: this.$http.adornData(&#123; catId, name, icon, productUnit &#125;, false)</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        this.$message(&#123;</span><br><span class="line">          message: &quot;菜单修改成功&quot;,</span><br><span class="line">          type: &quot;success&quot;</span><br><span class="line">        &#125;);</span><br><span class="line">        //关闭对话框</span><br><span class="line">        this.dialogVisible = false;</span><br><span class="line">        //刷新出新的菜单</span><br><span class="line">        this.getMenus();</span><br><span class="line">        //设置需要默认展开的菜单</span><br><span class="line">        this.expandedKey = [this.category.parentCid];</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    append(data) &#123;</span><br><span class="line">      console.log(&quot;append&quot;, data);</span><br><span class="line">      this.dialogType = &quot;add&quot;;</span><br><span class="line">      this.title = &quot;添加分类&quot;;</span><br><span class="line">      this.dialogVisible = true;</span><br><span class="line">      this.category.parentCid = data.catId;</span><br><span class="line">      this.category.catLevel = data.catLevel * 1 + 1;</span><br><span class="line">      this.category.catId = null;</span><br><span class="line">      this.category.name = &quot;&quot;;</span><br><span class="line">      this.category.icon = &quot;&quot;;</span><br><span class="line">      this.category.productUnit = &quot;&quot;;</span><br><span class="line">      this.category.sort = 0;</span><br><span class="line">      this.category.showStatus = 1;</span><br><span class="line">    &#125;,</span><br><span class="line">    //添加三级分类</span><br><span class="line">    addCategory() &#123;</span><br><span class="line">      console.log(&quot;提交的三级分类数据&quot;, this.category);</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(&quot;/product/category/save&quot;),</span><br><span class="line">        method: &quot;post&quot;,</span><br><span class="line">        data: this.$http.adornData(this.category, false)</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        this.$message(&#123;</span><br><span class="line">          message: &quot;菜单保存成功&quot;,</span><br><span class="line">          type: &quot;success&quot;</span><br><span class="line">        &#125;);</span><br><span class="line">        //关闭对话框</span><br><span class="line">        this.dialogVisible = false;</span><br><span class="line">        //刷新出新的菜单</span><br><span class="line">        this.getMenus();</span><br><span class="line">        //设置需要默认展开的菜单</span><br><span class="line">        this.expandedKey = [this.category.parentCid];</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    remove(node, data) &#123;</span><br><span class="line">      var ids = [data.catId];</span><br><span class="line">      this.$confirm(`是否删除【$&#123;data.name&#125;】菜单?`, &quot;提示&quot;, &#123;</span><br><span class="line">        confirmButtonText: &quot;确定&quot;,</span><br><span class="line">        cancelButtonText: &quot;取消&quot;,</span><br><span class="line">        type: &quot;warning&quot;</span><br><span class="line">      &#125;)</span><br><span class="line">        .then(() =&gt; &#123;</span><br><span class="line">          this.$http(&#123;</span><br><span class="line">            url: this.$http.adornUrl(&quot;/product/category/delete&quot;),</span><br><span class="line">            method: &quot;post&quot;,</span><br><span class="line">            data: this.$http.adornData(ids, false)</span><br><span class="line">          &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">            this.$message(&#123;</span><br><span class="line">              message: &quot;菜单删除成功&quot;,</span><br><span class="line">              type: &quot;success&quot;</span><br><span class="line">            &#125;);</span><br><span class="line">            //刷新出新的菜单</span><br><span class="line">            this.getMenus();</span><br><span class="line">            //设置需要默认展开的菜单</span><br><span class="line">            this.expandedKey = [node.parent.data.catId];</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(() =&gt; &#123;&#125;);</span><br><span class="line">      console.log(&quot;remove&quot;, node, data);</span><br><span class="line">    &#125;,</span><br><span class="line">    getMenus() &#123;</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(&quot;/product/category/menu&quot;),</span><br><span class="line">        method: &quot;get&quot;</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        this.menus = data.data;</span><br><span class="line">        console.log(&quot;菜单=========&quot;, data.data);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  activated() &#123;</span><br><span class="line">    this.getMenus();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h4 id="拖拽数据收集"><a href="#拖拽数据收集" class="headerlink" title="拖拽数据收集"></a>拖拽数据收集</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;el-tree</span><br><span class="line">      :data=&quot;menus&quot;</span><br><span class="line">      :props=&quot;defaultProps&quot;</span><br><span class="line">      :expand-on-click-node=&quot;false&quot;</span><br><span class="line">      show-checkbox</span><br><span class="line">      node-key=&quot;catId&quot;</span><br><span class="line">      :default-expanded-keys=&quot;expandedKey&quot;</span><br><span class="line">      :draggable=&quot;draggable&quot;</span><br><span class="line">      :allow-drop=&quot;allowDrop&quot;</span><br><span class="line">      @node-drop=&quot;handleDrop&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;span class=&quot;custom-tree-node&quot; slot-scope=&quot;&#123; node, data &#125;&quot;&gt;</span><br><span class="line">        &lt;span&gt;&#123;&#123; node.label &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;span&gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            v-if=&quot;node.level &lt;= 2&quot;</span><br><span class="line">            type=&quot;text&quot;</span><br><span class="line">            size=&quot;mini&quot;</span><br><span class="line">            @click=&quot;() =&gt; append(data)&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            Append</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line">          &lt;el-button type=&quot;text&quot; size=&quot;mini&quot; @click=&quot;edit(data)&quot;</span><br><span class="line">            &gt;edit&lt;/el-button</span><br><span class="line">          &gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            v-if=&quot;node.childNodes.length == 0&quot;</span><br><span class="line">            type=&quot;text&quot;</span><br><span class="line">            size=&quot;mini&quot;</span><br><span class="line">            @click=&quot;() =&gt; remove(node, data)&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            Delete</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">      &lt;/span&gt;&lt;/el-tree</span><br><span class="line">    &gt;</span><br><span class="line">    &lt;el-dialog</span><br><span class="line">      :title=&quot;title&quot;</span><br><span class="line">      :visible.sync=&quot;dialogVisible&quot;</span><br><span class="line">      width=&quot;30%&quot;</span><br><span class="line">      :close-on-click-modal=&quot;false&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;el-form :model=&quot;category&quot;&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;分类名称&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;category.name&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;图标&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;category.icon&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;计量单位&quot;&gt;</span><br><span class="line">          &lt;el-input</span><br><span class="line">            v-model=&quot;category.productUnit&quot;</span><br><span class="line">            autocomplete=&quot;off&quot;</span><br><span class="line">          &gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">      &lt;span slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        &lt;el-button @click=&quot;dialogVisible = false&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;submitData&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      updateNodes: [],</span><br><span class="line">      draggable: true,</span><br><span class="line">      maxLevel: 0,</span><br><span class="line">      title: &quot;&quot;,</span><br><span class="line">      dialogType: &quot;&quot;, //edit,add</span><br><span class="line">      category: &#123;</span><br><span class="line">        name: &quot;&quot;,</span><br><span class="line">        parentCid: 0,</span><br><span class="line">        catLevel: 0,</span><br><span class="line">        showStatus: 1,</span><br><span class="line">        sort: 0,</span><br><span class="line">        productUnit: &quot;&quot;,</span><br><span class="line">        icon: &quot;&quot;,</span><br><span class="line">        catId: null</span><br><span class="line">      &#125;,</span><br><span class="line">      dialogVisible: false,</span><br><span class="line">      menus: [],</span><br><span class="line">      expandedKey: [],</span><br><span class="line">      defaultProps: &#123;</span><br><span class="line">        children: &quot;children&quot;,</span><br><span class="line">        label: &quot;name&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    // 菜单拖拽 start =======================================================</span><br><span class="line">    handleDrop(draggingNode, dropNode, dropType, ev) &#123;</span><br><span class="line">      console.log(&quot;handleDrop: &quot;, draggingNode, dropNode, dropType);</span><br><span class="line">      //1、当前节点最新的父节点id</span><br><span class="line">      let pCid = 0;</span><br><span class="line">      let siblings = null;</span><br><span class="line">      if (dropType == &quot;before&quot; || dropType == &quot;after&quot;) &#123;</span><br><span class="line">        pCid =</span><br><span class="line">          dropNode.parent.data.catId == undefined</span><br><span class="line">            ? 0</span><br><span class="line">            : dropNode.parent.data.catId;</span><br><span class="line">        siblings = dropNode.parent.childNodes;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        pCid = dropNode.data.catId;</span><br><span class="line">        siblings = dropNode.childNodes;</span><br><span class="line">      &#125;</span><br><span class="line">      this.pCid.push(pCid);</span><br><span class="line">      //2、当前拖拽节点的最新顺序，</span><br><span class="line">      for (let i = 0; i &lt; siblings.length; i++) &#123;</span><br><span class="line">        if (siblings[i].data.catId == draggingNode.data.catId) &#123;</span><br><span class="line">          //如果遍历的是当前正在拖拽的节点</span><br><span class="line">          let catLevel = draggingNode.level;</span><br><span class="line">          if (siblings[i].level != draggingNode.level) &#123;</span><br><span class="line">            //当前节点的层级发生变化</span><br><span class="line">            catLevel = siblings[i].level;</span><br><span class="line">            //修改他子节点的层级</span><br><span class="line">            this.updateChildNodeLevel(siblings[i]);</span><br><span class="line">          &#125;</span><br><span class="line">          this.updateNodes.push(&#123;</span><br><span class="line">            catId: siblings[i].data.catId,</span><br><span class="line">            sort: i,</span><br><span class="line">            parentCid: pCid,</span><br><span class="line">            catLevel: catLevel</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          this.updateNodes.push(&#123; catId: siblings[i].data.catId, sort: i &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      //3、当前拖拽节点的最新层级</span><br><span class="line">      console.log(&quot;updateNodes&quot;, this.updateNodes);</span><br><span class="line">    &#125;,</span><br><span class="line">    updateChildNodeLevel(node) &#123;</span><br><span class="line">      if (node.childNodes.length &gt; 0) &#123;</span><br><span class="line">        for (let i = 0; i &lt; node.childNodes.length; i++) &#123;</span><br><span class="line">          var cNode = node.childNodes[i].data;</span><br><span class="line">          this.updateNodes.push(&#123;</span><br><span class="line">            catId: cNode.catId,</span><br><span class="line">            catLevel: node.childNodes[i].level</span><br><span class="line">          &#125;);</span><br><span class="line">          this.updateChildNodeLevel(node.childNodes[i]);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    allowDrop(draggingNode, dropNode, type) &#123;</span><br><span class="line">      //1、被拖动的当前节点以及所在的父节点总层数不能大于3</span><br><span class="line"></span><br><span class="line">      //1）、被拖动的当前节点总层数</span><br><span class="line">      console.log(&quot;allowDrop:&quot;, draggingNode, dropNode, type);</span><br><span class="line">      //</span><br><span class="line">      this.countNodeLevel(draggingNode);</span><br><span class="line">      //当前正在拖动的节点+父节点所在的深度不大于3即可</span><br><span class="line">      let deep = Math.abs(this.maxLevel - draggingNode.level) + 1;</span><br><span class="line">      console.log(&quot;深度：&quot;, deep);</span><br><span class="line"></span><br><span class="line">      //   this.maxLevel</span><br><span class="line">      if (type == &quot;inner&quot;) &#123;</span><br><span class="line">        // console.log(</span><br><span class="line">        //   `this.maxLevel：$&#123;this.maxLevel&#125;；draggingNode.data.catLevel：$&#123;draggingNode.data.catLevel&#125;；dropNode.level：$&#123;dropNode.level&#125;`</span><br><span class="line">        // );</span><br><span class="line">        return deep + dropNode.level &lt;= 3;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        return deep + dropNode.parent.level &lt;= 3;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    countNodeLevel(node) &#123;</span><br><span class="line">      //找到所有子节点，求出最大深度</span><br><span class="line">      if (node.childNodes != null &amp;&amp; node.childNodes.length &gt; 0) &#123;</span><br><span class="line">        for (let i = 0; i &lt; node.childNodes.length; i++) &#123;</span><br><span class="line">          if (node.childNodes[i].level &gt; this.maxLevel) &#123;</span><br><span class="line">            this.maxLevel = node.childNodes[i].level;</span><br><span class="line">          &#125;</span><br><span class="line">          this.countNodeLevel(node.childNodes[i]);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    // 菜单拖拽 end =======================================================</span><br><span class="line">    submitData() &#123;</span><br><span class="line">      if (this.dialogType == &quot;add&quot;) &#123;</span><br><span class="line">        this.addCategory();</span><br><span class="line">      &#125;</span><br><span class="line">      if (this.dialogType == &quot;edit&quot;) &#123;</span><br><span class="line">        this.editCategory();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    edit(data) &#123;</span><br><span class="line">      console.log(&quot;要修改的数据&quot;, data);</span><br><span class="line">      this.dialogType = &quot;edit&quot;;</span><br><span class="line">      this.title = &quot;修改分类&quot;;</span><br><span class="line">      this.dialogVisible = true;</span><br><span class="line"></span><br><span class="line">      //发送请求获取当前节点最新的数据</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(`/product/category/info/$&#123;data.catId&#125;`),</span><br><span class="line">        method: &quot;get&quot;</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        //请求成功</span><br><span class="line">        console.log(&quot;要回显的数据&quot;, data);</span><br><span class="line">        this.category.name = data.data.name;</span><br><span class="line">        this.category.catId = data.data.catId;</span><br><span class="line">        this.category.icon = data.data.icon;</span><br><span class="line">        this.category.productUnit = data.data.productUnit;</span><br><span class="line">        this.category.parentCid = data.data.parentCid;</span><br><span class="line">        this.category.catLevel = data.data.catLevel;</span><br><span class="line">        this.category.sort = data.data.sort;</span><br><span class="line">        this.category.showStatus = data.data.showStatus;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    //修改三级分类数据</span><br><span class="line">    editCategory() &#123;</span><br><span class="line">      var &#123; catId, name, icon, productUnit &#125; = this.category;</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(&quot;/product/category/update&quot;),</span><br><span class="line">        method: &quot;post&quot;,</span><br><span class="line">        data: this.$http.adornData(&#123; catId, name, icon, productUnit &#125;, false)</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        this.$message(&#123;</span><br><span class="line">          message: &quot;菜单修改成功&quot;,</span><br><span class="line">          type: &quot;success&quot;</span><br><span class="line">        &#125;);</span><br><span class="line">        //关闭对话框</span><br><span class="line">        this.dialogVisible = false;</span><br><span class="line">        //刷新出新的菜单</span><br><span class="line">        this.getMenus();</span><br><span class="line">        //设置需要默认展开的菜单</span><br><span class="line">        this.expandedKey = [this.category.parentCid];</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    append(data) &#123;</span><br><span class="line">      console.log(&quot;append&quot;, data);</span><br><span class="line">      this.dialogType = &quot;add&quot;;</span><br><span class="line">      this.title = &quot;添加分类&quot;;</span><br><span class="line">      this.dialogVisible = true;</span><br><span class="line">      this.category.parentCid = data.catId;</span><br><span class="line">      this.category.catLevel = data.catLevel * 1 + 1;</span><br><span class="line">      this.category.catId = null;</span><br><span class="line">      this.category.name = &quot;&quot;;</span><br><span class="line">      this.category.icon = &quot;&quot;;</span><br><span class="line">      this.category.productUnit = &quot;&quot;;</span><br><span class="line">      this.category.sort = 0;</span><br><span class="line">      this.category.showStatus = 1;</span><br><span class="line">    &#125;,</span><br><span class="line">    //添加三级分类</span><br><span class="line">    addCategory() &#123;</span><br><span class="line">      console.log(&quot;提交的三级分类数据&quot;, this.category);</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(&quot;/product/category/save&quot;),</span><br><span class="line">        method: &quot;post&quot;,</span><br><span class="line">        data: this.$http.adornData(this.category, false)</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        this.$message(&#123;</span><br><span class="line">          message: &quot;菜单保存成功&quot;,</span><br><span class="line">          type: &quot;success&quot;</span><br><span class="line">        &#125;);</span><br><span class="line">        //关闭对话框</span><br><span class="line">        this.dialogVisible = false;</span><br><span class="line">        //刷新出新的菜单</span><br><span class="line">        this.getMenus();</span><br><span class="line">        //设置需要默认展开的菜单</span><br><span class="line">        this.expandedKey = [this.category.parentCid];</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    remove(node, data) &#123;</span><br><span class="line">      var ids = [data.catId];</span><br><span class="line">      this.$confirm(`是否删除【$&#123;data.name&#125;】菜单?`, &quot;提示&quot;, &#123;</span><br><span class="line">        confirmButtonText: &quot;确定&quot;,</span><br><span class="line">        cancelButtonText: &quot;取消&quot;,</span><br><span class="line">        type: &quot;warning&quot;</span><br><span class="line">      &#125;)</span><br><span class="line">        .then(() =&gt; &#123;</span><br><span class="line">          this.$http(&#123;</span><br><span class="line">            url: this.$http.adornUrl(&quot;/product/category/delete&quot;),</span><br><span class="line">            method: &quot;post&quot;,</span><br><span class="line">            data: this.$http.adornData(ids, false)</span><br><span class="line">          &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">            this.$message(&#123;</span><br><span class="line">              message: &quot;菜单删除成功&quot;,</span><br><span class="line">              type: &quot;success&quot;</span><br><span class="line">            &#125;);</span><br><span class="line">            //刷新出新的菜单</span><br><span class="line">            this.getMenus();</span><br><span class="line">            //设置需要默认展开的菜单</span><br><span class="line">            this.expandedKey = [node.parent.data.catId];</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(() =&gt; &#123;&#125;);</span><br><span class="line">      console.log(&quot;remove&quot;, node, data);</span><br><span class="line">    &#125;,</span><br><span class="line">    getMenus() &#123;</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(&quot;/product/category/menu&quot;),</span><br><span class="line">        method: &quot;get&quot;</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        this.menus = data.data;</span><br><span class="line">        console.log(&quot;菜单=========&quot;, data.data);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  activated() &#123;</span><br><span class="line">    this.getMenus();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h4 id="拖拽功能完成"><a href="#拖拽功能完成" class="headerlink" title="拖拽功能完成"></a>拖拽功能完成</h4><p>1.后端代码增加接口 CategoryController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量更新菜单排序</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/update/sort&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">updateSort</span><span class="params">(<span class="meta">@RequestBody</span> CategoryEntity[] category)</span> &#123;</span><br><span class="line">        categoryService.updateBatchById(Arrays.asList(category));</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>2.单行修改频繁调用不够友好，需要使用按钮进行批量修改。单行提交代码省略。</p>
<h4 id="最终菜单页面完成代码效果"><a href="#最终菜单页面完成代码效果" class="headerlink" title="最终菜单页面完成代码效果"></a>最终菜单页面完成代码效果</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;el-switch</span><br><span class="line">      v-model=&quot;draggable&quot;</span><br><span class="line">      active-text=&quot;开启拖拽&quot;</span><br><span class="line">      inactive-text=&quot;关闭拖拽&quot;</span><br><span class="line">    &gt;&lt;/el-switch&gt;</span><br><span class="line">    &lt;el-button v-if=&quot;draggable&quot; @click=&quot;batchSave&quot;&gt;批量保存&lt;/el-button&gt;</span><br><span class="line">    &lt;el-button type=&quot;danger&quot; @click=&quot;batchDelete&quot;&gt;批量删除&lt;/el-button&gt;</span><br><span class="line">    &lt;el-tree</span><br><span class="line">      :data=&quot;menus&quot;</span><br><span class="line">      :props=&quot;defaultProps&quot;</span><br><span class="line">      :expand-on-click-node=&quot;false&quot;</span><br><span class="line">      show-checkbox</span><br><span class="line">      node-key=&quot;catId&quot;</span><br><span class="line">      :default-expanded-keys=&quot;expandedKey&quot;</span><br><span class="line">      :draggable=&quot;draggable&quot;</span><br><span class="line">      :allow-drop=&quot;allowDrop&quot;</span><br><span class="line">      @node-drop=&quot;handleDrop&quot;</span><br><span class="line">      ref=&quot;menuTree&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;span class=&quot;custom-tree-node&quot; slot-scope=&quot;&#123; node, data &#125;&quot;&gt;</span><br><span class="line">        &lt;span&gt;&#123;&#123; node.label &#125;&#125;&lt;/span&gt;</span><br><span class="line">        &lt;span&gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            v-if=&quot;node.level &lt;= 2&quot;</span><br><span class="line">            type=&quot;text&quot;</span><br><span class="line">            size=&quot;mini&quot;</span><br><span class="line">            @click=&quot;() =&gt; append(data)&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            Append</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line">          &lt;el-button type=&quot;text&quot; size=&quot;mini&quot; @click=&quot;edit(data)&quot;</span><br><span class="line">            &gt;edit&lt;/el-button</span><br><span class="line">          &gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            v-if=&quot;node.childNodes.length == 0&quot;</span><br><span class="line">            type=&quot;text&quot;</span><br><span class="line">            size=&quot;mini&quot;</span><br><span class="line">            @click=&quot;() =&gt; remove(node, data)&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            Delete</span><br><span class="line">          &lt;/el-button&gt;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">      &lt;/span&gt;&lt;/el-tree</span><br><span class="line">    &gt;</span><br><span class="line">    &lt;el-dialog</span><br><span class="line">      :title=&quot;title&quot;</span><br><span class="line">      :visible.sync=&quot;dialogVisible&quot;</span><br><span class="line">      width=&quot;30%&quot;</span><br><span class="line">      :close-on-click-modal=&quot;false&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;el-form :model=&quot;category&quot;&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;分类名称&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;category.name&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;图标&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;category.icon&quot; autocomplete=&quot;off&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;计量单位&quot;&gt;</span><br><span class="line">          &lt;el-input</span><br><span class="line">            v-model=&quot;category.productUnit&quot;</span><br><span class="line">            autocomplete=&quot;off&quot;</span><br><span class="line">          &gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">      &lt;span slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">        &lt;el-button @click=&quot;dialogVisible = false&quot;&gt;取 消&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button type=&quot;primary&quot; @click=&quot;submitData&quot;&gt;确 定&lt;/el-button&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      pCid: [],</span><br><span class="line">      updateNodes: [],</span><br><span class="line">      draggable: false,</span><br><span class="line">      maxLevel: 0,</span><br><span class="line">      title: &quot;&quot;,</span><br><span class="line">      dialogType: &quot;&quot;, //edit,add</span><br><span class="line">      category: &#123;</span><br><span class="line">        name: &quot;&quot;,</span><br><span class="line">        parentCid: 0,</span><br><span class="line">        catLevel: 0,</span><br><span class="line">        showStatus: 1,</span><br><span class="line">        sort: 0,</span><br><span class="line">        productUnit: &quot;&quot;,</span><br><span class="line">        icon: &quot;&quot;,</span><br><span class="line">        catId: null</span><br><span class="line">      &#125;,</span><br><span class="line">      dialogVisible: false,</span><br><span class="line">      menus: [],</span><br><span class="line">      expandedKey: [],</span><br><span class="line">      defaultProps: &#123;</span><br><span class="line">        children: &quot;children&quot;,</span><br><span class="line">        label: &quot;name&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    // 菜单批量处理 start =======================================================</span><br><span class="line">    batchDelete() &#123;</span><br><span class="line">      let catIds = [];</span><br><span class="line">      let checkedNodes = this.$refs.menuTree.getCheckedNodes();</span><br><span class="line">      console.log(&quot;被选中的元素&quot;, checkedNodes);</span><br><span class="line">      for (let i = 0; i &lt; checkedNodes.length; i++) &#123;</span><br><span class="line">        catIds.push(checkedNodes[i].catId);</span><br><span class="line">      &#125;</span><br><span class="line">      this.$confirm(`是否批量删除【$&#123;catIds&#125;】菜单?`, &quot;提示&quot;, &#123;</span><br><span class="line">        confirmButtonText: &quot;确定&quot;,</span><br><span class="line">        cancelButtonText: &quot;取消&quot;,</span><br><span class="line">        type: &quot;warning&quot;</span><br><span class="line">      &#125;)</span><br><span class="line">        .then(() =&gt; &#123;</span><br><span class="line">          this.$http(&#123;</span><br><span class="line">            url: this.$http.adornUrl(&quot;/product/category/delete&quot;),</span><br><span class="line">            method: &quot;post&quot;,</span><br><span class="line">            data: this.$http.adornData(catIds, false)</span><br><span class="line">          &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">            this.$message(&#123;</span><br><span class="line">              message: &quot;菜单批量删除成功&quot;,</span><br><span class="line">              type: &quot;success&quot;</span><br><span class="line">            &#125;);</span><br><span class="line">            this.getMenus();</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(() =&gt; &#123;&#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    batchSave() &#123;</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(&quot;/product/category/update/sort&quot;),</span><br><span class="line">        method: &quot;post&quot;,</span><br><span class="line">        data: this.$http.adornData(this.updateNodes, false)</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        this.$message(&#123;</span><br><span class="line">          message: &quot;菜单顺序等修改成功&quot;,</span><br><span class="line">          type: &quot;success&quot;</span><br><span class="line">        &#125;);</span><br><span class="line">        //刷新出新的菜单</span><br><span class="line">        this.getMenus();</span><br><span class="line">        //设置需要默认展开的菜单</span><br><span class="line">        this.expandedKey = this.pCid;</span><br><span class="line">        this.updateNodes = [];</span><br><span class="line">        this.maxLevel = 0;</span><br><span class="line">        // this.pCid = 0;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 菜单批量处理 end =======================================================</span><br><span class="line">    // 菜单拖拽 start =======================================================</span><br><span class="line">    handleDrop(draggingNode, dropNode, dropType, ev) &#123;</span><br><span class="line">      console.log(&quot;handleDrop: &quot;, draggingNode, dropNode, dropType);</span><br><span class="line">      //1、当前节点最新的父节点id</span><br><span class="line">      let pCid = 0;</span><br><span class="line">      let siblings = null;</span><br><span class="line">      if (dropType == &quot;before&quot; || dropType == &quot;after&quot;) &#123;</span><br><span class="line">        pCid =</span><br><span class="line">          dropNode.parent.data.catId == undefined</span><br><span class="line">            ? 0</span><br><span class="line">            : dropNode.parent.data.catId;</span><br><span class="line">        siblings = dropNode.parent.childNodes;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        pCid = dropNode.data.catId;</span><br><span class="line">        siblings = dropNode.childNodes;</span><br><span class="line">      &#125;</span><br><span class="line">      this.pCid.push(pCid);</span><br><span class="line">      //2、当前拖拽节点的最新顺序，</span><br><span class="line">      for (let i = 0; i &lt; siblings.length; i++) &#123;</span><br><span class="line">        if (siblings[i].data.catId == draggingNode.data.catId) &#123;</span><br><span class="line">          //如果遍历的是当前正在拖拽的节点</span><br><span class="line">          let catLevel = draggingNode.level;</span><br><span class="line">          if (siblings[i].level != draggingNode.level) &#123;</span><br><span class="line">            //当前节点的层级发生变化</span><br><span class="line">            catLevel = siblings[i].level;</span><br><span class="line">            //修改他子节点的层级</span><br><span class="line">            this.updateChildNodeLevel(siblings[i]);</span><br><span class="line">          &#125;</span><br><span class="line">          this.updateNodes.push(&#123;</span><br><span class="line">            catId: siblings[i].data.catId,</span><br><span class="line">            sort: i,</span><br><span class="line">            parentCid: pCid,</span><br><span class="line">            catLevel: catLevel</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          this.updateNodes.push(&#123; catId: siblings[i].data.catId, sort: i &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      //3、当前拖拽节点的最新层级</span><br><span class="line">      console.log(&quot;updateNodes&quot;, this.updateNodes);</span><br><span class="line">    &#125;,</span><br><span class="line">    updateChildNodeLevel(node) &#123;</span><br><span class="line">      if (node.childNodes.length &gt; 0) &#123;</span><br><span class="line">        for (let i = 0; i &lt; node.childNodes.length; i++) &#123;</span><br><span class="line">          var cNode = node.childNodes[i].data;</span><br><span class="line">          this.updateNodes.push(&#123;</span><br><span class="line">            catId: cNode.catId,</span><br><span class="line">            catLevel: node.childNodes[i].level</span><br><span class="line">          &#125;);</span><br><span class="line">          this.updateChildNodeLevel(node.childNodes[i]);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    allowDrop(draggingNode, dropNode, type) &#123;</span><br><span class="line">      //1、被拖动的当前节点以及所在的父节点总层数不能大于3</span><br><span class="line"></span><br><span class="line">      //1）、被拖动的当前节点总层数</span><br><span class="line">      console.log(&quot;allowDrop:&quot;, draggingNode, dropNode, type);</span><br><span class="line">      //</span><br><span class="line">      this.countNodeLevel(draggingNode);</span><br><span class="line">      //当前正在拖动的节点+父节点所在的深度不大于3即可</span><br><span class="line">      let deep = Math.abs(this.maxLevel - draggingNode.level) + 1;</span><br><span class="line">      console.log(&quot;深度：&quot;, deep);</span><br><span class="line"></span><br><span class="line">      //   this.maxLevel</span><br><span class="line">      if (type == &quot;inner&quot;) &#123;</span><br><span class="line">        // console.log(</span><br><span class="line">        //   `this.maxLevel：$&#123;this.maxLevel&#125;；draggingNode.data.catLevel：$&#123;draggingNode.data.catLevel&#125;；dropNode.level：$&#123;dropNode.level&#125;`</span><br><span class="line">        // );</span><br><span class="line">        return deep + dropNode.level &lt;= 3;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        return deep + dropNode.parent.level &lt;= 3;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    countNodeLevel(node) &#123;</span><br><span class="line">      //找到所有子节点，求出最大深度</span><br><span class="line">      if (node.childNodes != null &amp;&amp; node.childNodes.length &gt; 0) &#123;</span><br><span class="line">        for (let i = 0; i &lt; node.childNodes.length; i++) &#123;</span><br><span class="line">          if (node.childNodes[i].level &gt; this.maxLevel) &#123;</span><br><span class="line">            this.maxLevel = node.childNodes[i].level;</span><br><span class="line">          &#125;</span><br><span class="line">          this.countNodeLevel(node.childNodes[i]);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    // 菜单拖拽 end =======================================================</span><br><span class="line">    submitData() &#123;</span><br><span class="line">      if (this.dialogType == &quot;add&quot;) &#123;</span><br><span class="line">        this.addCategory();</span><br><span class="line">      &#125;</span><br><span class="line">      if (this.dialogType == &quot;edit&quot;) &#123;</span><br><span class="line">        this.editCategory();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    edit(data) &#123;</span><br><span class="line">      console.log(&quot;要修改的数据&quot;, data);</span><br><span class="line">      this.dialogType = &quot;edit&quot;;</span><br><span class="line">      this.title = &quot;修改分类&quot;;</span><br><span class="line">      this.dialogVisible = true;</span><br><span class="line"></span><br><span class="line">      //发送请求获取当前节点最新的数据</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(`/product/category/info/$&#123;data.catId&#125;`),</span><br><span class="line">        method: &quot;get&quot;</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        //请求成功</span><br><span class="line">        console.log(&quot;要回显的数据&quot;, data);</span><br><span class="line">        this.category.name = data.data.name;</span><br><span class="line">        this.category.catId = data.data.catId;</span><br><span class="line">        this.category.icon = data.data.icon;</span><br><span class="line">        this.category.productUnit = data.data.productUnit;</span><br><span class="line">        this.category.parentCid = data.data.parentCid;</span><br><span class="line">        this.category.catLevel = data.data.catLevel;</span><br><span class="line">        this.category.sort = data.data.sort;</span><br><span class="line">        this.category.showStatus = data.data.showStatus;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    //修改三级分类数据</span><br><span class="line">    editCategory() &#123;</span><br><span class="line">      var &#123; catId, name, icon, productUnit &#125; = this.category;</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(&quot;/product/category/update&quot;),</span><br><span class="line">        method: &quot;post&quot;,</span><br><span class="line">        data: this.$http.adornData(&#123; catId, name, icon, productUnit &#125;, false)</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        this.$message(&#123;</span><br><span class="line">          message: &quot;菜单修改成功&quot;,</span><br><span class="line">          type: &quot;success&quot;</span><br><span class="line">        &#125;);</span><br><span class="line">        //关闭对话框</span><br><span class="line">        this.dialogVisible = false;</span><br><span class="line">        //刷新出新的菜单</span><br><span class="line">        this.getMenus();</span><br><span class="line">        //设置需要默认展开的菜单</span><br><span class="line">        this.expandedKey = [this.category.parentCid];</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    append(data) &#123;</span><br><span class="line">      console.log(&quot;append&quot;, data);</span><br><span class="line">      this.dialogType = &quot;add&quot;;</span><br><span class="line">      this.title = &quot;添加分类&quot;;</span><br><span class="line">      this.dialogVisible = true;</span><br><span class="line">      this.category.parentCid = data.catId;</span><br><span class="line">      this.category.catLevel = data.catLevel * 1 + 1;</span><br><span class="line">      this.category.catId = null;</span><br><span class="line">      this.category.name = &quot;&quot;;</span><br><span class="line">      this.category.icon = &quot;&quot;;</span><br><span class="line">      this.category.productUnit = &quot;&quot;;</span><br><span class="line">      this.category.sort = 0;</span><br><span class="line">      this.category.showStatus = 1;</span><br><span class="line">    &#125;,</span><br><span class="line">    //添加三级分类</span><br><span class="line">    addCategory() &#123;</span><br><span class="line">      console.log(&quot;提交的三级分类数据&quot;, this.category);</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(&quot;/product/category/save&quot;),</span><br><span class="line">        method: &quot;post&quot;,</span><br><span class="line">        data: this.$http.adornData(this.category, false)</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        this.$message(&#123;</span><br><span class="line">          message: &quot;菜单保存成功&quot;,</span><br><span class="line">          type: &quot;success&quot;</span><br><span class="line">        &#125;);</span><br><span class="line">        //关闭对话框</span><br><span class="line">        this.dialogVisible = false;</span><br><span class="line">        //刷新出新的菜单</span><br><span class="line">        this.getMenus();</span><br><span class="line">        //设置需要默认展开的菜单</span><br><span class="line">        this.expandedKey = [this.category.parentCid];</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    remove(node, data) &#123;</span><br><span class="line">      var ids = [data.catId];</span><br><span class="line">      this.$confirm(`是否删除【$&#123;data.name&#125;】菜单?`, &quot;提示&quot;, &#123;</span><br><span class="line">        confirmButtonText: &quot;确定&quot;,</span><br><span class="line">        cancelButtonText: &quot;取消&quot;,</span><br><span class="line">        type: &quot;warning&quot;</span><br><span class="line">      &#125;)</span><br><span class="line">        .then(() =&gt; &#123;</span><br><span class="line">          this.$http(&#123;</span><br><span class="line">            url: this.$http.adornUrl(&quot;/product/category/delete&quot;),</span><br><span class="line">            method: &quot;post&quot;,</span><br><span class="line">            data: this.$http.adornData(ids, false)</span><br><span class="line">          &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">            this.$message(&#123;</span><br><span class="line">              message: &quot;菜单删除成功&quot;,</span><br><span class="line">              type: &quot;success&quot;</span><br><span class="line">            &#125;);</span><br><span class="line">            //刷新出新的菜单</span><br><span class="line">            this.getMenus();</span><br><span class="line">            //设置需要默认展开的菜单</span><br><span class="line">            this.expandedKey = [node.parent.data.catId];</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(() =&gt; &#123;&#125;);</span><br><span class="line">      console.log(&quot;remove&quot;, node, data);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 查询菜单</span><br><span class="line">    getMenus() &#123;</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(&quot;/product/category/menu&quot;),</span><br><span class="line">        method: &quot;get&quot;</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        this.menus = data.data;</span><br><span class="line">        console.log(&quot;菜单=========&quot;, data.data);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  activated() &#123;</span><br><span class="line">    this.getMenus();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="品牌管理"><a href="#品牌管理" class="headerlink" title="品牌管理"></a>品牌管理</h3><h4 id="使用逆向工程的前后端代码"><a href="#使用逆向工程的前后端代码" class="headerlink" title="使用逆向工程的前后端代码"></a>使用逆向工程的前后端代码</h4><p>1.在菜单管理中在商品服务下生成一个品牌管理的菜单，菜单路径为product&#x2F;brand</p>
<p>2.使用逆向生成代码的两个文件 brand.vue 和 brand-add-or-update.vue 文件放到product 文件夹下。</p>
<p>3.由于做了权限设置，所以进入&#x2F;utils&#x2F;index.js 文件夹下修改 isAuth 方法的返回值一直为true。</p>
<h4 id="效果优化与快速显示开关"><a href="#效果优化与快速显示开关" class="headerlink" title="效果优化与快速显示开关"></a>效果优化与快速显示开关</h4><h5 id="关闭ESLint-语法检查"><a href="#关闭ESLint-语法检查" class="headerlink" title="关闭ESLint 语法检查"></a>关闭ESLint 语法检查</h5><p>打开build文件夹下的webpack.base.conf.js，然后注释调createLintingRule中的方法体。</p>
<p>1.优化brand.vue 之后的代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;mod-config&quot;&gt;</span><br><span class="line">    &lt;el-form</span><br><span class="line">      :inline=&quot;true&quot;</span><br><span class="line">      :model=&quot;dataForm&quot;</span><br><span class="line">      @keyup.enter.native=&quot;getDataList()&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;el-form-item&gt;</span><br><span class="line">        &lt;el-input</span><br><span class="line">          v-model=&quot;dataForm.key&quot;</span><br><span class="line">          placeholder=&quot;参数名&quot;</span><br><span class="line">          clearable</span><br><span class="line">        &gt;&lt;/el-input&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item&gt;</span><br><span class="line">        &lt;el-button @click=&quot;getDataList()&quot;&gt;查询&lt;/el-button&gt;</span><br><span class="line">        &lt;el-button</span><br><span class="line">          v-if=&quot;isAuth(&#x27;product:brand:save&#x27;)&quot;</span><br><span class="line">          type=&quot;primary&quot;</span><br><span class="line">          @click=&quot;addOrUpdateHandle()&quot;</span><br><span class="line">          &gt;新增&lt;/el-button</span><br><span class="line">        &gt;</span><br><span class="line">        &lt;el-button</span><br><span class="line">          v-if=&quot;isAuth(&#x27;product:brand:delete&#x27;)&quot;</span><br><span class="line">          type=&quot;danger&quot;</span><br><span class="line">          @click=&quot;deleteHandle()&quot;</span><br><span class="line">          :disabled=&quot;dataListSelections.length &lt;= 0&quot;</span><br><span class="line">          &gt;批量删除&lt;/el-button</span><br><span class="line">        &gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">    &lt;/el-form&gt;</span><br><span class="line">    &lt;el-table</span><br><span class="line">      :data=&quot;dataList&quot;</span><br><span class="line">      border</span><br><span class="line">      v-loading=&quot;dataListLoading&quot;</span><br><span class="line">      @selection-change=&quot;selectionChangeHandle&quot;</span><br><span class="line">      style=&quot;width: 100%;&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;el-table-column</span><br><span class="line">        type=&quot;selection&quot;</span><br><span class="line">        header-align=&quot;center&quot;</span><br><span class="line">        align=&quot;center&quot;</span><br><span class="line">        width=&quot;50&quot;</span><br><span class="line">      &gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column</span><br><span class="line">        prop=&quot;brandId&quot;</span><br><span class="line">        header-align=&quot;center&quot;</span><br><span class="line">        align=&quot;center&quot;</span><br><span class="line">        label=&quot;品牌id&quot;</span><br><span class="line">      &gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column</span><br><span class="line">        prop=&quot;name&quot;</span><br><span class="line">        header-align=&quot;center&quot;</span><br><span class="line">        align=&quot;center&quot;</span><br><span class="line">        label=&quot;品牌名&quot;</span><br><span class="line">      &gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column</span><br><span class="line">        prop=&quot;logo&quot;</span><br><span class="line">        header-align=&quot;center&quot;</span><br><span class="line">        align=&quot;center&quot;</span><br><span class="line">        label=&quot;品牌logo地址&quot;</span><br><span class="line">      &gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column</span><br><span class="line">        prop=&quot;descript&quot;</span><br><span class="line">        header-align=&quot;center&quot;</span><br><span class="line">        align=&quot;center&quot;</span><br><span class="line">        label=&quot;介绍&quot;</span><br><span class="line">      &gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column</span><br><span class="line">        prop=&quot;showStatus&quot;</span><br><span class="line">        header-align=&quot;center&quot;</span><br><span class="line">        align=&quot;center&quot;</span><br><span class="line">        label=&quot;显示状态&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &lt;el-switch</span><br><span class="line">            v-model=&quot;scope.row.showStatus&quot;</span><br><span class="line">            active-color=&quot;#13ce66&quot;</span><br><span class="line">            inactive-color=&quot;#ff4949&quot;</span><br><span class="line">            :active-value=&quot;1&quot;</span><br><span class="line">            :inactive-value=&quot;0&quot;</span><br><span class="line">            @change=&quot;updateBrandStatus(scope.row)&quot;</span><br><span class="line">          &gt;&lt;/el-switch&gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column</span><br><span class="line">        prop=&quot;firstLetter&quot;</span><br><span class="line">        header-align=&quot;center&quot;</span><br><span class="line">        align=&quot;center&quot;</span><br><span class="line">        label=&quot;检索首字母&quot;</span><br><span class="line">      &gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column</span><br><span class="line">        prop=&quot;sort&quot;</span><br><span class="line">        header-align=&quot;center&quot;</span><br><span class="line">        align=&quot;center&quot;</span><br><span class="line">        label=&quot;排序&quot;</span><br><span class="line">      &gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">      &lt;el-table-column</span><br><span class="line">        fixed=&quot;right&quot;</span><br><span class="line">        header-align=&quot;center&quot;</span><br><span class="line">        align=&quot;center&quot;</span><br><span class="line">        width=&quot;150&quot;</span><br><span class="line">        label=&quot;操作&quot;</span><br><span class="line">      &gt;</span><br><span class="line">        &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            type=&quot;text&quot;</span><br><span class="line">            size=&quot;small&quot;</span><br><span class="line">            @click=&quot;addOrUpdateHandle(scope.row.brandId)&quot;</span><br><span class="line">            &gt;修改&lt;/el-button</span><br><span class="line">          &gt;</span><br><span class="line">          &lt;el-button</span><br><span class="line">            type=&quot;text&quot;</span><br><span class="line">            size=&quot;small&quot;</span><br><span class="line">            @click=&quot;deleteHandle(scope.row.brandId)&quot;</span><br><span class="line">            &gt;删除&lt;/el-button</span><br><span class="line">          &gt;</span><br><span class="line">        &lt;/template&gt;</span><br><span class="line">      &lt;/el-table-column&gt;</span><br><span class="line">    &lt;/el-table&gt;</span><br><span class="line">    &lt;el-pagination</span><br><span class="line">      @size-change=&quot;sizeChangeHandle&quot;</span><br><span class="line">      @current-change=&quot;currentChangeHandle&quot;</span><br><span class="line">      :current-page=&quot;pageIndex&quot;</span><br><span class="line">      :page-sizes=&quot;[10, 20, 50, 100]&quot;</span><br><span class="line">      :page-size=&quot;pageSize&quot;</span><br><span class="line">      :total=&quot;totalPage&quot;</span><br><span class="line">      layout=&quot;total, sizes, prev, pager, next, jumper&quot;</span><br><span class="line">    &gt;</span><br><span class="line">    &lt;/el-pagination&gt;</span><br><span class="line">    &lt;!-- 弹窗, 新增 / 修改 --&gt;</span><br><span class="line">    &lt;add-or-update</span><br><span class="line">      v-if=&quot;addOrUpdateVisible&quot;</span><br><span class="line">      ref=&quot;addOrUpdate&quot;</span><br><span class="line">      @refreshDataList=&quot;getDataList&quot;</span><br><span class="line">    &gt;&lt;/add-or-update&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import AddOrUpdate from &quot;./brand-add-or-update&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      dataForm: &#123;</span><br><span class="line">        key: &quot;&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      dataList: [],</span><br><span class="line">      pageIndex: 1,</span><br><span class="line">      pageSize: 10,</span><br><span class="line">      totalPage: 0,</span><br><span class="line">      dataListLoading: false,</span><br><span class="line">      dataListSelections: [],</span><br><span class="line">      addOrUpdateVisible: false</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  components: &#123;</span><br><span class="line">    AddOrUpdate</span><br><span class="line">  &#125;,</span><br><span class="line">  activated() &#123;</span><br><span class="line">    this.getDataList();</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    // 修改显示状态</span><br><span class="line">    updateBrandStatus(data) &#123;</span><br><span class="line">      console.log(&quot;最新信息&quot;, data);</span><br><span class="line">      let &#123; brandId, showStatus &#125; = data;</span><br><span class="line">      //发送请求修改状态</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(&quot;/product/brand/update&quot;),</span><br><span class="line">        method: &quot;post&quot;,</span><br><span class="line">        data: this.$http.adornData(&#123; brandId, showStatus &#125;, false)</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        this.$message(&#123;</span><br><span class="line">          type: &quot;success&quot;,</span><br><span class="line">          message: &quot;状态更新成功&quot;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 获取数据列表</span><br><span class="line">    getDataList() &#123;</span><br><span class="line">      this.dataListLoading = true;</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(&quot;/product/brand/list&quot;),</span><br><span class="line">        method: &quot;get&quot;,</span><br><span class="line">        params: this.$http.adornParams(&#123;</span><br><span class="line">          page: this.pageIndex,</span><br><span class="line">          limit: this.pageSize,</span><br><span class="line">          key: this.dataForm.key</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        if (data &amp;&amp; data.code === 0) &#123;</span><br><span class="line">          this.dataList = data.page.list;</span><br><span class="line">          this.totalPage = data.page.totalCount;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          this.dataList = [];</span><br><span class="line">          this.totalPage = 0;</span><br><span class="line">        &#125;</span><br><span class="line">        this.dataListLoading = false;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 每页数</span><br><span class="line">    sizeChangeHandle(val) &#123;</span><br><span class="line">      this.pageSize = val;</span><br><span class="line">      this.pageIndex = 1;</span><br><span class="line">      this.getDataList();</span><br><span class="line">    &#125;,</span><br><span class="line">    // 当前页</span><br><span class="line">    currentChangeHandle(val) &#123;</span><br><span class="line">      this.pageIndex = val;</span><br><span class="line">      this.getDataList();</span><br><span class="line">    &#125;,</span><br><span class="line">    // 多选</span><br><span class="line">    selectionChangeHandle(val) &#123;</span><br><span class="line">      this.dataListSelections = val;</span><br><span class="line">    &#125;,</span><br><span class="line">    // 新增 / 修改</span><br><span class="line">    addOrUpdateHandle(id) &#123;</span><br><span class="line">      this.addOrUpdateVisible = true;</span><br><span class="line">      this.$nextTick(() =&gt; &#123;</span><br><span class="line">        this.$refs.addOrUpdate.init(id);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 删除</span><br><span class="line">    deleteHandle(id) &#123;</span><br><span class="line">      var ids = id</span><br><span class="line">        ? [id]</span><br><span class="line">        : this.dataListSelections.map(item =&gt; &#123;</span><br><span class="line">            return item.brandId;</span><br><span class="line">          &#125;);</span><br><span class="line">      this.$confirm(</span><br><span class="line">        `确定对[id=$&#123;ids.join(&quot;,&quot;)&#125;]进行[$&#123;id ? &quot;删除&quot; : &quot;批量删除&quot;&#125;]操作?`,</span><br><span class="line">        &quot;提示&quot;,</span><br><span class="line">        &#123;</span><br><span class="line">          confirmButtonText: &quot;确定&quot;,</span><br><span class="line">          cancelButtonText: &quot;取消&quot;,</span><br><span class="line">          type: &quot;warning&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      ).then(() =&gt; &#123;</span><br><span class="line">        this.$http(&#123;</span><br><span class="line">          url: this.$http.adornUrl(&quot;/product/brand/delete&quot;),</span><br><span class="line">          method: &quot;post&quot;,</span><br><span class="line">          data: this.$http.adornData(ids, false)</span><br><span class="line">        &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">          if (data &amp;&amp; data.code === 0) &#123;</span><br><span class="line">            this.$message(&#123;</span><br><span class="line">              message: &quot;操作成功&quot;,</span><br><span class="line">              type: &quot;success&quot;,</span><br><span class="line">              duration: 1500,</span><br><span class="line">              onClose: () =&gt; &#123;</span><br><span class="line">                this.getDataList();</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            this.$message.error(data.msg);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>brand-add-or-update.vue 内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-dialog</span><br><span class="line">    :title=&quot;!dataForm.id ? &#x27;新增&#x27; : &#x27;修改&#x27;&quot;</span><br><span class="line">    :close-on-click-modal=&quot;false&quot;</span><br><span class="line">    :visible.sync=&quot;visible&quot;&gt;</span><br><span class="line">    &lt;el-form :model=&quot;dataForm&quot; :rules=&quot;dataRule&quot; ref=&quot;dataForm&quot; @keyup.enter.native=&quot;dataFormSubmit()&quot; label-width=&quot;140px&quot;&gt;</span><br><span class="line">    &lt;el-form-item label=&quot;品牌名&quot; prop=&quot;name&quot;&gt;</span><br><span class="line">      &lt;el-input v-model=&quot;dataForm.name&quot; placeholder=&quot;品牌名&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line">    &lt;el-form-item label=&quot;品牌logo地址&quot; prop=&quot;logo&quot;&gt;</span><br><span class="line">      &lt;el-input v-model=&quot;dataForm.logo&quot; placeholder=&quot;品牌logo地址&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line">    &lt;el-form-item label=&quot;介绍&quot; prop=&quot;descript&quot;&gt;</span><br><span class="line">      &lt;el-input v-model=&quot;dataForm.descript&quot; placeholder=&quot;介绍&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line">    &lt;el-form-item label=&quot;显示状态&quot; prop=&quot;showStatus&quot;&gt;</span><br><span class="line">        &lt;el-switch</span><br><span class="line">          v-model=&quot;dataForm.showStatus&quot;</span><br><span class="line">          active-color=&quot;#13ce66&quot;</span><br><span class="line">          inactive-color=&quot;#ff4949&quot;</span><br><span class="line">          :active-value=&quot;1&quot;</span><br><span class="line">          :inactive-value=&quot;0&quot;</span><br><span class="line">        &gt;&lt;/el-switch&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">    &lt;el-form-item label=&quot;检索首字母&quot; prop=&quot;firstLetter&quot;&gt;</span><br><span class="line">      &lt;el-input v-model=&quot;dataForm.firstLetter&quot; placeholder=&quot;检索首字母&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line">    &lt;el-form-item label=&quot;排序&quot; prop=&quot;sort&quot;&gt;</span><br><span class="line">      &lt;el-input v-model=&quot;dataForm.sort&quot; placeholder=&quot;排序&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line">    &lt;/el-form&gt;</span><br><span class="line">    &lt;span slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">      &lt;el-button @click=&quot;visible = false&quot;&gt;取消&lt;/el-button&gt;</span><br><span class="line">      &lt;el-button type=&quot;primary&quot; @click=&quot;dataFormSubmit()&quot;&gt;确定&lt;/el-button&gt;</span><br><span class="line">    &lt;/span&gt;</span><br><span class="line">  &lt;/el-dialog&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  export default &#123;</span><br><span class="line">    data () &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        visible: false,</span><br><span class="line">        dataForm: &#123;</span><br><span class="line">          brandId: 0,</span><br><span class="line">          name: &#x27;&#x27;,</span><br><span class="line">          logo: &#x27;&#x27;,</span><br><span class="line">          descript: &#x27;&#x27;,</span><br><span class="line">          showStatus: &#x27;&#x27;,</span><br><span class="line">          firstLetter: &#x27;&#x27;,</span><br><span class="line">          sort: &#x27;&#x27;</span><br><span class="line">        &#125;,</span><br><span class="line">        dataRule: &#123;</span><br><span class="line">          name: [</span><br><span class="line">            &#123; required: true, message: &#x27;品牌名不能为空&#x27;, trigger: &#x27;blur&#x27; &#125;</span><br><span class="line">          ],</span><br><span class="line">          logo: [</span><br><span class="line">            &#123; required: true, message: &#x27;品牌logo地址不能为空&#x27;, trigger: &#x27;blur&#x27; &#125;</span><br><span class="line">          ],</span><br><span class="line">          descript: [</span><br><span class="line">            &#123; required: true, message: &#x27;介绍不能为空&#x27;, trigger: &#x27;blur&#x27; &#125;</span><br><span class="line">          ],</span><br><span class="line">          showStatus: [</span><br><span class="line">            &#123; required: true, message: &#x27;显示状态[0-不显示；1-显示]不能为空&#x27;, trigger: &#x27;blur&#x27; &#125;</span><br><span class="line">          ],</span><br><span class="line">          firstLetter: [</span><br><span class="line">            &#123; required: true, message: &#x27;检索首字母不能为空&#x27;, trigger: &#x27;blur&#x27; &#125;</span><br><span class="line">          ],</span><br><span class="line">          sort: [</span><br><span class="line">            &#123; required: true, message: &#x27;排序不能为空&#x27;, trigger: &#x27;blur&#x27; &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      init (id) &#123;</span><br><span class="line">        this.dataForm.brandId = id || 0</span><br><span class="line">        this.visible = true</span><br><span class="line">        this.$nextTick(() =&gt; &#123;</span><br><span class="line">          this.$refs[&#x27;dataForm&#x27;].resetFields()</span><br><span class="line">          if (this.dataForm.brandId) &#123;</span><br><span class="line">            this.$http(&#123;</span><br><span class="line">              url: this.$http.adornUrl(`/product/brand/info/$&#123;this.dataForm.brandId&#125;`),</span><br><span class="line">              method: &#x27;get&#x27;,</span><br><span class="line">              params: this.$http.adornParams()</span><br><span class="line">            &#125;).then((&#123;data&#125;) =&gt; &#123;</span><br><span class="line">              if (data &amp;&amp; data.code === 0) &#123;</span><br><span class="line">                this.dataForm.name = data.brand.name</span><br><span class="line">                this.dataForm.logo = data.brand.logo</span><br><span class="line">                this.dataForm.descript = data.brand.descript</span><br><span class="line">                this.dataForm.showStatus = data.brand.showStatus</span><br><span class="line">                this.dataForm.firstLetter = data.brand.firstLetter</span><br><span class="line">                this.dataForm.sort = data.brand.sort</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      // 表单提交</span><br><span class="line">      dataFormSubmit () &#123;</span><br><span class="line">        this.$refs[&#x27;dataForm&#x27;].validate((valid) =&gt; &#123;</span><br><span class="line">          if (valid) &#123;</span><br><span class="line">            this.$http(&#123;</span><br><span class="line">              url: this.$http.adornUrl(`/product/brand/$&#123;!this.dataForm.brandId ? &#x27;save&#x27; : &#x27;update&#x27;&#125;`),</span><br><span class="line">              method: &#x27;post&#x27;,</span><br><span class="line">              data: this.$http.adornData(&#123;</span><br><span class="line">                &#x27;brandId&#x27;: this.dataForm.brandId || undefined,</span><br><span class="line">                &#x27;name&#x27;: this.dataForm.name,</span><br><span class="line">                &#x27;logo&#x27;: this.dataForm.logo,</span><br><span class="line">                &#x27;descript&#x27;: this.dataForm.descript,</span><br><span class="line">                &#x27;showStatus&#x27;: this.dataForm.showStatus,</span><br><span class="line">                &#x27;firstLetter&#x27;: this.dataForm.firstLetter,</span><br><span class="line">                &#x27;sort&#x27;: this.dataForm.sort</span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;).then((&#123;data&#125;) =&gt; &#123;</span><br><span class="line">              if (data &amp;&amp; data.code === 0) &#123;</span><br><span class="line">                this.$message(&#123;</span><br><span class="line">                  message: &#x27;操作成功&#x27;,</span><br><span class="line">                  type: &#x27;success&#x27;,</span><br><span class="line">                  duration: 1500,</span><br><span class="line">                  onClose: () =&gt; &#123;</span><br><span class="line">                    this.visible = false</span><br><span class="line">                    this.$emit(&#x27;refreshDataList&#x27;)</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">              &#125; else &#123;</span><br><span class="line">                this.$message.error(data.msg)</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h4 id="云存储开通与使用"><a href="#云存储开通与使用" class="headerlink" title="云存储开通与使用"></a>云存储开通与使用</h4><p>开通阿里云OSS</p>
<h4 id="OSS-整合测试"><a href="#OSS-整合测试" class="headerlink" title="OSS 整合测试"></a>OSS 整合测试</h4><h5 id="普通Maven项目引入"><a href="#普通Maven项目引入" class="headerlink" title="普通Maven项目引入"></a>普通Maven项目引入</h5><p>1.在阿里云平台开通RAM服务，然后在RAM 服务下创建子账号，然后保存生成的AccessKey ID 和 AccessKey Secret 。</p>
<p>2.查看OSS官方文档，引入下面的maven依赖，根据文档示例写一个简单的demo 测试。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun.oss<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-sdk-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.10.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="SpringCloud-Alibaba-OSS-引入"><a href="#SpringCloud-Alibaba-OSS-引入" class="headerlink" title="SpringCloud Alibaba OSS 引入"></a>SpringCloud Alibaba OSS 引入</h5><p>1.打开github 上的 demo示例，<a class="link"   target="_blank" rel="noopener" href="https://github.com/alibaba/aliyun-spring-boot/tree/master/aliyun-spring-boot-samples/aliyun-oss-spring-boot-sample" >https://github.com/alibaba/aliyun-spring-boot/tree/master/aliyun-spring-boot-samples/aliyun-oss-spring-boot-sample<i class="fas fa-external-link-alt"></i></a>.</p>
<p>2.加入以下以下maven依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-oss-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>3.然后在配置文件文件中加入以下配置</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">//</span> <span class="string">application.properties</span></span><br><span class="line"><span class="attr">alibaba.cloud.access-key</span>=<span class="string">your-ak</span></span><br><span class="line"><span class="attr">alibaba.cloud.secret-key</span>=<span class="string">your-sk</span></span><br><span class="line"><span class="attr">alibaba.cloud.oss.endpoint</span>=<span class="string">***</span></span><br></pre></td></tr></table></figure>

<p>4.然后在业务在业务项目中使用以下代码进行OSS客户端注入访问</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">YourService</span> &#123;</span><br><span class="line"> 	<span class="meta">@Autowired</span></span><br><span class="line"> 	<span class="keyword">private</span> OSSClient ossClient;</span><br><span class="line"></span><br><span class="line"> 	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveFile</span><span class="params">()</span> &#123;</span><br><span class="line"> 		<span class="comment">// download file to local</span></span><br><span class="line"> 		ossClient.getObject(<span class="keyword">new</span> <span class="title class_">GetObjectRequest</span>(bucketName, objectName), <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;pathOfYourLocalFile&quot;</span>));</span><br><span class="line"> 	&#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>5.弄一个测试demo</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.aliyun.oss.OSSClient;</span><br><span class="line"><span class="keyword">import</span> com.centersept.supermall.product.service.BrandService;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SuperMallProductApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    OSSClient ossClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;C:\\Users\\qkz-admin\\Pictures&quot;</span> +</span><br><span class="line">                <span class="string">&quot;\\ba4957ffgy1g89ginl2cwj20dw0dw75d.jpg&quot;</span>);</span><br><span class="line">        ossClient.putObject(<span class="string">&quot;center-test&quot;</span>, <span class="string">&quot;ba4957ffgy1g89ginl2cwj20dw0dw75d.jpg&quot;</span>, inputStream);</span><br><span class="line">        ossClient.shutdown();</span><br><span class="line">        System.out.println(<span class="string">&quot;上传完成&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="OSS-获取服务端签名"><a href="#OSS-获取服务端签名" class="headerlink" title="OSS 获取服务端签名"></a>OSS 获取服务端签名</h4><p>1.建立一个新的模块，该模块是引入第三方服务的模块，命名super-mall-TTS</p>
<p>2.maven的pom加入以下内容</p>
<p><strong>注：依赖的springboot的版本号一定要一致。</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.centersept.supermall<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>super-mall-tts<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>super-mall-tts<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>第三方服务模块<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring-cloud.version</span>&gt;</span>Greenwich.SR3<span class="tag">&lt;/<span class="name">spring-cloud.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.centersept.supermall<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>super-mall-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--引入阿里云封装好的cloud oss--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alicloud-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-cloud.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>3.创建bootstrap.properties 文件加入nacos config 的配置。</p>
<p>4.创建一个生成签名的contorller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.aliyun.oss.OSS;</span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.common.utils.BinaryUtil;</span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.model.MatchMode;</span><br><span class="line"><span class="keyword">import</span> com.aliyun.oss.model.PolicyConditions;</span><br><span class="line"><span class="keyword">import</span> com.centersept.supermall.common.utils.R;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedHashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Center_Sept</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/11/19 15:51</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OssController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OSS ossClient;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 端点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.cloud.alicloud.oss.endpoint&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String endpoint;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * bucket</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.cloud.alicloud.oss.bucket&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String bucket;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * access-key</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.cloud.alicloud.access-key&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String accessId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 功能描述：获得上传policy和签名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/oss/policy&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">policy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">host</span> <span class="operator">=</span> <span class="string">&quot;https://&quot;</span> + bucket + <span class="string">&quot;.&quot;</span> + endpoint; <span class="comment">// host的格式为 https:// + bucketname + endpoint</span></span><br><span class="line">        <span class="comment">// callbackUrl为 上传回调服务器的URL，请将下面的IP和Port配置为您自己的真实信息。</span></span><br><span class="line">        <span class="comment">// String callbackUrl = &quot;http://88.88.88.88:8888&quot;;</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">format</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>).format(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="type">String</span> <span class="variable">dir</span> <span class="operator">=</span> format + <span class="string">&quot;/&quot;</span>; <span class="comment">// 用户上传文件时指定的前缀。</span></span><br><span class="line"></span><br><span class="line">        Map&lt;String, String&gt; respMap = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">expireTime</span> <span class="operator">=</span> <span class="number">30</span>;</span><br><span class="line">            <span class="type">long</span> <span class="variable">expireEndTime</span> <span class="operator">=</span> System.currentTimeMillis() + expireTime * <span class="number">1000</span>;</span><br><span class="line">            <span class="comment">// 30 s 超时</span></span><br><span class="line">            <span class="type">Date</span> <span class="variable">expiration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>(expireEndTime);</span><br><span class="line">            <span class="type">PolicyConditions</span> <span class="variable">policyConds</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PolicyConditions</span>();</span><br><span class="line">            policyConds.addConditionItem(PolicyConditions.COND_CONTENT_LENGTH_RANGE, <span class="number">0</span>, <span class="number">1048576000</span>);</span><br><span class="line">            policyConds.addConditionItem(MatchMode.StartWith, PolicyConditions.COND_KEY, dir);</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">postPolicy</span> <span class="operator">=</span> ossClient.generatePostPolicy(expiration, policyConds);</span><br><span class="line">            <span class="type">byte</span>[] binaryData = postPolicy.getBytes(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">encodedPolicy</span> <span class="operator">=</span> BinaryUtil.toBase64String(binaryData);</span><br><span class="line">            <span class="type">String</span> <span class="variable">postSignature</span> <span class="operator">=</span> ossClient.calculatePostSignature(postPolicy);</span><br><span class="line">            respMap = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;String, String&gt;();</span><br><span class="line">            <span class="comment">// access-key</span></span><br><span class="line">            respMap.put(<span class="string">&quot;accessid&quot;</span>, accessId);</span><br><span class="line">            <span class="comment">// 策略</span></span><br><span class="line">            respMap.put(<span class="string">&quot;policy&quot;</span>, encodedPolicy);</span><br><span class="line">            <span class="comment">// 策略签名</span></span><br><span class="line">            respMap.put(<span class="string">&quot;signature&quot;</span>, postSignature);</span><br><span class="line">            <span class="comment">// 用户上传文件时指定的前缀</span></span><br><span class="line">            respMap.put(<span class="string">&quot;dir&quot;</span>, dir);</span><br><span class="line">            <span class="comment">// 主机</span></span><br><span class="line">            respMap.put(<span class="string">&quot;host&quot;</span>, host);</span><br><span class="line">            <span class="comment">// 过期时间</span></span><br><span class="line">            respMap.put(<span class="string">&quot;expire&quot;</span>, String.valueOf(expireEndTime / <span class="number">1000</span>));</span><br><span class="line">            <span class="comment">// respMap.put(&quot;expire&quot;, formatISO8601Date(expiration));</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// Assert.fail(e.getMessage());</span></span><br><span class="line">            System.out.println(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;data&quot;</span>, respMap);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="OSS-前后联调测试上传"><a href="#OSS-前后联调测试上传" class="headerlink" title="OSS 前后联调测试上传"></a>OSS 前后联调测试上传</h4><p>1.引入以下三个文件，放在src&#x2F;components&#x2F;upload 文件夹下。</p>
<p>多文件上传组件 multiUpload.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;el-upload</span><br><span class="line">      action=&quot;http://center-test.oss-cn-beijing.aliyuncs.com&quot;</span><br><span class="line">      :data=&quot;dataObj&quot;</span><br><span class="line">      list-type=&quot;picture-card&quot;</span><br><span class="line">      :file-list=&quot;fileList&quot;</span><br><span class="line">      :before-upload=&quot;beforeUpload&quot;</span><br><span class="line">      :on-remove=&quot;handleRemove&quot;</span><br><span class="line">      :on-success=&quot;handleUploadSuccess&quot;</span><br><span class="line">      :on-preview=&quot;handlePreview&quot;</span><br><span class="line">      :limit=&quot;maxCount&quot;</span><br><span class="line">      :on-exceed=&quot;handleExceed&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;i class=&quot;el-icon-plus&quot;&gt;&lt;/i&gt;</span><br><span class="line">    &lt;/el-upload&gt;</span><br><span class="line">    &lt;el-dialog :visible.sync=&quot;dialogVisible&quot;&gt;</span><br><span class="line">      &lt;img width=&quot;100%&quot; :src=&quot;dialogImageUrl&quot; alt /&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import &#123; policy &#125; from &quot;./policy&quot;;</span><br><span class="line">import &#123; getUUID &#125; from &#x27;@/utils&#x27;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;multiUpload&quot;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    //图片属性数组</span><br><span class="line">    value: Array,</span><br><span class="line">    //最大上传图片数量</span><br><span class="line">    maxCount: &#123;</span><br><span class="line">      type: Number,</span><br><span class="line">      default: 30</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      dataObj: &#123;</span><br><span class="line">        policy: &quot;&quot;,</span><br><span class="line">        signature: &quot;&quot;,</span><br><span class="line">        key: &quot;&quot;,</span><br><span class="line">        ossaccessKeyId: &quot;&quot;,</span><br><span class="line">        dir: &quot;&quot;,</span><br><span class="line">        host: &quot;&quot;,</span><br><span class="line">        uuid: &quot;&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      dialogVisible: false,</span><br><span class="line">      dialogImageUrl: null</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    fileList() &#123;</span><br><span class="line">      let fileList = [];</span><br><span class="line">      for (let i = 0; i &lt; this.value.length; i++) &#123;</span><br><span class="line">        fileList.push(&#123; url: this.value[i] &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      return fileList;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted() &#123;&#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    emitInput(fileList) &#123;</span><br><span class="line">      let value = [];</span><br><span class="line">      for (let i = 0; i &lt; fileList.length; i++) &#123;</span><br><span class="line">        value.push(fileList[i].url);</span><br><span class="line">      &#125;</span><br><span class="line">      this.$emit(&quot;input&quot;, value);</span><br><span class="line">    &#125;,</span><br><span class="line">    handleRemove(file, fileList) &#123;</span><br><span class="line">      this.emitInput(fileList);</span><br><span class="line">    &#125;,</span><br><span class="line">    handlePreview(file) &#123;</span><br><span class="line">      this.dialogVisible = true;</span><br><span class="line">      this.dialogImageUrl = file.url;</span><br><span class="line">    &#125;,</span><br><span class="line">    beforeUpload(file) &#123;</span><br><span class="line">      let _self = this;</span><br><span class="line">      return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">        policy()</span><br><span class="line">          .then(response =&gt; &#123;</span><br><span class="line">            console.log(&quot;这是什么$&#123;filename&#125;&quot;);</span><br><span class="line">            _self.dataObj.policy = response.data.policy;</span><br><span class="line">            _self.dataObj.signature = response.data.signature;</span><br><span class="line">            _self.dataObj.ossaccessKeyId = response.data.accessid;</span><br><span class="line">            _self.dataObj.key = response.data.dir + &quot;/&quot;+getUUID()+&quot;_$&#123;filename&#125;&quot;;</span><br><span class="line">            _self.dataObj.dir = response.data.dir;</span><br><span class="line">            _self.dataObj.host = response.data.host;</span><br><span class="line">            resolve(true);</span><br><span class="line">          &#125;)</span><br><span class="line">          .catch(err =&gt; &#123;</span><br><span class="line">            console.log(&quot;出错了...&quot;,err)</span><br><span class="line">            reject(false);</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    handleUploadSuccess(res, file) &#123;</span><br><span class="line">      this.fileList.push(&#123;</span><br><span class="line">        name: file.name,</span><br><span class="line">        // url: this.dataObj.host + &quot;/&quot; + this.dataObj.dir + &quot;/&quot; + file.name； 替换$&#123;filename&#125;为真正的文件名</span><br><span class="line">        url: this.dataObj.host + &quot;/&quot; + this.dataObj.key.replace(&quot;$&#123;filename&#125;&quot;,file.name)</span><br><span class="line">      &#125;);</span><br><span class="line">      this.emitInput(this.fileList);</span><br><span class="line">    &#125;,</span><br><span class="line">    handleExceed(files, fileList) &#123;</span><br><span class="line">      this.$message(&#123;</span><br><span class="line">        message: &quot;最多只能上传&quot; + this.maxCount + &quot;张图片&quot;,</span><br><span class="line">        type: &quot;warning&quot;,</span><br><span class="line">        duration: 1000</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>请求OSS签名封装脚本 policy.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> http <span class="keyword">from</span> <span class="string">&#x27;@/utils/httpRequest.js&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">policy</span>(<span class="params"></span>) &#123;</span><br><span class="line">   <span class="keyword">return</span>  <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="title function_">http</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>: http.<span class="title function_">adornUrl</span>(<span class="string">&quot;/tts/oss/policy&quot;</span>),</span><br><span class="line">            <span class="attr">method</span>: <span class="string">&quot;get&quot;</span>,</span><br><span class="line">            <span class="attr">params</span>: http.<span class="title function_">adornParams</span>(&#123;&#125;)</span><br><span class="line">        &#125;).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(data);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>单文件上传组件 singleUpload.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt; </span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;el-upload</span><br><span class="line">      action=&quot;http://center-test.oss-cn-beijing.aliyuncs.com&quot;</span><br><span class="line">      :data=&quot;dataObj&quot;</span><br><span class="line">      list-type=&quot;picture&quot;</span><br><span class="line">      :multiple=&quot;false&quot; :show-file-list=&quot;showFileList&quot;</span><br><span class="line">      :file-list=&quot;fileList&quot;</span><br><span class="line">      :before-upload=&quot;beforeUpload&quot;</span><br><span class="line">      :on-remove=&quot;handleRemove&quot;</span><br><span class="line">      :on-success=&quot;handleUploadSuccess&quot;</span><br><span class="line">      :on-preview=&quot;handlePreview&quot;&gt;</span><br><span class="line">      &lt;el-button size=&quot;small&quot; type=&quot;primary&quot;&gt;点击上传&lt;/el-button&gt;</span><br><span class="line">      &lt;div slot=&quot;tip&quot; class=&quot;el-upload__tip&quot;&gt;只能上传jpg/png文件，且不超过10MB&lt;/div&gt;</span><br><span class="line">    &lt;/el-upload&gt;</span><br><span class="line">    &lt;el-dialog :visible.sync=&quot;dialogVisible&quot;&gt;</span><br><span class="line">      &lt;img width=&quot;100%&quot; :src=&quot;fileList[0].url&quot; alt=&quot;&quot;&gt;</span><br><span class="line">    &lt;/el-dialog&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">   import &#123;policy&#125; from &#x27;./policy&#x27;</span><br><span class="line">   import &#123; getUUID &#125; from &#x27;@/utils&#x27;</span><br><span class="line"></span><br><span class="line">  export default &#123;</span><br><span class="line">    name: &#x27;singleUpload&#x27;,</span><br><span class="line">    props: &#123;</span><br><span class="line">      value: String</span><br><span class="line">    &#125;,</span><br><span class="line">    computed: &#123;</span><br><span class="line">      imageUrl() &#123;</span><br><span class="line">        return this.value;</span><br><span class="line">      &#125;,</span><br><span class="line">      imageName() &#123;</span><br><span class="line">        if (this.value != null &amp;&amp; this.value !== &#x27;&#x27;) &#123;</span><br><span class="line">          return this.value.substr(this.value.lastIndexOf(&quot;/&quot;) + 1);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          return null;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      fileList() &#123;</span><br><span class="line">        return [&#123;</span><br><span class="line">          name: this.imageName,</span><br><span class="line">          url: this.imageUrl</span><br><span class="line">        &#125;]</span><br><span class="line">      &#125;,</span><br><span class="line">      showFileList: &#123;</span><br><span class="line">        get: function () &#123;</span><br><span class="line">          return this.value !== null &amp;&amp; this.value !== &#x27;&#x27;&amp;&amp; this.value!==undefined;</span><br><span class="line">        &#125;,</span><br><span class="line">        set: function (newValue) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    data() &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        dataObj: &#123;</span><br><span class="line">          policy: &#x27;&#x27;,</span><br><span class="line">          signature: &#x27;&#x27;,</span><br><span class="line">          key: &#x27;&#x27;,</span><br><span class="line">          ossaccessKeyId: &#x27;&#x27;,</span><br><span class="line">          dir: &#x27;&#x27;,</span><br><span class="line">          host: &#x27;&#x27;,</span><br><span class="line">          // callback:&#x27;&#x27;,</span><br><span class="line">        &#125;,</span><br><span class="line">        dialogVisible: false</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      emitInput(val) &#123;</span><br><span class="line">        this.$emit(&#x27;input&#x27;, val)</span><br><span class="line">      &#125;,</span><br><span class="line">      handleRemove(file, fileList) &#123;</span><br><span class="line">        this.emitInput(&#x27;&#x27;);</span><br><span class="line">      &#125;,</span><br><span class="line">      handlePreview(file) &#123;</span><br><span class="line">        this.dialogVisible = true;</span><br><span class="line">      &#125;,</span><br><span class="line">      beforeUpload(file) &#123;</span><br><span class="line">        let _self = this;</span><br><span class="line">        return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">          policy().then(response =&gt; &#123;</span><br><span class="line">            _self.dataObj.policy = response.data.policy;</span><br><span class="line">            _self.dataObj.signature = response.data.signature;</span><br><span class="line">            _self.dataObj.ossaccessKeyId = response.data.accessid;</span><br><span class="line">            _self.dataObj.key = response.data.dir + &#x27;/&#x27;+getUUID()+&#x27;_$&#123;filename&#125;&#x27;;</span><br><span class="line">            _self.dataObj.dir = response.data.dir;</span><br><span class="line">            _self.dataObj.host = response.data.host;</span><br><span class="line">            resolve(true)</span><br><span class="line">          &#125;).catch(err =&gt; &#123;</span><br><span class="line">            reject(false)</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      handleUploadSuccess(res, file) &#123;</span><br><span class="line">        console.log(&quot;上传成功...&quot;)</span><br><span class="line">        this.showFileList = true;</span><br><span class="line">        this.fileList.pop();</span><br><span class="line">        this.fileList.push(&#123;name: file.name, url: this.dataObj.host + &#x27;/&#x27; + this.dataObj.key.replace(&quot;$&#123;filename&#125;&quot;,file.name) &#125;);</span><br><span class="line">        this.emitInput(this.fileList[0].url);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>2.修改brand-add-or-update.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-dialog</span><br><span class="line">    :title=&quot;!dataForm.id ? &#x27;新增&#x27; : &#x27;修改&#x27;&quot;</span><br><span class="line">    :close-on-click-modal=&quot;false&quot;</span><br><span class="line">    :visible.sync=&quot;visible&quot;&gt;</span><br><span class="line">    &lt;el-form :model=&quot;dataForm&quot; :rules=&quot;dataRule&quot; ref=&quot;dataForm&quot; @keyup.enter.native=&quot;dataFormSubmit()&quot; label-width=&quot;140px&quot;&gt;</span><br><span class="line">    &lt;el-form-item label=&quot;品牌名&quot; prop=&quot;name&quot;&gt;</span><br><span class="line">      &lt;el-input v-model=&quot;dataForm.name&quot; placeholder=&quot;品牌名&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line">    &lt;el-form-item label=&quot;品牌logo地址&quot; prop=&quot;logo&quot;&gt;</span><br><span class="line">     &lt;single-upload v-model=&quot;dataForm.logo&quot;&gt;&lt;/single-upload&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line">    &lt;el-form-item label=&quot;介绍&quot; prop=&quot;descript&quot;&gt;</span><br><span class="line">      &lt;el-input v-model=&quot;dataForm.descript&quot; placeholder=&quot;介绍&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line">    &lt;el-form-item label=&quot;显示状态&quot; prop=&quot;showStatus&quot;&gt;</span><br><span class="line">        &lt;el-switch</span><br><span class="line">          v-model=&quot;dataForm.showStatus&quot;</span><br><span class="line">          active-color=&quot;#13ce66&quot;</span><br><span class="line">          inactive-color=&quot;#ff4949&quot;</span><br><span class="line">          :active-value=&quot;1&quot;</span><br><span class="line">          :inactive-value=&quot;0&quot;</span><br><span class="line">        &gt;&lt;/el-switch&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">    &lt;el-form-item label=&quot;检索首字母&quot; prop=&quot;firstLetter&quot;&gt;</span><br><span class="line">      &lt;el-input v-model=&quot;dataForm.firstLetter&quot; placeholder=&quot;检索首字母&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line">    &lt;el-form-item label=&quot;排序&quot; prop=&quot;sort&quot;&gt;</span><br><span class="line">      &lt;el-input v-model=&quot;dataForm.sort&quot; placeholder=&quot;排序&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">    &lt;/el-form-item&gt;</span><br><span class="line">    &lt;/el-form&gt;</span><br><span class="line">    &lt;span slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">      &lt;el-button @click=&quot;visible = false&quot;&gt;取消&lt;/el-button&gt;</span><br><span class="line">      &lt;el-button type=&quot;primary&quot; @click=&quot;dataFormSubmit()&quot;&gt;确定&lt;/el-button&gt;</span><br><span class="line">    &lt;/span&gt;</span><br><span class="line">  &lt;/el-dialog&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import SingleUpload from &quot;@/components/upload/singleUpload&quot;;</span><br><span class="line">  export default &#123;</span><br><span class="line">    components: &#123; SingleUpload &#125;,</span><br><span class="line">    data () &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        visible: false,</span><br><span class="line">        dataForm: &#123;</span><br><span class="line">          brandId: 0,</span><br><span class="line">          name: &#x27;&#x27;,</span><br><span class="line">          logo: &#x27;&#x27;,</span><br><span class="line">          descript: &#x27;&#x27;,</span><br><span class="line">          showStatus: &#x27;&#x27;,</span><br><span class="line">          firstLetter: &#x27;&#x27;,</span><br><span class="line">          sort: &#x27;&#x27;</span><br><span class="line">        &#125;,</span><br><span class="line">        dataRule: &#123;</span><br><span class="line">          name: [</span><br><span class="line">            &#123; required: true, message: &#x27;品牌名不能为空&#x27;, trigger: &#x27;blur&#x27; &#125;</span><br><span class="line">          ],</span><br><span class="line">          logo: [</span><br><span class="line">            &#123; required: true, message: &#x27;品牌logo地址不能为空&#x27;, trigger: &#x27;blur&#x27; &#125;</span><br><span class="line">          ],</span><br><span class="line">          descript: [</span><br><span class="line">            &#123; required: true, message: &#x27;介绍不能为空&#x27;, trigger: &#x27;blur&#x27; &#125;</span><br><span class="line">          ],</span><br><span class="line">          showStatus: [</span><br><span class="line">            &#123; required: true, message: &#x27;显示状态[0-不显示；1-显示]不能为空&#x27;, trigger: &#x27;blur&#x27; &#125;</span><br><span class="line">          ],</span><br><span class="line">          firstLetter: [</span><br><span class="line">            &#123; required: true, message: &#x27;检索首字母不能为空&#x27;, trigger: &#x27;blur&#x27; &#125;</span><br><span class="line">          ],</span><br><span class="line">          sort: [</span><br><span class="line">            &#123; required: true, message: &#x27;排序不能为空&#x27;, trigger: &#x27;blur&#x27; &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      init (id) &#123;</span><br><span class="line">        this.dataForm.brandId = id || 0</span><br><span class="line">        this.visible = true</span><br><span class="line">        this.$nextTick(() =&gt; &#123;</span><br><span class="line">          this.$refs[&#x27;dataForm&#x27;].resetFields()</span><br><span class="line">          if (this.dataForm.brandId) &#123;</span><br><span class="line">            this.$http(&#123;</span><br><span class="line">              url: this.$http.adornUrl(`/product/brand/info/$&#123;this.dataForm.brandId&#125;`),</span><br><span class="line">              method: &#x27;get&#x27;,</span><br><span class="line">              params: this.$http.adornParams()</span><br><span class="line">            &#125;).then((&#123;data&#125;) =&gt; &#123;</span><br><span class="line">              if (data &amp;&amp; data.code === 0) &#123;</span><br><span class="line">                this.dataForm.name = data.brand.name</span><br><span class="line">                this.dataForm.logo = data.brand.logo</span><br><span class="line">                this.dataForm.descript = data.brand.descript</span><br><span class="line">                this.dataForm.showStatus = data.brand.showStatus</span><br><span class="line">                this.dataForm.firstLetter = data.brand.firstLetter</span><br><span class="line">                this.dataForm.sort = data.brand.sort</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      // 表单提交</span><br><span class="line">      dataFormSubmit () &#123;</span><br><span class="line">        this.$refs[&#x27;dataForm&#x27;].validate((valid) =&gt; &#123;</span><br><span class="line">          if (valid) &#123;</span><br><span class="line">            this.$http(&#123;</span><br><span class="line">              url: this.$http.adornUrl(`/product/brand/$&#123;!this.dataForm.brandId ? &#x27;save&#x27; : &#x27;update&#x27;&#125;`),</span><br><span class="line">              method: &#x27;post&#x27;,</span><br><span class="line">              data: this.$http.adornData(&#123;</span><br><span class="line">                &#x27;brandId&#x27;: this.dataForm.brandId || undefined,</span><br><span class="line">                &#x27;name&#x27;: this.dataForm.name,</span><br><span class="line">                &#x27;logo&#x27;: this.dataForm.logo,</span><br><span class="line">                &#x27;descript&#x27;: this.dataForm.descript,</span><br><span class="line">                &#x27;showStatus&#x27;: this.dataForm.showStatus,</span><br><span class="line">                &#x27;firstLetter&#x27;: this.dataForm.firstLetter,</span><br><span class="line">                &#x27;sort&#x27;: this.dataForm.sort</span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;).then((&#123;data&#125;) =&gt; &#123;</span><br><span class="line">              if (data &amp;&amp; data.code === 0) &#123;</span><br><span class="line">                this.$message(&#123;</span><br><span class="line">                  message: &#x27;操作成功&#x27;,</span><br><span class="line">                  type: &#x27;success&#x27;,</span><br><span class="line">                  duration: 1500,</span><br><span class="line">                  onClose: () =&gt; &#123;</span><br><span class="line">                    this.visible = false</span><br><span class="line">                    this.$emit(&#x27;refreshDataList&#x27;)</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">              &#125; else &#123;</span><br><span class="line">                this.$message.error(data.msg)</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>3.上传操作之后，点击保存，保存上传的路径</p>
<h4 id="表单校验-amp-自定义校验器"><a href="#表单校验-amp-自定义校验器" class="headerlink" title="表单校验&amp;自定义校验器"></a>表单校验&amp;自定义校验器</h4><p>1.修改显示状态，返回后端的值，修改如下</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;显示状态&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;showStatus&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">el-switch</span></span></span><br><span class="line"><span class="tag">         <span class="attr">v-model</span>=<span class="string">&quot;dataForm.showStatus&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">active-color</span>=<span class="string">&quot;#13ce66&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">inactive-color</span>=<span class="string">&quot;#ff4949&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">:active-value</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">:inactive-value</span>=<span class="string">&quot;0&quot;</span></span></span><br><span class="line"><span class="tag">       &gt;</span><span class="tag">&lt;/<span class="name">el-switch</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2.把表格显示的URL地址，转变为显示图片</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-table-column</span></span></span><br><span class="line"><span class="tag">       <span class="attr">prop</span>=<span class="string">&quot;logo&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">header-align</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">align</span>=<span class="string">&quot;center&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">label</span>=<span class="string">&quot;品牌logo地址&quot;</span></span></span><br><span class="line"><span class="tag">     &gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot-scope</span>=<span class="string">&quot;scope&quot;</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!-- &lt;el-image v-if=&quot;scope.row.logo != null &amp;&amp; scope.row.logo != &#x27;&#x27;&quot;</span></span><br><span class="line"><span class="comment">             style=&quot;width: 100px; height: 80px&quot;</span></span><br><span class="line"><span class="comment">             :src=&quot;scope.row.logo&quot;</span></span><br><span class="line"><span class="comment">         fit=&quot;fill&quot;&gt;&lt;/el-image&gt; --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">img</span>  <span class="attr">v-if</span>=<span class="string">&quot;scope.row.logo != null &amp;&amp; scope.row.logo != &#x27;&#x27;&quot;</span> <span class="attr">:src</span>=<span class="string">&quot;scope.row.logo&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 100px; height: 80px&quot;</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">el-table-column</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>3.加入表单验证，修改brand-add-or-upadate.vue，内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-dialog</span><br><span class="line">    :title=&quot;!dataForm.id ? &#x27;新增&#x27; : &#x27;修改&#x27;&quot;</span><br><span class="line">    :close-on-click-modal=&quot;false&quot;</span><br><span class="line">    :visible.sync=&quot;visible&quot;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;el-form</span><br><span class="line">      :model=&quot;dataForm&quot;</span><br><span class="line">      :rules=&quot;dataRule&quot;</span><br><span class="line">      ref=&quot;dataForm&quot;</span><br><span class="line">      @keyup.enter.native=&quot;dataFormSubmit()&quot;</span><br><span class="line">      label-width=&quot;140px&quot;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;el-form-item label=&quot;品牌名&quot; prop=&quot;name&quot;&gt;</span><br><span class="line">        &lt;el-input v-model=&quot;dataForm.name&quot; placeholder=&quot;品牌名&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;品牌logo地址&quot; prop=&quot;logo&quot;&gt;</span><br><span class="line">        &lt;single-upload v-model=&quot;dataForm.logo&quot;&gt;&lt;/single-upload&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;介绍&quot; prop=&quot;descript&quot;&gt;</span><br><span class="line">        &lt;el-input v-model=&quot;dataForm.descript&quot; placeholder=&quot;介绍&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;显示状态&quot; prop=&quot;showStatus&quot;&gt;</span><br><span class="line">        &lt;el-switch</span><br><span class="line">          v-model=&quot;dataForm.showStatus&quot;</span><br><span class="line">          active-color=&quot;#13ce66&quot;</span><br><span class="line">          inactive-color=&quot;#ff4949&quot;</span><br><span class="line">          :active-value=&quot;1&quot;</span><br><span class="line">          :inactive-value=&quot;0&quot;</span><br><span class="line">        &gt;&lt;/el-switch&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;检索首字母&quot; prop=&quot;firstLetter&quot;&gt;</span><br><span class="line">        &lt;el-input</span><br><span class="line">          v-model=&quot;dataForm.firstLetter&quot;</span><br><span class="line">          placeholder=&quot;检索首字母&quot;</span><br><span class="line">        &gt;&lt;/el-input&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">      &lt;el-form-item label=&quot;排序&quot; prop=&quot;sort&quot;&gt;</span><br><span class="line">        &lt;el-input v-model=&quot;dataForm.sort&quot; placeholder=&quot;排序&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">      &lt;/el-form-item&gt;</span><br><span class="line">    &lt;/el-form&gt;</span><br><span class="line">    &lt;span slot=&quot;footer&quot; class=&quot;dialog-footer&quot;&gt;</span><br><span class="line">      &lt;el-button @click=&quot;visible = false&quot;&gt;取消&lt;/el-button&gt;</span><br><span class="line">      &lt;el-button type=&quot;primary&quot; @click=&quot;dataFormSubmit()&quot;&gt;确定&lt;/el-button&gt;</span><br><span class="line">    &lt;/span&gt;</span><br><span class="line">  &lt;/el-dialog&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import SingleUpload from &quot;@/components/upload/singleUpload&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  components: &#123; SingleUpload &#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      visible: false,</span><br><span class="line">      dataForm: &#123;</span><br><span class="line">        brandId: 0,</span><br><span class="line">        name: &quot;&quot;,</span><br><span class="line">        logo: &quot;&quot;,</span><br><span class="line">        descript: &quot;&quot;,</span><br><span class="line">        showStatus: 1,</span><br><span class="line">        firstLetter: &quot;&quot;,</span><br><span class="line">        sort: 0</span><br><span class="line">      &#125;,</span><br><span class="line">      dataRule: &#123;</span><br><span class="line">        name: [&#123; required: true, message: &quot;品牌名不能为空&quot;, trigger: &quot;blur&quot; &#125;],</span><br><span class="line">        logo: [</span><br><span class="line">          &#123; required: true, message: &quot;品牌logo地址不能为空&quot;, trigger: &quot;blur&quot; &#125;</span><br><span class="line">        ],</span><br><span class="line">        descript: [</span><br><span class="line">          &#123; required: true, message: &quot;介绍不能为空&quot;, trigger: &quot;blur&quot; &#125;</span><br><span class="line">        ],</span><br><span class="line">        showStatus: [</span><br><span class="line">          &#123;</span><br><span class="line">            required: true,</span><br><span class="line">            message: &quot;显示状态[0-不显示；1-显示]不能为空&quot;,</span><br><span class="line">            trigger: &quot;blur&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        firstLetter: [</span><br><span class="line">         &#123;</span><br><span class="line">            validator: (rule, value, callback) =&gt; &#123;</span><br><span class="line">              if (value == &quot;&quot;) &#123;</span><br><span class="line">                callback(new Error(&quot;首字母必须填写&quot;));</span><br><span class="line">              &#125; else if (!/^[a-zA-Z]$/.test(value)) &#123;</span><br><span class="line">                callback(new Error(&quot;首字母必须a-z或者A-Z之间&quot;));</span><br><span class="line">              &#125; else &#123;</span><br><span class="line">                callback();</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            trigger: &quot;blur&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        sort: [&#123;</span><br><span class="line">            validator: (rule, value, callback) =&gt; &#123;</span><br><span class="line">              if (value == &quot;&quot;) &#123;</span><br><span class="line">                callback(new Error(&quot;排序字段必须填写&quot;));</span><br><span class="line">              &#125; else if (!Number.isInteger(value) || value&lt;0) &#123;</span><br><span class="line">                callback(new Error(&quot;排序必须是一个大于等于0的整数&quot;));</span><br><span class="line">              &#125; else &#123;</span><br><span class="line">                callback();</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            trigger: &quot;blur&quot;</span><br><span class="line">          &#125;]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    init(id) &#123;</span><br><span class="line">      this.dataForm.brandId = id || 0;</span><br><span class="line">      this.visible = true;</span><br><span class="line">      this.$nextTick(() =&gt; &#123;</span><br><span class="line">        this.$refs[&quot;dataForm&quot;].resetFields();</span><br><span class="line">        if (this.dataForm.brandId) &#123;</span><br><span class="line">          this.$http(&#123;</span><br><span class="line">            url: this.$http.adornUrl(</span><br><span class="line">              `/product/brand/info/$&#123;this.dataForm.brandId&#125;`</span><br><span class="line">            ),</span><br><span class="line">            method: &quot;get&quot;,</span><br><span class="line">            params: this.$http.adornParams()</span><br><span class="line">          &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">            if (data &amp;&amp; data.code === 0) &#123;</span><br><span class="line">              this.dataForm.name = data.brand.name;</span><br><span class="line">              this.dataForm.logo = data.brand.logo;</span><br><span class="line">              this.dataForm.descript = data.brand.descript;</span><br><span class="line">              this.dataForm.showStatus = data.brand.showStatus;</span><br><span class="line">              this.dataForm.firstLetter = data.brand.firstLetter;</span><br><span class="line">              this.dataForm.sort = data.brand.sort;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 表单提交</span><br><span class="line">    dataFormSubmit() &#123;</span><br><span class="line">      this.$refs[&quot;dataForm&quot;].validate(valid =&gt; &#123;</span><br><span class="line">        if (valid) &#123;</span><br><span class="line">          this.$http(&#123;</span><br><span class="line">            url: this.$http.adornUrl(</span><br><span class="line">              `/product/brand/$&#123;!this.dataForm.brandId ? &quot;save&quot; : &quot;update&quot;&#125;`</span><br><span class="line">            ),</span><br><span class="line">            method: &quot;post&quot;,</span><br><span class="line">            data: this.$http.adornData(&#123;</span><br><span class="line">              brandId: this.dataForm.brandId || undefined,</span><br><span class="line">              name: this.dataForm.name,</span><br><span class="line">              logo: this.dataForm.logo,</span><br><span class="line">              descript: this.dataForm.descript,</span><br><span class="line">              showStatus: this.dataForm.showStatus,</span><br><span class="line">              firstLetter: this.dataForm.firstLetter,</span><br><span class="line">              sort: this.dataForm.sort</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">            if (data &amp;&amp; data.code === 0) &#123;</span><br><span class="line">              this.$message(&#123;</span><br><span class="line">                message: &quot;操作成功&quot;,</span><br><span class="line">                type: &quot;success&quot;,</span><br><span class="line">                duration: 1500,</span><br><span class="line">                onClose: () =&gt; &#123;</span><br><span class="line">                  this.visible = false;</span><br><span class="line">                  this.$emit(&quot;refreshDataList&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">              this.$message.error(data.msg);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h4 id="JSR303表单验证"><a href="#JSR303表单验证" class="headerlink" title="JSR303表单验证"></a>JSR303表单验证</h4><p>1.给Bean实体类添加校验注解（在javax.validation.constraints 中），并定义自己的message提示，举个栗子，在BrandEntity.java 中修改。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;pms_brand&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BrandEntity</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 品牌id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@NotNull(message = &quot;修改必须指定品牌id&quot;)</span></span><br><span class="line">    <span class="meta">@Null(message = &quot;新增不能指定id&quot;)</span></span><br><span class="line">    <span class="meta">@TableId</span></span><br><span class="line">    <span class="keyword">private</span> Long brandId;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 品牌名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;品牌名必须提交&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 品牌logo地址</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@URL(message = &quot;logo必须是一个合法的url地址&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String logo;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 介绍</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String descript;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 显示状态[0-不显示；1-显示]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer showStatus;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 检索首字母</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pattern(regexp = &quot;^[a-zA-Z]$&quot;, message = &quot;检索首字母必须是一个字母&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String firstLetter;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 排序</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Min(value = 0, message = &quot;排序必须大于等于0&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer sort;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.在对应的controller的保存接口上加上@Valid注解开启校验，但是返回的是默认的响应，不是我们想要的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">save</span><span class="params">(<span class="meta">@Valid</span> <span class="meta">@RequestBody</span> BrandEntity brand)</span>&#123;</span><br><span class="line">		brandService.save(brand);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>3.自定义校验体，需要在入参中加入BindingResult类型的参数，就可以获取到校验的结果，自定义返回给前端。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">save</span><span class="params">(<span class="meta">@Valid</span> <span class="meta">@RequestBody</span> BrandEntity brand, BindingResult result)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (result.hasErrors()) &#123;</span><br><span class="line">            Map&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">            <span class="comment">//1、获取校验的错误结果</span></span><br><span class="line">            result.getFieldErrors().forEach((item) -&gt; &#123;</span><br><span class="line">                <span class="comment">//FieldError 获取到错误提示</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> item.getDefaultMessage();</span><br><span class="line">                <span class="comment">//获取错误的属性的名字</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">field</span> <span class="operator">=</span> item.getField();</span><br><span class="line">                map.put(field, message);</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">return</span> R.error(<span class="number">400</span>, <span class="string">&quot;提交的数据不合法&quot;</span>).put(<span class="string">&quot;data&quot;</span>, map);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            brandService.save(brand);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>4.也可以使用BindingResultUtils 提供的方法，对入参进行校验。</p>
<h4 id="统一异常处理"><a href="#统一异常处理" class="headerlink" title="统一异常处理"></a>统一异常处理</h4><p>1.为了不增加代码的侵入性，我们可以自定义一个异常类，基于AOP做统一处理。</p>
<p>2.在对应的模块下，创建一个exception包，声明一个统一的异常类型，然后加上@RestControllerAdvice(basePackages &#x3D; “com.atguigu.gulimall.product.controller”)类注解，方法上加入@ExceptionHandler(value &#x3D; MethodArgumentNotValidException.class)对应处理的异常注解，然后在公共模块定义统一的异常代码枚举类。</p>
<p>统一异常类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="comment">//@ResponseBody</span></span><br><span class="line"><span class="comment">//@ControllerAdvice(basePackages = &quot;com.atguigu.gulimall.product.controller&quot;)</span></span><br><span class="line"><span class="meta">@RestControllerAdvice(basePackages = &quot;com.atguigu.gulimall.product.controller&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SupermallExceptionControllerAdvice</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(value = MethodArgumentNotValidException.class)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">handleVaildException</span><span class="params">(MethodArgumentNotValidException e)</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;数据校验出现问题&#123;&#125;，异常类型：&#123;&#125;&quot;</span>, e.getMessage(), e.getClass());</span><br><span class="line">        <span class="type">BindingResult</span> <span class="variable">bindingResult</span> <span class="operator">=</span> e.getBindingResult();</span><br><span class="line"></span><br><span class="line">        Map&lt;String, String&gt; errorMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        bindingResult.getFieldErrors().forEach((fieldError) -&gt; &#123;</span><br><span class="line">            errorMap.put(fieldError.getField(), fieldError.getDefaultMessage());</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> R.error(BizCodeEnume.VAILD_EXCEPTION.getCode(), BizCodeEnume.VAILD_EXCEPTION.getMsg()).put(<span class="string">&quot;data&quot;</span>,</span><br><span class="line">                errorMap);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(value = Throwable.class)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">handleException</span><span class="params">(Throwable throwable)</span> &#123;</span><br><span class="line"></span><br><span class="line">        log.error(<span class="string">&quot;错误：&quot;</span>, throwable);</span><br><span class="line">        <span class="keyword">return</span> R.error(BizCodeEnume.UNKNOW_EXCEPTION.getCode(), BizCodeEnume.UNKNOW_EXCEPTION.getMsg());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>异常代码枚举：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">BizCodeEnume</span> &#123;</span><br><span class="line">    UNKNOW_EXCEPTION(<span class="number">10000</span>,<span class="string">&quot;系统未知异常&quot;</span>),</span><br><span class="line">    VAILD_EXCEPTION(<span class="number">10001</span>,<span class="string">&quot;参数格式校验失败&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> code;</span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">    BizCodeEnume(<span class="type">int</span> code,String msg)&#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMsg</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.最后把controller侵入业务的代码删除调。</p>
<h4 id="JSR303分组校验"><a href="#JSR303分组校验" class="headerlink" title="JSR303分组校验"></a>JSR303分组校验</h4><p>1.定义校验分组接口，接口不需要实现类，仅仅是使用来标识分组。分别定义addGroup.java 和 upGroup.java分组，放到common模块下，放到valid的包下。</p>
<p>2.在bean实体类的字段上的校验注解中加入group属性，使用刚刚定义好的接口类型根据需求填充到group中。如，新增接口应该使用addGroup.class类标识，更新接口使用upGroup.class 标识。举了栗子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 品牌id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@NotNull(message = &quot;修改必须指定品牌id&quot;,groups = &#123;UpdateGroup.class&#125;)</span></span><br><span class="line">    <span class="meta">@Null(message = &quot;新增不能指定id&quot;,groups = &#123;AddGroup.class&#125;)</span></span><br><span class="line">    <span class="meta">@TableId</span></span><br><span class="line">    <span class="keyword">private</span> Long brandId;</span><br></pre></td></tr></table></figure>

<p>3.在对应的controller类上，加上@Validated 注解，开启校验功能，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 保存</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">save</span><span class="params">(<span class="meta">@Validated(&#123;AddGroup.class&#125;)</span> <span class="meta">@RequestBody</span> BrandEntity brand)</span> &#123;</span><br><span class="line">    brandService.save(brand);</span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注：默认没有指定分组的校验注解@NutBlank，在分组校验情况@Validated({AddGroup.class})下不生效。</strong></p>
<h4 id="JSR303自定义校验注解"><a href="#JSR303自定义校验注解" class="headerlink" title="JSR303自定义校验注解"></a>JSR303自定义校验注解</h4><p>1.在common模块引入javax.validation.validation-api  maven依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.validation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>validation-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.1.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2.编写一个自定义的校验注解，在common模块中，valid包下新建一个注解类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Constraint(validatedBy = &#123; ListValueConstraintValidator.class &#125;)</span></span><br><span class="line"><span class="meta">@Target(&#123; METHOD, FIELD, ANNOTATION_TYPE, CONSTRUCTOR, PARAMETER, TYPE_USE &#125;)</span></span><br><span class="line"><span class="meta">@Retention(RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> ListValue &#123;</span><br><span class="line">    String <span class="title function_">message</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&#123;com.centersept.supermall.common.valid.ListValue.message&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    Class&lt;?&gt;[] groups() <span class="keyword">default</span> &#123; &#125;;</span><br><span class="line"></span><br><span class="line">    Class&lt;? <span class="keyword">extends</span> <span class="title class_">Payload</span>&gt;[] payload() <span class="keyword">default</span> &#123; &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span>[] vals() <span class="keyword">default</span> &#123; &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.新建一个ListValueConstraintValidator校验器，该校验器需要实现ConstraintValidator接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ListValueConstraintValidator</span> <span class="keyword">implements</span> <span class="title class_">ConstraintValidator</span>&lt;ListValue,Integer&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Set&lt;Integer&gt; set = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">//初始化方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(ListValue constraintAnnotation)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] vals = constraintAnnotation.vals();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> val : vals) &#123;</span><br><span class="line">            set.add(val);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//判断是否校验成功</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 需要校验的值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValid</span><span class="params">(Integer value, ConstraintValidatorContext context)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> set.contains(value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.根据javax.validation 依赖规范，在resource 文件夹下新建ValidationMessages.properties文件，才能使String message() default “{com.centersept.supermall.common.valid.ListValue.message}”;生效。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">com.centersept.supermall.common.valid.ListValue.message</span>=<span class="string">显示状态参数错误</span></span><br></pre></td></tr></table></figure>

<p>5.修改BrandEntity实体类的showStatus属性注解值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NotNull(groups = &#123;AddGroup.class, UpdateStatusGroup.class&#125;)</span></span><br><span class="line"><span class="meta">@ListValue(vals=&#123;0,1&#125;,groups = &#123;AddGroup.class, UpdateStatusGroup.class&#125;)</span></span><br><span class="line"><span class="keyword">private</span> Integer showStatus;</span><br></pre></td></tr></table></figure>

<p>6.为了只校验在修改状态的时候才判断该校验值，所以我们要重新声明一个请求方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/update/status&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">updateStatus</span><span class="params">(<span class="meta">@Validated(UpdateStatusGroup.class)</span> <span class="meta">@RequestBody</span> BrandEntity brand)</span>&#123;</span><br><span class="line">        brandService.updateById(brand);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>7.最后再修改前端页面的请求地址。</p>
<h4 id="SPU-amp-SKU-amp-规格参数-amp-销售属性"><a href="#SPU-amp-SKU-amp-规格参数-amp-销售属性" class="headerlink" title="SPU&amp;SKU&amp;规格参数&amp;销售属性"></a>SPU&amp;SKU&amp;规格参数&amp;销售属性</h4><p>SPU &#x3D; Standard Product Unit （标准产品单位）<br>SPU是商品信息聚合的最小单位，是一组可复用、易检索的标准化信息的集合，该集合描述了一个产品的特性。<br>通俗点讲，属性值、特性相同的商品就可以称为一个SPU。</p>
<p>例如：<br>iphone4就是一个SPU，与商家，与颜色、款式、套餐都无关。</p>
<p>SKU&#x3D;stock keeping unit(库存量单位)<br>SKU即库存进出计量的单位， 可以是以件、盒、托盘等为单位。<br>SKU是物理上不可分割的最小存货单元。在使用时要根据不同业态，不同管理模式来处理。在服装、鞋类商品中使用最多最普遍。</p>
<p>例如：<br>纺织品中一个SKU通常表示：规格、颜色、款式。</p>
<h3 id="属性分组"><a href="#属性分组" class="headerlink" title="属性分组"></a>属性分组</h3><h4 id="前端组件抽取-amp-父子组件交互"><a href="#前端组件抽取-amp-父子组件交互" class="headerlink" title="前端组件抽取&amp;父子组件交互"></a>前端组件抽取&amp;父子组件交互</h4><p>1.执行提供的sys_menus.sql文件。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `sys_menu`;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `sys_menu` (</span><br><span class="line">  `menu_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `parent_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;父菜单ID，一级菜单为0&#x27;</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;菜单名称&#x27;</span>,</span><br><span class="line">  `url` <span class="type">varchar</span>(<span class="number">200</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;菜单URL&#x27;</span>,</span><br><span class="line">  `perms` <span class="type">varchar</span>(<span class="number">500</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;授权(多个用逗号分隔，如：user:list,user:create)&#x27;</span>,</span><br><span class="line">  `type` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;类型   0：目录   1：菜单   2：按钮&#x27;</span>,</span><br><span class="line">  `icon` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;菜单图标&#x27;</span>,</span><br><span class="line">  `order_num` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;排序&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`menu_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">76</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 COMMENT<span class="operator">=</span><span class="string">&#x27;菜单管理&#x27;</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `sys_menu` ( `menu_id`, `parent_id`, `name`, `url`, `perms`, `type`, `icon`, `order_num` )</span><br><span class="line"><span class="keyword">VALUES</span></span><br><span class="line">	( <span class="number">1</span>, <span class="number">0</span>, <span class="string">&#x27;系统管理&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="string">&#x27;system&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">2</span>, <span class="number">1</span>, <span class="string">&#x27;管理员列表&#x27;</span>, <span class="string">&#x27;sys/user&#x27;</span>, <span class="keyword">NULL</span>, <span class="number">1</span>, <span class="string">&#x27;admin&#x27;</span>, <span class="number">1</span> ),</span><br><span class="line">	( <span class="number">3</span>, <span class="number">1</span>, <span class="string">&#x27;角色管理&#x27;</span>, <span class="string">&#x27;sys/role&#x27;</span>, <span class="keyword">NULL</span>, <span class="number">1</span>, <span class="string">&#x27;role&#x27;</span>, <span class="number">2</span> ),</span><br><span class="line">	( <span class="number">4</span>, <span class="number">1</span>, <span class="string">&#x27;菜单管理&#x27;</span>, <span class="string">&#x27;sys/menu&#x27;</span>, <span class="keyword">NULL</span>, <span class="number">1</span>, <span class="string">&#x27;menu&#x27;</span>, <span class="number">3</span> ),</span><br><span class="line">	( <span class="number">5</span>, <span class="number">1</span>, <span class="string">&#x27;SQL监控&#x27;</span>, <span class="string">&#x27;http://localhost:8080/renren-fast/druid/sql.html&#x27;</span>, <span class="keyword">NULL</span>, <span class="number">1</span>, <span class="string">&#x27;sql&#x27;</span>, <span class="number">4</span> ),</span><br><span class="line">	( <span class="number">6</span>, <span class="number">1</span>, <span class="string">&#x27;定时任务&#x27;</span>, <span class="string">&#x27;job/schedule&#x27;</span>, <span class="keyword">NULL</span>, <span class="number">1</span>, <span class="string">&#x27;job&#x27;</span>, <span class="number">5</span> ),</span><br><span class="line">	( <span class="number">7</span>, <span class="number">6</span>, <span class="string">&#x27;查看&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;sys:schedule:list,sys:schedule:info&#x27;</span>, <span class="number">2</span>, <span class="keyword">NULL</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">8</span>, <span class="number">6</span>, <span class="string">&#x27;新增&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;sys:schedule:save&#x27;</span>, <span class="number">2</span>, <span class="keyword">NULL</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">9</span>, <span class="number">6</span>, <span class="string">&#x27;修改&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;sys:schedule:update&#x27;</span>, <span class="number">2</span>, <span class="keyword">NULL</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">10</span>, <span class="number">6</span>, <span class="string">&#x27;删除&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;sys:schedule:delete&#x27;</span>, <span class="number">2</span>, <span class="keyword">NULL</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">11</span>, <span class="number">6</span>, <span class="string">&#x27;暂停&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;sys:schedule:pause&#x27;</span>, <span class="number">2</span>, <span class="keyword">NULL</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">12</span>, <span class="number">6</span>, <span class="string">&#x27;恢复&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;sys:schedule:resume&#x27;</span>, <span class="number">2</span>, <span class="keyword">NULL</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">13</span>, <span class="number">6</span>, <span class="string">&#x27;立即执行&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;sys:schedule:run&#x27;</span>, <span class="number">2</span>, <span class="keyword">NULL</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">14</span>, <span class="number">6</span>, <span class="string">&#x27;日志列表&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;sys:schedule:log&#x27;</span>, <span class="number">2</span>, <span class="keyword">NULL</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">15</span>, <span class="number">2</span>, <span class="string">&#x27;查看&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;sys:user:list,sys:user:info&#x27;</span>, <span class="number">2</span>, <span class="keyword">NULL</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">16</span>, <span class="number">2</span>, <span class="string">&#x27;新增&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;sys:user:save,sys:role:select&#x27;</span>, <span class="number">2</span>, <span class="keyword">NULL</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">17</span>, <span class="number">2</span>, <span class="string">&#x27;修改&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;sys:user:update,sys:role:select&#x27;</span>, <span class="number">2</span>, <span class="keyword">NULL</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">18</span>, <span class="number">2</span>, <span class="string">&#x27;删除&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;sys:user:delete&#x27;</span>, <span class="number">2</span>, <span class="keyword">NULL</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">19</span>, <span class="number">3</span>, <span class="string">&#x27;查看&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;sys:role:list,sys:role:info&#x27;</span>, <span class="number">2</span>, <span class="keyword">NULL</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">20</span>, <span class="number">3</span>, <span class="string">&#x27;新增&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;sys:role:save,sys:menu:list&#x27;</span>, <span class="number">2</span>, <span class="keyword">NULL</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">21</span>, <span class="number">3</span>, <span class="string">&#x27;修改&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;sys:role:update,sys:menu:list&#x27;</span>, <span class="number">2</span>, <span class="keyword">NULL</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">22</span>, <span class="number">3</span>, <span class="string">&#x27;删除&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;sys:role:delete&#x27;</span>, <span class="number">2</span>, <span class="keyword">NULL</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">23</span>, <span class="number">4</span>, <span class="string">&#x27;查看&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;sys:menu:list,sys:menu:info&#x27;</span>, <span class="number">2</span>, <span class="keyword">NULL</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">24</span>, <span class="number">4</span>, <span class="string">&#x27;新增&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;sys:menu:save,sys:menu:select&#x27;</span>, <span class="number">2</span>, <span class="keyword">NULL</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">25</span>, <span class="number">4</span>, <span class="string">&#x27;修改&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;sys:menu:update,sys:menu:select&#x27;</span>, <span class="number">2</span>, <span class="keyword">NULL</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">26</span>, <span class="number">4</span>, <span class="string">&#x27;删除&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;sys:menu:delete&#x27;</span>, <span class="number">2</span>, <span class="keyword">NULL</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">27</span>, <span class="number">1</span>, <span class="string">&#x27;参数管理&#x27;</span>, <span class="string">&#x27;sys/config&#x27;</span>, <span class="string">&#x27;sys:config:list,sys:config:info,sys:config:save,sys:config:update,sys:config:delete&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;config&#x27;</span>, <span class="number">6</span> ),</span><br><span class="line">	( <span class="number">29</span>, <span class="number">1</span>, <span class="string">&#x27;系统日志&#x27;</span>, <span class="string">&#x27;sys/log&#x27;</span>, <span class="string">&#x27;sys:log:list&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;log&#x27;</span>, <span class="number">7</span> ),</span><br><span class="line">	( <span class="number">30</span>, <span class="number">1</span>, <span class="string">&#x27;文件上传&#x27;</span>, <span class="string">&#x27;oss/oss&#x27;</span>, <span class="string">&#x27;sys:oss:all&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;oss&#x27;</span>, <span class="number">6</span> ),</span><br><span class="line">	( <span class="number">31</span>, <span class="number">0</span>, <span class="string">&#x27;商品系统&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;editor&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">32</span>, <span class="number">31</span>, <span class="string">&#x27;分类维护&#x27;</span>, <span class="string">&#x27;product/category&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;menu&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">34</span>, <span class="number">31</span>, <span class="string">&#x27;品牌管理&#x27;</span>, <span class="string">&#x27;product/brand&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;editor&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">37</span>, <span class="number">31</span>, <span class="string">&#x27;平台属性&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;system&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">38</span>, <span class="number">37</span>, <span class="string">&#x27;属性分组&#x27;</span>, <span class="string">&#x27;product/attrgroup&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;tubiao&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">39</span>, <span class="number">37</span>, <span class="string">&#x27;规格参数&#x27;</span>, <span class="string">&#x27;product/baseattr&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;log&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">40</span>, <span class="number">37</span>, <span class="string">&#x27;销售属性&#x27;</span>, <span class="string">&#x27;product/saleattr&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;zonghe&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">41</span>, <span class="number">31</span>, <span class="string">&#x27;商品维护&#x27;</span>, <span class="string">&#x27;product/spu&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;zonghe&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">42</span>, <span class="number">0</span>, <span class="string">&#x27;优惠营销&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;mudedi&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">43</span>, <span class="number">0</span>, <span class="string">&#x27;库存系统&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;shouye&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">44</span>, <span class="number">0</span>, <span class="string">&#x27;订单系统&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;config&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">45</span>, <span class="number">0</span>, <span class="string">&#x27;用户系统&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;admin&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">46</span>, <span class="number">0</span>, <span class="string">&#x27;内容管理&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;sousuo&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">47</span>, <span class="number">42</span>, <span class="string">&#x27;优惠券管理&#x27;</span>, <span class="string">&#x27;coupon/coupon&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;zhedie&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">48</span>, <span class="number">42</span>, <span class="string">&#x27;发放记录&#x27;</span>, <span class="string">&#x27;coupon/history&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;sql&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">49</span>, <span class="number">42</span>, <span class="string">&#x27;专题活动&#x27;</span>, <span class="string">&#x27;coupon/subject&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;tixing&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">50</span>, <span class="number">42</span>, <span class="string">&#x27;秒杀活动&#x27;</span>, <span class="string">&#x27;coupon/seckill&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;daohang&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">51</span>, <span class="number">42</span>, <span class="string">&#x27;积分维护&#x27;</span>, <span class="string">&#x27;coupon/bounds&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;geren&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">52</span>, <span class="number">42</span>, <span class="string">&#x27;满减折扣&#x27;</span>, <span class="string">&#x27;coupon/full&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;shoucang&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">53</span>, <span class="number">43</span>, <span class="string">&#x27;仓库维护&#x27;</span>, <span class="string">&#x27;ware/wareinfo&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;shouye&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">54</span>, <span class="number">43</span>, <span class="string">&#x27;库存工作单&#x27;</span>, <span class="string">&#x27;ware/task&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;log&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">55</span>, <span class="number">43</span>, <span class="string">&#x27;商品库存&#x27;</span>, <span class="string">&#x27;ware/sku&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;jiesuo&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">56</span>, <span class="number">44</span>, <span class="string">&#x27;订单查询&#x27;</span>, <span class="string">&#x27;order/order&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;zhedie&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">57</span>, <span class="number">44</span>, <span class="string">&#x27;退货单处理&#x27;</span>, <span class="string">&#x27;order/return&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;shanchu&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">58</span>, <span class="number">44</span>, <span class="string">&#x27;等级规则&#x27;</span>, <span class="string">&#x27;order/settings&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;system&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">59</span>, <span class="number">44</span>, <span class="string">&#x27;支付流水查询&#x27;</span>, <span class="string">&#x27;order/payment&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;job&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">60</span>, <span class="number">44</span>, <span class="string">&#x27;退款流水查询&#x27;</span>, <span class="string">&#x27;order/refund&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;mudedi&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">61</span>, <span class="number">45</span>, <span class="string">&#x27;会员列表&#x27;</span>, <span class="string">&#x27;member/member&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;geren&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">62</span>, <span class="number">45</span>, <span class="string">&#x27;会员等级&#x27;</span>, <span class="string">&#x27;member/level&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;tubiao&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">63</span>, <span class="number">45</span>, <span class="string">&#x27;积分变化&#x27;</span>, <span class="string">&#x27;member/growth&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;bianji&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">64</span>, <span class="number">45</span>, <span class="string">&#x27;统计信息&#x27;</span>, <span class="string">&#x27;member/statistics&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;sql&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">65</span>, <span class="number">46</span>, <span class="string">&#x27;首页推荐&#x27;</span>, <span class="string">&#x27;content/index&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;shouye&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">66</span>, <span class="number">46</span>, <span class="string">&#x27;分类热门&#x27;</span>, <span class="string">&#x27;content/category&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;zhedie&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">67</span>, <span class="number">46</span>, <span class="string">&#x27;评论管理&#x27;</span>, <span class="string">&#x27;content/comments&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;pinglun&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">68</span>, <span class="number">41</span>, <span class="string">&#x27;spu管理&#x27;</span>, <span class="string">&#x27;product/spu&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;config&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">69</span>, <span class="number">41</span>, <span class="string">&#x27;发布商品&#x27;</span>, <span class="string">&#x27;product/spuadd&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;bianji&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">70</span>, <span class="number">43</span>, <span class="string">&#x27;采购单维护&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">0</span>, <span class="string">&#x27;tubiao&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">71</span>, <span class="number">70</span>, <span class="string">&#x27;采购需求&#x27;</span>, <span class="string">&#x27;ware/purchaseitem&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;editor&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">72</span>, <span class="number">70</span>, <span class="string">&#x27;采购单&#x27;</span>, <span class="string">&#x27;ware/purchase&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;menu&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">73</span>, <span class="number">41</span>, <span class="string">&#x27;商品管理&#x27;</span>, <span class="string">&#x27;product/manager&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;zonghe&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">74</span>, <span class="number">42</span>, <span class="string">&#x27;会员价格&#x27;</span>, <span class="string">&#x27;coupon/memberprice&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;admin&#x27;</span>, <span class="number">0</span> ),</span><br><span class="line">	( <span class="number">75</span>, <span class="number">42</span>, <span class="string">&#x27;每日秒杀&#x27;</span>, <span class="string">&#x27;coupon/seckillsession&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;job&#x27;</span>, <span class="number">0</span> );</span><br></pre></td></tr></table></figure>

<p>2.添加树型菜单公共组件，再modules下创建common文件夹，然后创建一个category.vue文件，内容如下：</p>
<p><strong>注：使用this.&amp;emit(‘{事件名称}’,[参数。。。])</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;el-input placeholder=&quot;输入关键字进行过滤&quot; v-model=&quot;filterText&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">    &lt;el-tree</span><br><span class="line">      :data=&quot;menus&quot;</span><br><span class="line">      :props=&quot;defaultProps&quot;</span><br><span class="line">      node-key=&quot;catId&quot;</span><br><span class="line">      ref=&quot;menuTree&quot;</span><br><span class="line">      @node-click=&quot;nodeclick&quot;</span><br><span class="line">      :filter-node-method=&quot;filterNode&quot;</span><br><span class="line">      :highlight-current = &quot;true&quot;</span><br><span class="line">    &gt;&lt;/el-tree&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">//这里可以导入其他文件（比如：组件，工具js，第三方插件js，json文件，图片文件等等）</span><br><span class="line">//例如：import 《组件名称》 from &#x27;《组件路径》&#x27;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  //import引入的组件需要注入到对象中才能使用</span><br><span class="line">  components: &#123;&#125;,</span><br><span class="line">  props: &#123;&#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    //这里存放数据</span><br><span class="line">    return &#123;</span><br><span class="line">      filterText: &quot;&quot;,</span><br><span class="line">      menus: [],</span><br><span class="line">      expandedKey: [],</span><br><span class="line">      defaultProps: &#123;</span><br><span class="line">        children: &quot;children&quot;,</span><br><span class="line">        label: &quot;name&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  //计算属性 类似于data概念</span><br><span class="line">  computed: &#123;&#125;,</span><br><span class="line">  //监控data中的数据变化</span><br><span class="line">  watch: &#123;</span><br><span class="line">    filterText(val) &#123;</span><br><span class="line">      this.$refs.menuTree.filter(val);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  //方法集合</span><br><span class="line">  methods: &#123;</span><br><span class="line">    //树节点过滤</span><br><span class="line">    filterNode(value, data) &#123;</span><br><span class="line">      if (!value) return true;</span><br><span class="line">      return data.name.indexOf(value) !== -1;</span><br><span class="line">    &#125;,</span><br><span class="line">    getMenus() &#123;</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(&quot;/product/category/list/tree&quot;),</span><br><span class="line">        method: &quot;get&quot;</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        this.menus = data.data;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    nodeclick(data, node, component) &#123;</span><br><span class="line">      console.log(&quot;子组件category的节点被点击&quot;, data, node, component);</span><br><span class="line">      //向父组件发送事件；</span><br><span class="line">      this.$emit(&quot;tree-node-click&quot;, data, node, component);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  //生命周期 - 创建完成（可以访问当前this实例）</span><br><span class="line">  created() &#123;</span><br><span class="line">    this.getMenus();</span><br><span class="line">  &#125;,</span><br><span class="line">  //生命周期 - 挂载完成（可以访问DOM元素）</span><br><span class="line">  mounted() &#123;&#125;,</span><br><span class="line">  beforeCreate() &#123;&#125;, //生命周期 - 创建之前</span><br><span class="line">  beforeMount() &#123;&#125;, //生命周期 - 挂载之前</span><br><span class="line">  beforeUpdate() &#123;&#125;, //生命周期 - 更新之前</span><br><span class="line">  updated() &#123;&#125;, //生命周期 - 更新之后</span><br><span class="line">  beforeDestroy() &#123;&#125;, //生命周期 - 销毁之前</span><br><span class="line">  destroyed() &#123;&#125;, //生命周期 - 销毁完成</span><br><span class="line">  activated() &#123;&#125; //如果页面有keep-alive缓存功能，这个函数会触发</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>3.如何在父页面引用子组件，然后响应子组件的冒泡事件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;category @tree-node-click=&quot;treenodeclick&quot;&gt;&lt;/category&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import Category from &quot;../common/category&quot;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">components: &#123; Category &#125;,</span><br><span class="line"> methods: &#123;</span><br><span class="line"> //感知树节点被点击</span><br><span class="line">    treenodeclick(data, node, component) &#123;</span><br><span class="line">      if (node.level == 3) &#123;</span><br><span class="line">        this.catId = data.catId;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h4 id="获取分类属性分组"><a href="#获取分类属性分组" class="headerlink" title="获取分类属性分组"></a>获取分类属性分组</h4><p>1.增加接口</p>
<p>AttrGroupController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/list/&#123;catelogId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">list</span><span class="params">(<span class="meta">@RequestParam</span> Map&lt;String, Object&gt; params,</span></span><br><span class="line"><span class="params">                  <span class="meta">@PathVariable(&quot;catelogId&quot;)</span> Long catelogId)</span>&#123;</span><br><span class="line">        <span class="type">PageUtils</span> <span class="variable">page</span> <span class="operator">=</span> attrGroupService.queryPage(params,catelogId);</span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;page&quot;</span>, page);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>AttrGroupServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> PageUtils <span class="title function_">queryPage</span><span class="params">(Map&lt;String, Object&gt; params, Long catelogId)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">        <span class="comment">//select * from pms_attr_group where catelog_id=? and (attr_group_id=key or attr_group_name like %key%)</span></span><br><span class="line">        QueryWrapper&lt;AttrGroupEntity&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;AttrGroupEntity&gt;();</span><br><span class="line">        <span class="keyword">if</span>(!StringUtils.isEmpty(key))&#123;</span><br><span class="line">            wrapper.and((obj)-&gt;&#123;</span><br><span class="line">                obj.eq(<span class="string">&quot;attr_group_id&quot;</span>,key).or().like(<span class="string">&quot;attr_group_name&quot;</span>,key);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>( catelogId == <span class="number">0</span>)&#123;</span><br><span class="line">            IPage&lt;AttrGroupEntity&gt; page = <span class="built_in">this</span>.page(<span class="keyword">new</span> <span class="title class_">Query</span>&lt;AttrGroupEntity&gt;().getPage(params),</span><br><span class="line">                    wrapper);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageUtils</span>(page);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            wrapper.eq(<span class="string">&quot;catelog_id&quot;</span>,catelogId);</span><br><span class="line">            IPage&lt;AttrGroupEntity&gt; page = <span class="built_in">this</span>.page(<span class="keyword">new</span> <span class="title class_">Query</span>&lt;AttrGroupEntity&gt;().getPage(params),</span><br><span class="line">                    wrapper);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageUtils</span>(page);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>3.修改前端文件</p>
<p>attrgroup.vue</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-row :gutter=&quot;20&quot;&gt;</span><br><span class="line">    &lt;el-col :span=&quot;6&quot;&gt;</span><br><span class="line">      &lt;category @tree-node-click=&quot;treenodeclick&quot;&gt;&lt;/category&gt;</span><br><span class="line">    &lt;/el-col&gt;</span><br><span class="line">    &lt;el-col :span=&quot;18&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;mod-config&quot;&gt;</span><br><span class="line">        &lt;el-form :inline=&quot;true&quot; :model=&quot;dataForm&quot; @keyup.enter.native=&quot;getDataList()&quot;&gt;</span><br><span class="line">          &lt;el-form-item&gt;</span><br><span class="line">            &lt;el-input v-model=&quot;dataForm.key&quot; placeholder=&quot;参数名&quot; clearable&gt;&lt;/el-input&gt;</span><br><span class="line">          &lt;/el-form-item&gt;</span><br><span class="line">          &lt;el-form-item&gt;</span><br><span class="line">            &lt;el-button @click=&quot;getDataList()&quot;&gt;查询&lt;/el-button&gt;</span><br><span class="line">            &lt;el-button type=&quot;success&quot; @click=&quot;getAllDataList()&quot;&gt;查询全部&lt;/el-button&gt;</span><br><span class="line">            &lt;el-button</span><br><span class="line">              v-if=&quot;isAuth(&#x27;product:attrgroup:save&#x27;)&quot;</span><br><span class="line">              type=&quot;primary&quot;</span><br><span class="line">              @click=&quot;addOrUpdateHandle()&quot;</span><br><span class="line">            &gt;新增&lt;/el-button&gt;</span><br><span class="line">            &lt;el-button</span><br><span class="line">              v-if=&quot;isAuth(&#x27;product:attrgroup:delete&#x27;)&quot;</span><br><span class="line">              type=&quot;danger&quot;</span><br><span class="line">              @click=&quot;deleteHandle()&quot;</span><br><span class="line">              :disabled=&quot;dataListSelections.length &lt;= 0&quot;</span><br><span class="line">            &gt;批量删除&lt;/el-button&gt;</span><br><span class="line">          &lt;/el-form-item&gt;</span><br><span class="line">        &lt;/el-form&gt;</span><br><span class="line">        &lt;el-table</span><br><span class="line">          :data=&quot;dataList&quot;</span><br><span class="line">          border</span><br><span class="line">          v-loading=&quot;dataListLoading&quot;</span><br><span class="line">          @selection-change=&quot;selectionChangeHandle&quot;</span><br><span class="line">          style=&quot;width: 100%;&quot;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;el-table-column type=&quot;selection&quot; header-align=&quot;center&quot; align=&quot;center&quot; width=&quot;50&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">          &lt;el-table-column prop=&quot;attrGroupId&quot; header-align=&quot;center&quot; align=&quot;center&quot; label=&quot;分组id&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">          &lt;el-table-column prop=&quot;attrGroupName&quot; header-align=&quot;center&quot; align=&quot;center&quot; label=&quot;组名&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">          &lt;el-table-column prop=&quot;sort&quot; header-align=&quot;center&quot; align=&quot;center&quot; label=&quot;排序&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">          &lt;el-table-column prop=&quot;descript&quot; header-align=&quot;center&quot; align=&quot;center&quot; label=&quot;描述&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">          &lt;el-table-column prop=&quot;icon&quot; header-align=&quot;center&quot; align=&quot;center&quot; label=&quot;组图标&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">          &lt;el-table-column prop=&quot;catelogId&quot; header-align=&quot;center&quot; align=&quot;center&quot; label=&quot;所属分类id&quot;&gt;&lt;/el-table-column&gt;</span><br><span class="line">          &lt;el-table-column</span><br><span class="line">            fixed=&quot;right&quot;</span><br><span class="line">            header-align=&quot;center&quot;</span><br><span class="line">            align=&quot;center&quot;</span><br><span class="line">            width=&quot;150&quot;</span><br><span class="line">            label=&quot;操作&quot;</span><br><span class="line">          &gt;</span><br><span class="line">            &lt;template slot-scope=&quot;scope&quot;&gt;</span><br><span class="line">              &lt;el-button type=&quot;text&quot; size=&quot;small&quot; @click=&quot;relationHandle(scope.row.attrGroupId)&quot;&gt;关联&lt;/el-button&gt;</span><br><span class="line">              &lt;el-button</span><br><span class="line">                type=&quot;text&quot;</span><br><span class="line">                size=&quot;small&quot;</span><br><span class="line">                @click=&quot;addOrUpdateHandle(scope.row.attrGroupId)&quot;</span><br><span class="line">              &gt;修改&lt;/el-button&gt;</span><br><span class="line">              &lt;el-button type=&quot;text&quot; size=&quot;small&quot; @click=&quot;deleteHandle(scope.row.attrGroupId)&quot;&gt;删除&lt;/el-button&gt;</span><br><span class="line">            &lt;/template&gt;</span><br><span class="line">          &lt;/el-table-column&gt;</span><br><span class="line">        &lt;/el-table&gt;</span><br><span class="line">        &lt;el-pagination</span><br><span class="line">          @size-change=&quot;sizeChangeHandle&quot;</span><br><span class="line">          @current-change=&quot;currentChangeHandle&quot;</span><br><span class="line">          :current-page=&quot;pageIndex&quot;</span><br><span class="line">          :page-sizes=&quot;[10, 20, 50, 100]&quot;</span><br><span class="line">          :page-size=&quot;pageSize&quot;</span><br><span class="line">          :total=&quot;totalPage&quot;</span><br><span class="line">          layout=&quot;total, sizes, prev, pager, next, jumper&quot;</span><br><span class="line">        &gt;&lt;/el-pagination&gt;</span><br><span class="line">        &lt;!-- 弹窗, 新增 / 修改 --&gt;</span><br><span class="line">        &lt;add-or-update v-if=&quot;addOrUpdateVisible&quot; ref=&quot;addOrUpdate&quot; @refreshDataList=&quot;getDataList&quot;&gt;&lt;/add-or-update&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- 修改关联关系 --&gt;</span><br><span class="line">        &lt;!-- &lt;relation-update v-if=&quot;relationVisible&quot; ref=&quot;relationUpdate&quot; @refreshData=&quot;getDataList&quot;&gt;&lt;/relation-update&gt; --&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/el-col&gt;</span><br><span class="line">  &lt;/el-row&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">/**</span><br><span class="line"> * 父子组件传递数据</span><br><span class="line"> * 1)、子组件给父组件传递数据，事件机制；</span><br><span class="line"> *    子组件给父组件发送一个事件，携带上数据。</span><br><span class="line"> * // this.$emit(&quot;事件名&quot;,携带的数据...)</span><br><span class="line"> */</span><br><span class="line">//这里可以导入其他文件（比如：组件，工具js，第三方插件js，json文件，图片文件等等）</span><br><span class="line">//例如：import 《组件名称》 from &#x27;《组件路径》&#x27;;</span><br><span class="line">import Category from &quot;../common/category&quot;;</span><br><span class="line">import AddOrUpdate from &quot;./attrgroup-add-or-update&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  //import引入的组件需要注入到对象中才能使用</span><br><span class="line">  components: &#123; Category</span><br><span class="line">  , AddOrUpdate</span><br><span class="line">  // , RelationUpdate</span><br><span class="line">  &#125;,</span><br><span class="line">  props: &#123;&#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      catId: 0,</span><br><span class="line">      dataForm: &#123;</span><br><span class="line">        key: &quot;&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      dataList: [],</span><br><span class="line">      pageIndex: 1,</span><br><span class="line">      pageSize: 10,</span><br><span class="line">      totalPage: 0,</span><br><span class="line">      dataListLoading: false,</span><br><span class="line">      dataListSelections: [],</span><br><span class="line">      addOrUpdateVisible: false,</span><br><span class="line">      relationVisible: false</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  activated() &#123;</span><br><span class="line">    this.getDataList();</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    //处理分组与属性的关联</span><br><span class="line">    // relationHandle(groupId) &#123;</span><br><span class="line">    //   this.relationVisible = true;</span><br><span class="line">    //   this.$nextTick(() =&gt; &#123;</span><br><span class="line">    //     this.$refs.relationUpdate.init(groupId);</span><br><span class="line">    //   &#125;);</span><br><span class="line">    // &#125;,</span><br><span class="line">    //感知树节点被点击</span><br><span class="line">    treenodeclick(data, node, component) &#123;</span><br><span class="line">      if (node.level == 3) &#123;</span><br><span class="line">        this.catId = data.catId;</span><br><span class="line">        this.getDataList(); //重新查询</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    getAllDataList()&#123;</span><br><span class="line">      this.catId = 0;</span><br><span class="line">      this.getDataList();</span><br><span class="line">    &#125;,</span><br><span class="line">    // 获取数据列表</span><br><span class="line">    getDataList() &#123;</span><br><span class="line">      this.dataListLoading = true;</span><br><span class="line">      this.$http(&#123;</span><br><span class="line">        url: this.$http.adornUrl(`/product/attrgroup/list/$&#123;this.catId&#125;`),</span><br><span class="line">        method: &quot;get&quot;,</span><br><span class="line">        params: this.$http.adornParams(&#123;</span><br><span class="line">          page: this.pageIndex,</span><br><span class="line">          limit: this.pageSize,</span><br><span class="line">          key: this.dataForm.key</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">        if (data &amp;&amp; data.code === 0) &#123;</span><br><span class="line">          this.dataList = data.page.list;</span><br><span class="line">          this.totalPage = data.page.totalCount;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          this.dataList = [];</span><br><span class="line">          this.totalPage = 0;</span><br><span class="line">        &#125;</span><br><span class="line">        this.dataListLoading = false;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 每页数</span><br><span class="line">    sizeChangeHandle(val) &#123;</span><br><span class="line">      this.pageSize = val;</span><br><span class="line">      this.pageIndex = 1;</span><br><span class="line">      this.getDataList();</span><br><span class="line">    &#125;,</span><br><span class="line">    // 当前页</span><br><span class="line">    currentChangeHandle(val) &#123;</span><br><span class="line">      this.pageIndex = val;</span><br><span class="line">      this.getDataList();</span><br><span class="line">    &#125;,</span><br><span class="line">    // 多选</span><br><span class="line">    selectionChangeHandle(val) &#123;</span><br><span class="line">      this.dataListSelections = val;</span><br><span class="line">    &#125;,</span><br><span class="line">    // 新增 / 修改</span><br><span class="line">    addOrUpdateHandle(id) &#123;</span><br><span class="line">      this.addOrUpdateVisible = true;</span><br><span class="line">      this.$nextTick(() =&gt; &#123;</span><br><span class="line">        this.$refs.addOrUpdate.init(id);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    // 删除</span><br><span class="line">    deleteHandle(id) &#123;</span><br><span class="line">      var ids = id</span><br><span class="line">        ? [id]</span><br><span class="line">        : this.dataListSelections.map(item =&gt; &#123;</span><br><span class="line">            return item.attrGroupId;</span><br><span class="line">          &#125;);</span><br><span class="line">      this.$confirm(</span><br><span class="line">        `确定对[id=$&#123;ids.join(&quot;,&quot;)&#125;]进行[$&#123;id ? &quot;删除&quot; : &quot;批量删除&quot;&#125;]操作?`,</span><br><span class="line">        &quot;提示&quot;,</span><br><span class="line">        &#123;</span><br><span class="line">          confirmButtonText: &quot;确定&quot;,</span><br><span class="line">          cancelButtonText: &quot;取消&quot;,</span><br><span class="line">          type: &quot;warning&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      ).then(() =&gt; &#123;</span><br><span class="line">        this.$http(&#123;</span><br><span class="line">          url: this.$http.adornUrl(&quot;/product/attrgroup/delete&quot;),</span><br><span class="line">          method: &quot;post&quot;,</span><br><span class="line">          data: this.$http.adornData(ids, false)</span><br><span class="line">        &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">          if (data &amp;&amp; data.code === 0) &#123;</span><br><span class="line">            this.$message(&#123;</span><br><span class="line">              message: &quot;操作成功&quot;,</span><br><span class="line">              type: &quot;success&quot;,</span><br><span class="line">              duration: 1500,</span><br><span class="line">              onClose: () =&gt; &#123;</span><br><span class="line">                this.getDataList();</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            this.$message.error(data.msg);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h4 id="分组新增-amp-级联选择器"><a href="#分组新增-amp-级联选择器" class="headerlink" title="分组新增&amp;级联选择器"></a>分组新增&amp;级联选择器</h4><p>1.使用<el-cascader>标签，引入级联选择器</p>
<p>2.为了返回的字段中不存在空字段值的参数返回到响应参数中，在字段变量上注解@JsonInclude(JsonInclude.Include.NON_EMPTY)</p>
<h4 id="分组修改-amp-级联选择器回显"><a href="#分组修改-amp-级联选择器回显" class="headerlink" title="分组修改&amp;级联选择器回显"></a>分组修改&amp;级联选择器回显</h4><p>1.this.$nextTick() 的用法是指：等到组件渲染完毕才调用next方法中的方法。</p>
<p>2.渲染级联回显</p>
<p>2.1 添加回显字段</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TableField(exist = false)</span></span><br><span class="line"><span class="keyword">private</span> Long[] catelogPath;</span><br></pre></td></tr></table></figure>

<p>2.2 增加方法</p>
<p>AttrGroupController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Autowired</span></span><br><span class="line"> <span class="keyword">private</span> CategoryService categoryService;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/info/&#123;attrGroupId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">infoNew</span><span class="params">(<span class="meta">@PathVariable(&quot;attrGroupId&quot;)</span> Long attrGroupId)</span>&#123;</span><br><span class="line">        <span class="type">AttrGroupEntity</span> <span class="variable">attrGroup</span> <span class="operator">=</span> attrGroupService.getById(attrGroupId);</span><br><span class="line"></span><br><span class="line">        <span class="type">Long</span> <span class="variable">catelogId</span> <span class="operator">=</span> attrGroup.getCatelogId();</span><br><span class="line">        Long[] path = categoryService.findCatelogPath(catelogId);</span><br><span class="line"></span><br><span class="line">        attrGroup.setCatelogPath(path);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;attrGroup&quot;</span>, attrGroup);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>CategoryServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Long[] findCatelogPath(Long catelogId) &#123;</span><br><span class="line">        List&lt;Long&gt; paths = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        List&lt;Long&gt; parentPath = findParentPath(catelogId, paths);</span><br><span class="line">        Collections.reverse(parentPath);</span><br><span class="line">        <span class="keyword">return</span> parentPath.toArray(<span class="keyword">new</span> <span class="title class_">Long</span>[parentPath.size()]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;Long&gt; <span class="title function_">findParentPath</span><span class="params">(Long catelogId,List&lt;Long&gt; paths)</span>&#123;</span><br><span class="line">        <span class="comment">//1、收集当前节点id</span></span><br><span class="line">        paths.add(catelogId);</span><br><span class="line">        <span class="type">CategoryEntity</span> <span class="variable">byId</span> <span class="operator">=</span> <span class="built_in">this</span>.getById(catelogId);</span><br><span class="line">        <span class="keyword">if</span>(byId.getParentCid()!=<span class="number">0</span>)&#123;</span><br><span class="line">            findParentPath(byId.getParentCid(),paths);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> paths;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>3.使用<el-cascader>自带属性filterable，增加搜索功能。</p>
<p>4.重置弹出框数据，<el-dialog>标签自带数据closed ，声明关闭回调方法，然后置空动态绑定参数。</p>
<h4 id="品牌分类关联与级联更新"><a href="#品牌分类关联与级联更新" class="headerlink" title="品牌分类关联与级联更新"></a>品牌分类关联与级联更新</h4><p>1.引入MyBatisPlus插件实现分页</p>
<p>1.1 在product模块下，创建config包，包下建立插件配置类，使用分页插件，注入到Spring 中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span> <span class="comment">//开启事务</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;&lt;你到数据控制层包路径&gt;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//引入分页插件</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PaginationInterceptor <span class="title function_">paginationInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">PaginationInterceptor</span> <span class="variable">paginationInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PaginationInterceptor</span>();</span><br><span class="line">        <span class="comment">// 设置请求的页面大于最大页后操作， true调回到首页，false 继续请求  默认false</span></span><br><span class="line">        paginationInterceptor.setOverflow(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// 设置最大单页限制数量，默认 500 条，-1 不受限制</span></span><br><span class="line">        paginationInterceptor.setLimit(<span class="number">1000</span>);</span><br><span class="line">        <span class="keyword">return</span> paginationInterceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1.2 修改品牌查询方法，能够通过关键词进行多行检索。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> PageUtils <span class="title function_">queryPage</span><span class="params">(Map&lt;String, Object&gt; params)</span> &#123;</span><br><span class="line">    <span class="comment">//1、获取key</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">    QueryWrapper&lt;BrandEntity&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">if</span>(!StringUtils.isEmpty(key))&#123;</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;brand_id&quot;</span>,key).or().like(<span class="string">&quot;name&quot;</span>,key);</span><br><span class="line">    &#125;</span><br><span class="line">    IPage&lt;BrandEntity&gt; page = <span class="built_in">this</span>.page(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Query</span>&lt;BrandEntity&gt;().getPage(params),</span><br><span class="line">            queryWrapper</span><br><span class="line"></span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageUtils</span>(page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.品牌分类以及关联</p>
<p>2.1编写品牌分类信息查询接口，CategoryBrandRelationController 增加以下方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取当前品牌关联的所有分类列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/catelog/list&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">cateloglist</span><span class="params">(<span class="meta">@RequestParam(&quot;brandId&quot;)</span> Long brandId)</span> &#123;</span><br><span class="line">        List&lt;CategoryBrandRelationEntity&gt; data = categoryBrandRelationService.list(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;CategoryBrandRelationEntity&gt;().eq(<span class="string">&quot;brand_id&quot;</span>, brandId)</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;data&quot;</span>, data);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>2.2 编写平台分类信息保存接口</p>
<p>CategoryBrandRelationServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveDetail</span><span class="params">(CategoryBrandRelationEntity categoryBrandRelation)</span> &#123;</span><br><span class="line">    <span class="type">Long</span> <span class="variable">brandId</span> <span class="operator">=</span> categoryBrandRelation.getBrandId();</span><br><span class="line">    <span class="type">Long</span> <span class="variable">catelogId</span> <span class="operator">=</span> categoryBrandRelation.getCatelogId();</span><br><span class="line">    <span class="comment">//1、查询详细名字</span></span><br><span class="line">    <span class="type">BrandEntity</span> <span class="variable">brandEntity</span> <span class="operator">=</span> brandDao.selectById(brandId);</span><br><span class="line">    <span class="type">CategoryEntity</span> <span class="variable">categoryEntity</span> <span class="operator">=</span> categoryDao.selectById(catelogId);</span><br><span class="line">    categoryBrandRelation.setBrandName(brandEntity.getName());</span><br><span class="line">    categoryBrandRelation.setCatelogName(categoryEntity.getName());</span><br><span class="line">    <span class="built_in">this</span>.save(categoryBrandRelation);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CategoryBrandRelationController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存关联信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">saveDetail</span><span class="params">(<span class="meta">@RequestBody</span> CategoryBrandRelationEntity categoryBrandRelation)</span> &#123;</span><br><span class="line">        categoryBrandRelationService.saveDetail(categoryBrandRelation);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>3.级联更新，如果更新品牌的名称，我们就需要同时更新关联的品牌数据</p>
<p>BrandServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateDetail</span><span class="params">(BrandEntity brand)</span> &#123;</span><br><span class="line">    <span class="comment">//保证冗余字段的数据一致</span></span><br><span class="line">    <span class="built_in">this</span>.updateById(brand);</span><br><span class="line">    <span class="keyword">if</span>(!StringUtils.isEmpty(brand.getName()))&#123;</span><br><span class="line">        <span class="comment">//同步更新其他关联表中的数据</span></span><br><span class="line">        categoryBrandRelationService.updateBrand(brand.getBrandId(),brand.getName());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//TODO 更新其他关联</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BrandController.java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">   * 修改</span><br><span class="line">   */</span><br><span class="line">  @RequestMapping(&quot;/update&quot;)</span><br><span class="line">  //@RequiresPermissions(&quot;product:brand:update&quot;)</span><br><span class="line">  public R update(@Validated(UpdateGroup.class) @RequestBody BrandEntity brand)&#123;</span><br><span class="line">brandService.updateDetail(brand);</span><br><span class="line"></span><br><span class="line">      return R.ok();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>CategoryBrandRelationServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateBrand</span><span class="params">(Long brandId, String name)</span> &#123;</span><br><span class="line">    <span class="type">CategoryBrandRelationEntity</span> <span class="variable">relationEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CategoryBrandRelationEntity</span>();</span><br><span class="line">    relationEntity.setBrandId(brandId);</span><br><span class="line">    relationEntity.setBrandName(name);</span><br><span class="line">    <span class="built_in">this</span>.update(relationEntity,<span class="keyword">new</span> <span class="title class_">UpdateWrapper</span>&lt;CategoryBrandRelationEntity&gt;().eq(<span class="string">&quot;brand_id&quot;</span>,brandId));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateCategory</span><span class="params">(Long catId, String name)</span> &#123;</span><br><span class="line">     <span class="built_in">this</span>.baseMapper.updateCategory(catId,name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CategoryBrandRelationDao.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateCategory&quot;</span>&gt;</span></span><br><span class="line">       UPDATE `pms_category_brand_relation` SET catelog_name=#&#123;name&#125; WHERE catelog_id=#&#123;catId&#125;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>CategoryBrandRelationDao.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">updateCategory</span><span class="params">(<span class="meta">@Param(&quot;catId&quot;)</span> Long catId, <span class="meta">@Param(&quot;name&quot;)</span> String name)</span>;</span><br></pre></td></tr></table></figure>

<p>CategoryServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 级联更新所有关联的数据</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> category</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateCascade</span><span class="params">(CategoryEntity category)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.updateById(category);</span><br><span class="line">    categoryBrandRelationService.updateCategory(category.getCatId(),category.getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CategoryController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 修改</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@RequestMapping(&quot;/update&quot;)</span></span><br><span class="line">  <span class="comment">//@RequiresPermissions(&quot;product:category:update&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> R <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> CategoryEntity category)</span>&#123;</span><br><span class="line">categoryService.updateCascade(category);</span><br><span class="line">      <span class="keyword">return</span> R.ok();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h3 id="平台属性"><a href="#平台属性" class="headerlink" title="平台属性"></a>平台属性</h3><h4 id="规格参数新增与VO"><a href="#规格参数新增与VO" class="headerlink" title="规格参数新增与VO"></a>规格参数新增与VO</h4><p>1.VO的概念</p>
<p>略（搜索 object的划分）</p>
<p>2.规格参数新增接口</p>
<p>2.1 新增规格参数VO类</p>
<p>2.2 业务逻辑</p>
<p>AttrServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveAttr</span><span class="params">(AttrVo attr)</span> &#123;</span><br><span class="line">        <span class="type">AttrEntity</span> <span class="variable">attrEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AttrEntity</span>();</span><br><span class="line"><span class="comment">//        attrEntity.setAttrName(attr.getAttrName());</span></span><br><span class="line">        BeanUtils.copyProperties(attr,attrEntity);</span><br><span class="line">        <span class="comment">//1、保存基本数据</span></span><br><span class="line">        <span class="built_in">this</span>.save(attrEntity);</span><br><span class="line">        <span class="comment">//2、保存关联关系</span></span><br><span class="line">        <span class="keyword">if</span>(attr.getAttrType() == ProductConstant.AttrEnum.ATTR_TYPE_BASE.getCode() &amp;&amp; attr.getAttrGroupId()!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="type">AttrAttrgroupRelationEntity</span> <span class="variable">relationEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AttrAttrgroupRelationEntity</span>();</span><br><span class="line">            relationEntity.setAttrGroupId(attr.getAttrGroupId());</span><br><span class="line">            relationEntity.setAttrId(attrEntity.getAttrId());</span><br><span class="line">            relationDao.insert(relationEntity);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>AttrController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 保存</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line">  <span class="comment">//@RequiresPermissions(&quot;product:attr:save&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> R <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> AttrVo attr)</span>&#123;</span><br><span class="line">attrService.saveAttr(attr);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> R.ok();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h4 id="规格参数列表"><a href="#规格参数列表" class="headerlink" title="规格参数列表"></a>规格参数列表</h4><p>1.新增规格列表查询接口</p>
<p>修改AttrController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/base/list/&#123;catelogId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">baseAttrList</span><span class="params">(<span class="meta">@RequestParam</span> Map&lt;String, Object&gt; params,</span></span><br><span class="line"><span class="params">                          <span class="meta">@PathVariable(&quot;catelogId&quot;)</span> Long catelogId)</span> &#123;</span><br><span class="line">        <span class="type">PageUtils</span> <span class="variable">page</span> <span class="operator">=</span> attrService.queryBaseAttrPage(params, catelogId);</span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;page&quot;</span>, page);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>修改AttrServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> PageUtils <span class="title function_">queryBaseAttrPage</span><span class="params">(Map&lt;String, Object&gt; params, Long catelogId)</span> &#123;</span><br><span class="line">    QueryWrapper&lt;AttrEntity&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;AttrEntity&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (catelogId != <span class="number">0</span>) &#123;</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;catelog_id&quot;</span>, catelogId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!StringUtils.isEmpty(key)) &#123;</span><br><span class="line">        <span class="comment">//attr_id  attr_name</span></span><br><span class="line">        queryWrapper.and((wrapper) -&gt; &#123;</span><br><span class="line">            wrapper.eq(<span class="string">&quot;attr_id&quot;</span>, key).or().like(<span class="string">&quot;attr_name&quot;</span>, key);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    IPage&lt;AttrEntity&gt; page = <span class="built_in">this</span>.page(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Query</span>&lt;AttrEntity&gt;().getPage(params),</span><br><span class="line">            queryWrapper</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="type">PageUtils</span> <span class="variable">pageUtils</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageUtils</span>(page);</span><br><span class="line">    List&lt;AttrEntity&gt; records = page.getRecords();</span><br><span class="line">    List&lt;AttrRespVo&gt; respVos = records.stream().map((attrEntity) -&gt; &#123;</span><br><span class="line">        <span class="type">AttrRespVo</span> <span class="variable">attrRespVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AttrRespVo</span>();</span><br><span class="line">        BeanUtils.copyProperties(attrEntity, attrRespVo);</span><br><span class="line">        <span class="comment">//1、设置分类和分组的名字</span></span><br><span class="line">        <span class="type">AttrAttrgroupRelationEntity</span> <span class="variable">attrId</span> <span class="operator">=</span></span><br><span class="line">                relationDao.selectOne(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;AttrAttrgroupRelationEntity&gt;().eq(<span class="string">&quot;attr_id&quot;</span>,</span><br><span class="line">                        attrEntity.getAttrId()));</span><br><span class="line">        <span class="keyword">if</span> (attrId != <span class="literal">null</span> &amp;&amp; attrId.getAttrGroupId() != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">AttrGroupEntity</span> <span class="variable">attrGroupEntity</span> <span class="operator">=</span> attrGroupDao.selectById(attrId.getAttrGroupId());</span><br><span class="line">            attrRespVo.setGroupName(attrGroupEntity.getAttrGroupName());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">CategoryEntity</span> <span class="variable">categoryEntity</span> <span class="operator">=</span> categoryDao.selectById(attrEntity.getCatelogId());</span><br><span class="line">        <span class="keyword">if</span> (categoryEntity != <span class="literal">null</span>) &#123;</span><br><span class="line">            attrRespVo.setCatelogName(categoryEntity.getName());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> attrRespVo;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">    pageUtils.setList(respVos);</span><br><span class="line">    <span class="keyword">return</span> pageUtils;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因为要关联查询数据，分类信息和分组信息，新增响应类AttrRespVo</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AttrRespVo</span> <span class="keyword">extends</span> <span class="title class_">AttrVo</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 			&quot;catelogName&quot;: &quot;手机/数码/手机&quot;, //所属分类名字</span></span><br><span class="line"><span class="comment">     * 			&quot;groupName&quot;: &quot;主体&quot;, //所属分组名字</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String catelogName;</span><br><span class="line">    <span class="keyword">private</span> String groupName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long[] catelogPath;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="规格修改"><a href="#规格修改" class="headerlink" title="规格修改"></a>规格修改</h4><p>1.查询属性详情</p>
<p>1.1 修改 &#x2F;product&#x2F;attr&#x2F;info&#x2F;{attrId} 接口</p>
<p>AttrController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/info/&#123;attrId&#125;&quot;)</span></span><br><span class="line">    <span class="comment">//@RequiresPermissions(&quot;product:attr:info&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">info</span><span class="params">(<span class="meta">@PathVariable(&quot;attrId&quot;)</span> Long attrId)</span>&#123;</span><br><span class="line">		<span class="comment">//AttrEntity attr = attrService.getById(attrId);</span></span><br><span class="line">        <span class="type">AttrRespVo</span> <span class="variable">respVo</span> <span class="operator">=</span> attrService.getAttrInfo(attrId);</span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;attr&quot;</span>, respVo);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>AttrServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> AttrRespVo <span class="title function_">getAttrInfo</span><span class="params">(Long attrId)</span> &#123;</span><br><span class="line">        <span class="type">AttrRespVo</span> <span class="variable">respVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AttrRespVo</span>();</span><br><span class="line">        <span class="type">AttrEntity</span> <span class="variable">attrEntity</span> <span class="operator">=</span> <span class="built_in">this</span>.getById(attrId);</span><br><span class="line">        BeanUtils.copyProperties(attrEntity, respVo);</span><br><span class="line">        <span class="comment">//1、设置分组信息</span></span><br><span class="line">        <span class="type">AttrAttrgroupRelationEntity</span> <span class="variable">attrgroupRelation</span> <span class="operator">=</span></span><br><span class="line">                relationDao.selectOne(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;AttrAttrgroupRelationEntity&gt;().eq(<span class="string">&quot;attr_id&quot;</span>, attrId));</span><br><span class="line">        <span class="keyword">if</span> (attrgroupRelation != <span class="literal">null</span>) &#123;</span><br><span class="line">            respVo.setAttrGroupId(attrgroupRelation.getAttrGroupId());</span><br><span class="line">            <span class="type">AttrGroupEntity</span> <span class="variable">attrGroupEntity</span> <span class="operator">=</span> attrGroupDao.selectById(attrgroupRelation.getAttrGroupId());</span><br><span class="line">            <span class="keyword">if</span> (attrGroupEntity != <span class="literal">null</span>) &#123;</span><br><span class="line">                respVo.setGroupName(attrGroupEntity.getAttrGroupName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//2、设置分类信息</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">catelogId</span> <span class="operator">=</span> attrEntity.getCatelogId();</span><br><span class="line">        Long[] catelogPath = categoryService.findCatelogPath(catelogId);</span><br><span class="line">        respVo.setCatelogPath(catelogPath);</span><br><span class="line"></span><br><span class="line">        <span class="type">CategoryEntity</span> <span class="variable">categoryEntity</span> <span class="operator">=</span> categoryDao.selectById(catelogId);</span><br><span class="line">        <span class="keyword">if</span>(categoryEntity!=<span class="literal">null</span>)&#123;</span><br><span class="line">            respVo.setCatelogName(categoryEntity.getName());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> respVo;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>2.更新属性分组</p>
<p>AttrServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(rollbackFor = RuntimeException.class)</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateAttr</span><span class="params">(AttrVo attr)</span> &#123;</span><br><span class="line">    <span class="type">AttrEntity</span> <span class="variable">attrEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AttrEntity</span>();</span><br><span class="line">    BeanUtils.copyProperties(attr, attrEntity);</span><br><span class="line">    <span class="built_in">this</span>.updateById(attrEntity);</span><br><span class="line">    <span class="comment">//1、修改分组关联</span></span><br><span class="line">    <span class="type">AttrAttrgroupRelationEntity</span> <span class="variable">relationEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AttrAttrgroupRelationEntity</span>();</span><br><span class="line">    relationEntity.setAttrGroupId(attr.getAttrGroupId());</span><br><span class="line">    relationEntity.setAttrId(attr.getAttrId());</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">count</span> <span class="operator">=</span> relationDao.selectCount(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;AttrAttrgroupRelationEntity&gt;().eq(<span class="string">&quot;attr_id&quot;</span>, attr.getAttrId()));</span><br><span class="line">    <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        relationDao.update(relationEntity, <span class="keyword">new</span> <span class="title class_">UpdateWrapper</span>&lt;AttrAttrgroupRelationEntity&gt;().eq(<span class="string">&quot;attr_id&quot;</span>, attr.getAttrId()));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        relationDao.insert(relationEntity);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>AttrController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/update&quot;)</span></span><br><span class="line">    <span class="comment">//@RequiresPermissions(&quot;product:attr:update&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> AttrVo attr)</span>&#123;</span><br><span class="line">        attrService.updateAttr(attr);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="销售属性维护"><a href="#销售属性维护" class="headerlink" title="销售属性维护"></a>销售属性维护</h4><p>1.修改之前的所有方法，如果是基本属性需要关联修改，如果是销售属性就不需要，所以我们要定义一个常量作为判断。</p>
<p>AttrServiceImpl.java 修改部分方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveAttr</span><span class="params">(AttrVo attr)</span> &#123;</span><br><span class="line">        <span class="type">AttrEntity</span> <span class="variable">attrEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AttrEntity</span>();</span><br><span class="line"><span class="comment">//        attrEntity.setAttrName(attr.getAttrName());</span></span><br><span class="line">        BeanUtils.copyProperties(attr,attrEntity);</span><br><span class="line">        <span class="comment">//1、保存基本数据</span></span><br><span class="line">        <span class="built_in">this</span>.save(attrEntity);</span><br><span class="line">        <span class="comment">//2、保存关联关系</span></span><br><span class="line">        <span class="keyword">if</span>(attr.getAttrType() == ProductConstant.AttrEnum.ATTR_TYPE_BASE.getCode() &amp;&amp; attr.getAttrGroupId()!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="type">AttrAttrgroupRelationEntity</span> <span class="variable">relationEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AttrAttrgroupRelationEntity</span>();</span><br><span class="line">            relationEntity.setAttrGroupId(attr.getAttrGroupId());</span><br><span class="line">            relationEntity.setAttrId(attrEntity.getAttrId());</span><br><span class="line">            relationDao.insert(relationEntity);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> PageUtils <span class="title function_">queryBaseAttrPage</span><span class="params">(Map&lt;String, Object&gt; params, Long catelogId, String type)</span> &#123;</span><br><span class="line">        QueryWrapper&lt;AttrEntity&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;AttrEntity&gt;().eq(<span class="string">&quot;attr_type&quot;</span>,<span class="string">&quot;base&quot;</span>.equalsIgnoreCase(type)?ProductConstant.AttrEnum.ATTR_TYPE_BASE.getCode():ProductConstant.AttrEnum.ATTR_TYPE_SALE.getCode());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(catelogId != <span class="number">0</span>)&#123;</span><br><span class="line">            queryWrapper.eq(<span class="string">&quot;catelog_id&quot;</span>,catelogId);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(!StringUtils.isEmpty(key))&#123;</span><br><span class="line">            <span class="comment">//attr_id  attr_name</span></span><br><span class="line">            queryWrapper.and((wrapper)-&gt;&#123;</span><br><span class="line">                wrapper.eq(<span class="string">&quot;attr_id&quot;</span>,key).or().like(<span class="string">&quot;attr_name&quot;</span>,key);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        IPage&lt;AttrEntity&gt; page = <span class="built_in">this</span>.page(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Query</span>&lt;AttrEntity&gt;().getPage(params),</span><br><span class="line">                queryWrapper</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="type">PageUtils</span> <span class="variable">pageUtils</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageUtils</span>(page);</span><br><span class="line">        List&lt;AttrEntity&gt; records = page.getRecords();</span><br><span class="line">        List&lt;AttrRespVo&gt; respVos = records.stream().map((attrEntity) -&gt; &#123;</span><br><span class="line">            <span class="type">AttrRespVo</span> <span class="variable">attrRespVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AttrRespVo</span>();</span><br><span class="line">            BeanUtils.copyProperties(attrEntity, attrRespVo);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//1、设置分类和分组的名字</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="string">&quot;base&quot;</span>.equalsIgnoreCase(type))&#123;</span><br><span class="line">                <span class="type">AttrAttrgroupRelationEntity</span> <span class="variable">attrId</span> <span class="operator">=</span> relationDao.selectOne(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;AttrAttrgroupRelationEntity&gt;().eq(<span class="string">&quot;attr_id&quot;</span>, attrEntity.getAttrId()));</span><br><span class="line">                <span class="keyword">if</span> (attrId != <span class="literal">null</span> &amp;&amp; attrId.getAttrGroupId()!=<span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="type">AttrGroupEntity</span> <span class="variable">attrGroupEntity</span> <span class="operator">=</span> attrGroupDao.selectById(attrId.getAttrGroupId());</span><br><span class="line">                    attrRespVo.setGroupName(attrGroupEntity.getAttrGroupName());</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="type">CategoryEntity</span> <span class="variable">categoryEntity</span> <span class="operator">=</span> categoryDao.selectById(attrEntity.getCatelogId());</span><br><span class="line">            <span class="keyword">if</span> (categoryEntity != <span class="literal">null</span>) &#123;</span><br><span class="line">                attrRespVo.setCatelogName(categoryEntity.getName());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> attrRespVo;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">        pageUtils.setList(respVos);</span><br><span class="line">        <span class="keyword">return</span> pageUtils;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> AttrRespVo <span class="title function_">getAttrInfo</span><span class="params">(Long attrId)</span> &#123;</span><br><span class="line">        <span class="type">AttrRespVo</span> <span class="variable">respVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AttrRespVo</span>();</span><br><span class="line">        <span class="type">AttrEntity</span> <span class="variable">attrEntity</span> <span class="operator">=</span> <span class="built_in">this</span>.getById(attrId);</span><br><span class="line">        BeanUtils.copyProperties(attrEntity,respVo);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(attrEntity.getAttrType() == ProductConstant.AttrEnum.ATTR_TYPE_BASE.getCode())&#123;</span><br><span class="line">            <span class="comment">//1、设置分组信息</span></span><br><span class="line">            <span class="type">AttrAttrgroupRelationEntity</span> <span class="variable">attrgroupRelation</span> <span class="operator">=</span> relationDao.selectOne(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;AttrAttrgroupRelationEntity&gt;().eq(<span class="string">&quot;attr_id&quot;</span>, attrId));</span><br><span class="line">            <span class="keyword">if</span>(attrgroupRelation!=<span class="literal">null</span>)&#123;</span><br><span class="line">                respVo.setAttrGroupId(attrgroupRelation.getAttrGroupId());</span><br><span class="line">                <span class="type">AttrGroupEntity</span> <span class="variable">attrGroupEntity</span> <span class="operator">=</span> attrGroupDao.selectById(attrgroupRelation.getAttrGroupId());</span><br><span class="line">                <span class="keyword">if</span>(attrGroupEntity!=<span class="literal">null</span>)&#123;</span><br><span class="line">                    respVo.setGroupName(attrGroupEntity.getAttrGroupName());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//2、设置分类信息</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">catelogId</span> <span class="operator">=</span> attrEntity.getCatelogId();</span><br><span class="line">        Long[] catelogPath = categoryService.findCatelogPath(catelogId);</span><br><span class="line">        respVo.setCatelogPath(catelogPath);</span><br><span class="line"></span><br><span class="line">        <span class="type">CategoryEntity</span> <span class="variable">categoryEntity</span> <span class="operator">=</span> categoryDao.selectById(catelogId);</span><br><span class="line">        <span class="keyword">if</span>(categoryEntity!=<span class="literal">null</span>)&#123;</span><br><span class="line">            respVo.setCatelogName(categoryEntity.getName());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> respVo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateAttr</span><span class="params">(AttrVo attr)</span> &#123;</span><br><span class="line">        <span class="type">AttrEntity</span> <span class="variable">attrEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AttrEntity</span>();</span><br><span class="line">        BeanUtils.copyProperties(attr,attrEntity);</span><br><span class="line">        <span class="built_in">this</span>.updateById(attrEntity);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(attrEntity.getAttrType() == ProductConstant.AttrEnum.ATTR_TYPE_BASE.getCode())&#123;</span><br><span class="line">            <span class="comment">//1、修改分组关联</span></span><br><span class="line">            <span class="type">AttrAttrgroupRelationEntity</span> <span class="variable">relationEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AttrAttrgroupRelationEntity</span>();</span><br><span class="line"></span><br><span class="line">            relationEntity.setAttrGroupId(attr.getAttrGroupId());</span><br><span class="line">            relationEntity.setAttrId(attr.getAttrId());</span><br><span class="line"></span><br><span class="line">            <span class="type">Integer</span> <span class="variable">count</span> <span class="operator">=</span> relationDao.selectCount(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;AttrAttrgroupRelationEntity&gt;().eq(<span class="string">&quot;attr_id&quot;</span>, attr.getAttrId()));</span><br><span class="line">            <span class="keyword">if</span>(count&gt;<span class="number">0</span>)&#123;</span><br><span class="line"></span><br><span class="line">                relationDao.update(relationEntity,<span class="keyword">new</span> <span class="title class_">UpdateWrapper</span>&lt;AttrAttrgroupRelationEntity&gt;().eq(<span class="string">&quot;attr_id&quot;</span>,attr.getAttrId()));</span><br><span class="line"></span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                relationDao.insert(relationEntity);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>AttrController.java 修改</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&#123;attrType&#125;/list/&#123;catelogId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">baseAttrList</span><span class="params">(<span class="meta">@RequestParam</span> Map&lt;String, Object&gt; params,</span></span><br><span class="line"><span class="params">                          <span class="meta">@PathVariable(&quot;catelogId&quot;)</span> Long catelogId,</span></span><br><span class="line"><span class="params">                          <span class="meta">@PathVariable(&quot;attrType&quot;)</span>String type)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">PageUtils</span> <span class="variable">page</span> <span class="operator">=</span> attrService.queryBaseAttrPage(params,catelogId,type);</span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;page&quot;</span>, page);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>在common 模块添加常量类 ProductConstant</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductConstant</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span>  <span class="title class_">AttrEnum</span>&#123;</span><br><span class="line">        ATTR_TYPE_BASE(<span class="number">1</span>,<span class="string">&quot;基本属性&quot;</span>),ATTR_TYPE_SALE(<span class="number">0</span>,<span class="string">&quot;销售属性&quot;</span>);</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> code;</span><br><span class="line">        <span class="keyword">private</span> String msg;</span><br><span class="line"></span><br><span class="line">        AttrEnum(<span class="type">int</span> code,String msg)&#123;</span><br><span class="line">            <span class="built_in">this</span>.code = code;</span><br><span class="line">            <span class="built_in">this</span>.msg = msg;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> code;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getMsg</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> msg;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="查询分组关联属性-amp-删除关联"><a href="#查询分组关联属性-amp-删除关联" class="headerlink" title="查询分组关联属性&amp;删除关联"></a>查询分组关联属性&amp;删除关联</h4><p>1.查询分组关联属性</p>
<p>AttrServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据分组id查找关联的所有基本属性</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> attrgroupId</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> List&lt;AttrEntity&gt; <span class="title function_">getRelationAttr</span><span class="params">(Long attrgroupId)</span> &#123;</span><br><span class="line">    List&lt;AttrAttrgroupRelationEntity&gt; entities = relationDao.selectList(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;AttrAttrgroupRelationEntity&gt;().eq(<span class="string">&quot;attr_group_id&quot;</span>, attrgroupId));</span><br><span class="line"></span><br><span class="line">    List&lt;Long&gt; attrIds = entities.stream().map((attr) -&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> attr.getAttrId();</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(attrIds == <span class="literal">null</span> || attrIds.size() == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Collection&lt;AttrEntity&gt; attrEntities = <span class="built_in">this</span>.listByIds(attrIds);</span><br><span class="line">    <span class="keyword">return</span> (List&lt;AttrEntity&gt;) attrEntities;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>AttrGroupController 添加以下方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&#123;attrgroupId&#125;/attr/relation&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">attrRelation</span><span class="params">(<span class="meta">@PathVariable(&quot;attrgroupId&quot;)</span> Long attrgroupId)</span>&#123;</span><br><span class="line">        List&lt;AttrEntity&gt; entities =  attrService.getRelationAttr(attrgroupId);</span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;data&quot;</span>,entities);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>2.删除关联</p>
<p>增加 AttrGroupRelationVo </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AttrGroupRelationVo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//&quot;attrId&quot;:1,&quot;attrGroupId&quot;:2</span></span><br><span class="line">    <span class="keyword">private</span> Long attrId;</span><br><span class="line">    <span class="keyword">private</span> Long attrGroupId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>AttrServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteRelation</span><span class="params">(AttrGroupRelationVo[] vos)</span> &#123;</span><br><span class="line">    <span class="comment">//relationDao.delete(new QueryWrapper&lt;&gt;().eq(&quot;attr_id&quot;,1L).eq(&quot;attr_group_id&quot;,1L));</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    List&lt;AttrAttrgroupRelationEntity&gt; entities = Arrays.asList(vos).stream().map((item) -&gt; &#123;</span><br><span class="line">        <span class="type">AttrAttrgroupRelationEntity</span> <span class="variable">relationEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AttrAttrgroupRelationEntity</span>();</span><br><span class="line">        BeanUtils.copyProperties(item, relationEntity);</span><br><span class="line">        <span class="keyword">return</span> relationEntity;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    relationDao.deleteBatchRelation(entities);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>AttrGroupController 增加</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/attr/relation/delete&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">deleteRelation</span><span class="params">(<span class="meta">@RequestBody</span>  AttrGroupRelationVo[] vos)</span>&#123;</span><br><span class="line">        attrService.deleteRelation(vos);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>AttrAttrgroupRelationDao</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">deleteBatchRelation</span><span class="params">(<span class="meta">@Param(value = &quot;entities&quot;)</span> List&lt;AttrAttrgroupRelationEntity&gt; entities)</span>;</span><br></pre></td></tr></table></figure>

<p>AttrAttrgroupRelationDao.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteBatchRelation&quot;</span>&gt;</span></span><br><span class="line">       DELETE FROM `pms_attr_attrgroup_relation` WHERE</span><br><span class="line">       <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">separator</span>=<span class="string">&quot; OR &quot;</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span> <span class="attr">collection</span>=<span class="string">&quot;entities&quot;</span>&gt;</span>(attr_id=#&#123;item.attrId&#125; AND</span><br><span class="line">           attr_group_id=#&#123;item.attrGroupId&#125;)</span><br><span class="line">       <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="查询分组未关联属性"><a href="#查询分组未关联属性" class="headerlink" title="查询分组未关联属性"></a>查询分组未关联属性</h4><p>AttrGroupController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&#123;attrgroupId&#125;/noattr/relation&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">attrNoRelation</span><span class="params">(<span class="meta">@PathVariable(&quot;attrgroupId&quot;)</span> Long attrgroupId,</span></span><br><span class="line"><span class="params">                        <span class="meta">@RequestParam</span> Map&lt;String, Object&gt; params)</span>&#123;</span><br><span class="line">    <span class="type">PageUtils</span> <span class="variable">page</span> <span class="operator">=</span> attrService.getNoRelationAttr(params,attrgroupId);</span><br><span class="line">    <span class="keyword">return</span> R.ok().put(<span class="string">&quot;page&quot;</span>,page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>AttrServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取当前分组没有关联的所有属性</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> params</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> attrgroupId</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> PageUtils <span class="title function_">getNoRelationAttr</span><span class="params">(Map&lt;String, Object&gt; params, Long attrgroupId)</span> &#123;</span><br><span class="line">    <span class="comment">//1、当前分组只能关联自己所属的分类里面的所有属性</span></span><br><span class="line">    <span class="type">AttrGroupEntity</span> <span class="variable">attrGroupEntity</span> <span class="operator">=</span> attrGroupDao.selectById(attrgroupId);</span><br><span class="line">    <span class="type">Long</span> <span class="variable">catelogId</span> <span class="operator">=</span> attrGroupEntity.getCatelogId();</span><br><span class="line">    <span class="comment">//2、当前分组只能关联别的分组没有引用的属性</span></span><br><span class="line">    <span class="comment">//2.1)、当前分类下的其他分组</span></span><br><span class="line">    List&lt;AttrGroupEntity&gt; group = attrGroupDao.selectList(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;AttrGroupEntity&gt;().eq(<span class="string">&quot;catelog_id&quot;</span>, catelogId));</span><br><span class="line">    List&lt;Long&gt; collect = group.stream().map(item -&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> item.getAttrGroupId();</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.2)、这些分组关联的属性</span></span><br><span class="line">    List&lt;AttrAttrgroupRelationEntity&gt; groupId = relationDao.selectList(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;AttrAttrgroupRelationEntity&gt;().in(<span class="string">&quot;attr_group_id&quot;</span>, collect));</span><br><span class="line">    List&lt;Long&gt; attrIds = groupId.stream().map(item -&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> item.getAttrId();</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.3)、从当前分类的所有属性中移除这些属性；</span></span><br><span class="line">    QueryWrapper&lt;AttrEntity&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;AttrEntity&gt;().eq(<span class="string">&quot;catelog_id&quot;</span>, catelogId).eq(<span class="string">&quot;attr_type&quot;</span>,ProductConstant.AttrEnum.ATTR_TYPE_BASE.getCode());</span><br><span class="line">    <span class="keyword">if</span>(attrIds!=<span class="literal">null</span> &amp;&amp; attrIds.size()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        wrapper.notIn(<span class="string">&quot;attr_id&quot;</span>, attrIds);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!StringUtils.isEmpty(key))&#123;</span><br><span class="line">        wrapper.and((w)-&gt;&#123;</span><br><span class="line">            w.eq(<span class="string">&quot;attr_id&quot;</span>,key).or().like(<span class="string">&quot;attr_name&quot;</span>,key);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    IPage&lt;AttrEntity&gt; page = <span class="built_in">this</span>.page(<span class="keyword">new</span> <span class="title class_">Query</span>&lt;AttrEntity&gt;().getPage(params), wrapper);</span><br><span class="line">    <span class="type">PageUtils</span> <span class="variable">pageUtils</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageUtils</span>(page);</span><br><span class="line">    <span class="keyword">return</span> pageUtils;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="新增分组与属性关联"><a href="#新增分组与属性关联" class="headerlink" title="新增分组与属性关联"></a>新增分组与属性关联</h4><p>AttrAttrgroupRelationServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveBatch</span><span class="params">(List&lt;AttrGroupRelationVo&gt; vos)</span> &#123;</span><br><span class="line">        List&lt;AttrAttrgroupRelationEntity&gt; collect = vos.stream().map(item -&gt; &#123;</span><br><span class="line">            <span class="type">AttrAttrgroupRelationEntity</span> <span class="variable">relationEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AttrAttrgroupRelationEntity</span>();</span><br><span class="line">            BeanUtils.copyProperties(item, relationEntity);</span><br><span class="line">            <span class="keyword">return</span> relationEntity;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line">        <span class="built_in">this</span>.saveBatch(collect);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>AttrGroupController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/attr/relation&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> R <span class="title function_">addRelation</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;AttrGroupRelationVo&gt; vos)</span>&#123;</span><br><span class="line">       relationService.saveBatch(vos);</span><br><span class="line">       <span class="keyword">return</span> R.ok();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="新增商品"><a href="#新增商品" class="headerlink" title="新增商品"></a>新增商品</h3><h4 id="调试会员等级相关接口"><a href="#调试会员等级相关接口" class="headerlink" title="调试会员等级相关接口"></a>调试会员等级相关接口</h4><p>1.在网关模块添加Member模块路由配置</p>
<p>routes.yml</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">member_route</span></span><br><span class="line">  <span class="attr">uri:</span> <span class="string">lb://supermall-member</span></span><br><span class="line">  <span class="attr">predicates:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Path=/api/member/**</span></span><br><span class="line">  <span class="attr">filters:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">RewritePath=/api/(?&lt;segment&gt;.*),/$\&#123;segment&#125;</span></span><br></pre></td></tr></table></figure>

<p>2.在会员页面调试新增接口，添加会员信息</p>
<h4 id="获取分类关联的品牌"><a href="#获取分类关联的品牌" class="headerlink" title="获取分类关联的品牌"></a>获取分类关联的品牌</h4><p>CategoryBrandRelationController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  /product/categorybrandrelation/brands/list</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *  1、Controller：处理请求，接受和校验数据</span></span><br><span class="line"><span class="comment">     *  2、Service接受controller传来的数据，进行业务处理</span></span><br><span class="line"><span class="comment">     *  3、Controller接受Service处理完的数据，封装页面指定的vo</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/brands/list&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">relationBrandsList</span><span class="params">(<span class="meta">@RequestParam(value = &quot;catId&quot;,required = true)</span>Long catId)</span>&#123;</span><br><span class="line">        List&lt;BrandEntity&gt; vos = categoryBrandRelationService.getBrandsByCatId(catId);</span><br><span class="line">        List&lt;BrandVo&gt; collect = vos.stream().map(item -&gt; &#123;</span><br><span class="line">            <span class="type">BrandVo</span> <span class="variable">brandVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BrandVo</span>();</span><br><span class="line">            brandVo.setBrandId(item.getBrandId());</span><br><span class="line">            brandVo.setBrandName(item.getName());</span><br><span class="line">            <span class="keyword">return</span> brandVo;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;data&quot;</span>,collect);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>CategoryBrandRelationServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;BrandEntity&gt; <span class="title function_">getBrandsByCatId</span><span class="params">(Long catId)</span> &#123;</span><br><span class="line"></span><br><span class="line">        List&lt;CategoryBrandRelationEntity&gt; catelogId = relationDao.selectList(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;CategoryBrandRelationEntity&gt;().eq(<span class="string">&quot;catelog_id&quot;</span>, catId));</span><br><span class="line">        List&lt;BrandEntity&gt; collect = catelogId.stream().map(item -&gt; &#123;</span><br><span class="line">            <span class="type">Long</span> <span class="variable">brandId</span> <span class="operator">=</span> item.getBrandId();</span><br><span class="line">            <span class="type">BrandEntity</span> <span class="variable">byId</span> <span class="operator">=</span> brandService.getById(brandId);</span><br><span class="line">            <span class="keyword">return</span> byId;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line">        <span class="keyword">return</span> collect;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>注：前端部分页面引入pubsub-js</p>
<p>1.引入前端组件pubsub-js</p>
<p>现在项目根目录使用命令，下载pubsub-js</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install pubsub-js --save</span><br></pre></td></tr></table></figure>

<p>在spuuadd.vue ，category-cascader.vue，brand-select.vue 引入pubsub-js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 导入</span><br><span class="line">import PubSub from &quot;pubsub-js&quot;</span><br></pre></td></tr></table></figure>

<p>修改部分使用this.PubSub 的地方，直接使用 PubSub。</p>
<h4 id="获取分类下所有分组以及属性"><a href="#获取分类下所有分组以及属性" class="headerlink" title="获取分类下所有分组以及属性"></a>获取分类下所有分组以及属性</h4><p>AttrGroupRelationVo 添加实体类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AttrGroupWithAttrsVo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分组id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long attrGroupId;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 组名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String attrGroupName;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 排序</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer sort;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 描述</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String descript;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 组图标</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String icon;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 所属分类id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long catelogId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;AttrEntity&gt; attrs;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>AttrGroupController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&#123;catelogId&#125;/withattr&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">getAttrGroupWithAttrs</span><span class="params">(<span class="meta">@PathVariable(&quot;catelogId&quot;)</span>Long catelogId)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1、查出当前分类下的所有属性分组，</span></span><br><span class="line">        <span class="comment">//2、查出每个属性分组的所有属性</span></span><br><span class="line">        List&lt;AttrGroupWithAttrsVo&gt; vos =  attrGroupService.getAttrGroupWithAttrsByCatelogId(catelogId);</span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;data&quot;</span>,vos);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>AttrGroupServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据分类id查出所有的分组以及这些组里面的属性</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> catelogId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;AttrGroupWithAttrsVo&gt; <span class="title function_">getAttrGroupWithAttrsByCatelogId</span><span class="params">(Long catelogId)</span> &#123;</span><br><span class="line">        <span class="comment">//com.atguigu.gulimall.product.vo</span></span><br><span class="line">        <span class="comment">//1、查询分组信息</span></span><br><span class="line">        List&lt;AttrGroupEntity&gt; attrGroupEntities = <span class="built_in">this</span>.list(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;AttrGroupEntity&gt;().eq(<span class="string">&quot;catelog_id&quot;</span>, catelogId));</span><br><span class="line">        <span class="comment">//2、查询所有属性</span></span><br><span class="line">        List&lt;AttrGroupWithAttrsVo&gt; collect = attrGroupEntities.stream().map(group -&gt; &#123;</span><br><span class="line">            <span class="type">AttrGroupWithAttrsVo</span> <span class="variable">attrsVo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AttrGroupWithAttrsVo</span>();</span><br><span class="line">            BeanUtils.copyProperties(group,attrsVo);</span><br><span class="line">            List&lt;AttrEntity&gt; attrs = attrService.getRelationAttr(attrsVo.getAttrGroupId());</span><br><span class="line">            attrsVo.setAttrs(attrs);</span><br><span class="line">            <span class="keyword">return</span> attrsVo;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line">        <span class="keyword">return</span> collect;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>修改spuadd.vue的showBaseAttrs()</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">showBaseAttrs() &#123;</span><br><span class="line">      if (!this.dataResp.steped[0]) &#123;</span><br><span class="line">        this.$http(&#123;</span><br><span class="line">          url: this.$http.adornUrl(</span><br><span class="line">            `/product/attrgroup/$&#123;this.spu.catalogId&#125;/withattr`</span><br><span class="line">          ),</span><br><span class="line">          method: &quot;get&quot;,</span><br><span class="line">          params: this.$http.adornParams(&#123;&#125;)</span><br><span class="line">        &#125;).then((&#123; data &#125;) =&gt; &#123;</span><br><span class="line">          //先对表单的baseAttrs进行初始化</span><br><span class="line">          data.data.forEach(item =&gt; &#123;</span><br><span class="line">            let attrArray = [];</span><br><span class="line">            if (item.attrs) &#123;</span><br><span class="line">              item.attrs.forEach(attr =&gt; &#123;</span><br><span class="line">                attrArray.push(&#123;</span><br><span class="line">                  attrId: attr.attrId,</span><br><span class="line">                  attrValues: &quot;&quot;,</span><br><span class="line">                  showDesc: attr.showDesc</span><br><span class="line">                &#125;);</span><br><span class="line">              &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            this.dataResp.baseAttrs.push(attrArray);</span><br><span class="line">          &#125;);</span><br><span class="line">          this.dataResp.steped[0] = 0;</span><br><span class="line">          this.dataResp.attrGroups = data.data;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="商品新增VO抽取"><a href="#商品新增VO抽取" class="headerlink" title="商品新增VO抽取"></a>商品新增VO抽取</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Attr</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long attrId;</span><br><span class="line">    <span class="keyword">private</span> String attrName;</span><br><span class="line">    <span class="keyword">private</span> String attrValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseAttrs</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long attrId;</span><br><span class="line">    <span class="keyword">private</span> String attrValues;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> showDesc;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bounds</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> BigDecimal buyBounds;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal growBounds;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Images</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String imgUrl;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> defaultImg;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MemberPrice</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Skus</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;Attr&gt; attr;</span><br><span class="line">    <span class="keyword">private</span> String skuName;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line">    <span class="keyword">private</span> String skuTitle;</span><br><span class="line">    <span class="keyword">private</span> String skuSubtitle;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Images&gt; images;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; descar;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> fullCount;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal discount;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> countStatus;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal fullPrice;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal reducePrice;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> priceStatus;</span><br><span class="line">    <span class="keyword">private</span> List&lt;MemberPrice&gt; memberPrice;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpuSaveVo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String spuName;</span><br><span class="line">    <span class="keyword">private</span> String spuDescription;</span><br><span class="line">    <span class="keyword">private</span> Long catalogId;</span><br><span class="line">    <span class="keyword">private</span> Long brandId;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal weight;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> publishStatus;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; decript;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; images;</span><br><span class="line">    <span class="keyword">private</span> Bounds bounds;</span><br><span class="line">    <span class="keyword">private</span> List&lt;BaseAttrs&gt; baseAttrs;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Skus&gt; skus;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="商品新增业务流程分析"><a href="#商品新增业务流程分析" class="headerlink" title="商品新增业务流程分析"></a>商品新增业务流程分析</h4><p>SpuInfoServiceImpl 下增加预备方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveSpuInfo</span><span class="params">(SpuSaveVo vo)</span> &#123;</span><br><span class="line">    <span class="comment">//1、保存spu基本信息 pms_spu_info</span></span><br><span class="line">    <span class="comment">//2、保存Spu的描述图片 pms_spu_info_desc</span></span><br><span class="line">    <span class="comment">//3、保存spu的图片集 pms_spu_images</span></span><br><span class="line">    <span class="comment">//4、保存spu的规格参数;pms_product_attr_value</span></span><br><span class="line">    <span class="comment">//5、保存spu的积分信息；supermall_sms-&gt;sms_spu_bounds</span></span><br><span class="line">    <span class="comment">//5、保存当前spu对应的所有sku信息；</span></span><br><span class="line">    <span class="comment">//5.1）、sku的基本信息；pms_sku_info</span></span><br><span class="line">    <span class="comment">//5.2）、sku的图片信息；pms_sku_image</span></span><br><span class="line">    <span class="comment">//5.3）、sku的销售属性信息：pms_sku_sale_attr_value</span></span><br><span class="line">    <span class="comment">// //5.4）、sku的优惠、满减等信息；supermall_sms-&gt;sms_sku_ladder\sms_sku_full_reduction\sms_member_price</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SpuInfoController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line">    <span class="comment">//@RequiresPermissions(&quot;product:spuinfo:save&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> SpuSaveVo vo)</span>&#123;</span><br><span class="line">        spuInfoService.saveSpuInfo(vo);</span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="保存SPU基本信息"><a href="#保存SPU基本信息" class="headerlink" title="保存SPU基本信息"></a>保存SPU基本信息</h4><p>新增修改 SpuInfoServiceImpl </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">SpuInfoDescService spuInfoDescService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">SpuImagesService imagesService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">AttrService attrService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">ProductAttrValueService attrValueService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveSpuInfo</span><span class="params">(SpuSaveVo vo)</span> &#123;</span><br><span class="line">    <span class="comment">//1、保存spu基本信息 pms_spu_info</span></span><br><span class="line">    <span class="type">SpuInfoEntity</span> <span class="variable">infoEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpuInfoEntity</span>();</span><br><span class="line">    BeanUtils.copyProperties(vo,infoEntity);</span><br><span class="line">    infoEntity.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    infoEntity.setUpdateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    <span class="built_in">this</span>.saveBaseSpuInfo(infoEntity);</span><br><span class="line">    <span class="comment">//2、保存Spu的描述图片 pms_spu_info_desc</span></span><br><span class="line">    List&lt;String&gt; decript = vo.getDecript();</span><br><span class="line">    <span class="type">SpuInfoDescEntity</span> <span class="variable">descEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpuInfoDescEntity</span>();</span><br><span class="line">    descEntity.setSpuId(infoEntity.getId());</span><br><span class="line">    descEntity.setDecript(String.join(<span class="string">&quot;,&quot;</span>,decript));</span><br><span class="line">    spuInfoDescService.saveSpuInfoDesc(descEntity);</span><br><span class="line">    <span class="comment">//3、保存spu的图片集 pms_spu_images</span></span><br><span class="line">    List&lt;String&gt; images = vo.getImages();</span><br><span class="line">    imagesService.saveImages(infoEntity.getId(),images);</span><br><span class="line">    <span class="comment">//4、保存spu的规格参数;pms_product_attr_value</span></span><br><span class="line">    List&lt;BaseAttrs&gt; baseAttrs = vo.getBaseAttrs();</span><br><span class="line">    List&lt;ProductAttrValueEntity&gt; collect = baseAttrs.stream().map(attr -&gt; &#123;</span><br><span class="line">        <span class="type">ProductAttrValueEntity</span> <span class="variable">valueEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProductAttrValueEntity</span>();</span><br><span class="line">        valueEntity.setAttrId(attr.getAttrId());</span><br><span class="line">        <span class="type">AttrEntity</span> <span class="variable">id</span> <span class="operator">=</span> attrService.getById(attr.getAttrId());</span><br><span class="line">        valueEntity.setAttrName(id.getAttrName());</span><br><span class="line">        valueEntity.setAttrValue(attr.getAttrValues());</span><br><span class="line">        valueEntity.setQuickShow(attr.getShowDesc());</span><br><span class="line">        valueEntity.setSpuId(infoEntity.getId());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> valueEntity;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    attrValueService.saveProductAttr(collect);</span><br><span class="line">    <span class="comment">//5、保存spu的积分信息；supermall_sms-&gt;sms_spu_bounds</span></span><br><span class="line">    <span class="comment">//5、保存当前spu对应的所有sku信息；</span></span><br><span class="line">    <span class="comment">//5.1）、sku的基本信息；pms_sku_info</span></span><br><span class="line">    <span class="comment">//5.2）、sku的图片信息；pms_sku_image</span></span><br><span class="line">    <span class="comment">//5.3）、sku的销售属性信息：pms_sku_sale_attr_value</span></span><br><span class="line">    <span class="comment">// //5.4）、sku的优惠、满减等信息；supermall_sms-&gt;sms_sku_ladder\sms_sku_full_reduction\sms_member_price</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveBaseSpuInfo</span><span class="params">(SpuInfoEntity infoEntity)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.baseMapper.insert(infoEntity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> SpuInfoDescServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveSpuInfoDesc</span><span class="params">(SpuInfoDescEntity descEntity)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.baseMapper.insert(descEntity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SpuImagesServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveImages</span><span class="params">(Long id, List&lt;String&gt; images)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (images == <span class="literal">null</span> || images.size() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            List&lt;SpuImagesEntity&gt; collect = images.stream().map(img -&gt; &#123;</span><br><span class="line">                <span class="type">SpuImagesEntity</span> <span class="variable">spuImagesEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpuImagesEntity</span>();</span><br><span class="line">                spuImagesEntity.setSpuId(id);</span><br><span class="line">                spuImagesEntity.setImgUrl(img);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> spuImagesEntity;</span><br><span class="line">            &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">            <span class="built_in">this</span>.saveBatch(collect);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>ProductAttrValueServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveProductAttr</span><span class="params">(List&lt;ProductAttrValueEntity&gt; collect)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.saveBatch(collect);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="保存SKU基本信息"><a href="#保存SKU基本信息" class="headerlink" title="保存SKU基本信息"></a>保存SKU基本信息</h4><p>修改SpuInfoServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">SkuInfoService skuInfoService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">SkuImagesService skuImagesService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">SkuSaleAttrValueService skuSaleAttrValueService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveSpuInfo</span><span class="params">(SpuSaveVo vo)</span> &#123;</span><br><span class="line">    <span class="comment">//1、保存spu基本信息 pms_spu_info</span></span><br><span class="line">    <span class="type">SpuInfoEntity</span> <span class="variable">infoEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpuInfoEntity</span>();</span><br><span class="line">    BeanUtils.copyProperties(vo, infoEntity);</span><br><span class="line">    infoEntity.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    infoEntity.setUpdateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    <span class="built_in">this</span>.saveBaseSpuInfo(infoEntity);</span><br><span class="line">    <span class="comment">//2、保存Spu的描述图片 pms_spu_info_desc</span></span><br><span class="line">    List&lt;String&gt; decript = vo.getDecript();</span><br><span class="line">    <span class="type">SpuInfoDescEntity</span> <span class="variable">descEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpuInfoDescEntity</span>();</span><br><span class="line">    descEntity.setSpuId(infoEntity.getId());</span><br><span class="line">    descEntity.setDecript(String.join(<span class="string">&quot;,&quot;</span>, decript));</span><br><span class="line">    spuInfoDescService.saveSpuInfoDesc(descEntity);</span><br><span class="line">    <span class="comment">//3、保存spu的图片集 pms_spu_images</span></span><br><span class="line">    List&lt;String&gt; images = vo.getImages();</span><br><span class="line">    imagesService.saveImages(infoEntity.getId(), images);</span><br><span class="line">    <span class="comment">//4、保存spu的规格参数;pms_product_attr_value</span></span><br><span class="line">    List&lt;BaseAttrs&gt; baseAttrs = vo.getBaseAttrs();</span><br><span class="line">    List&lt;ProductAttrValueEntity&gt; collect = baseAttrs.stream().map(attr -&gt; &#123;</span><br><span class="line">        <span class="type">ProductAttrValueEntity</span> <span class="variable">valueEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProductAttrValueEntity</span>();</span><br><span class="line">        valueEntity.setAttrId(attr.getAttrId());</span><br><span class="line">        <span class="type">AttrEntity</span> <span class="variable">id</span> <span class="operator">=</span> attrService.getById(attr.getAttrId());</span><br><span class="line">        valueEntity.setAttrName(id.getAttrName());</span><br><span class="line">        valueEntity.setAttrValue(attr.getAttrValues());</span><br><span class="line">        valueEntity.setQuickShow(attr.getShowDesc());</span><br><span class="line">        valueEntity.setSpuId(infoEntity.getId());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> valueEntity;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    attrValueService.saveProductAttr(collect);</span><br><span class="line">    <span class="comment">//5、保存spu的积分信息；supermall_sms-&gt;sms_spu_bounds</span></span><br><span class="line">    <span class="comment">// todo</span></span><br><span class="line">    <span class="comment">//5、保存当前spu对应的所有sku信息；</span></span><br><span class="line">    List&lt;Skus&gt; skus = vo.getSkus();</span><br><span class="line">    <span class="keyword">if</span> (skus != <span class="literal">null</span> &amp;&amp; skus.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        skus.forEach(item -&gt; &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">defaultImg</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">for</span> (Images image : item.getImages()) &#123;</span><br><span class="line">                <span class="keyword">if</span> (image.getDefaultImg() == <span class="number">1</span>) &#123;</span><br><span class="line">                    defaultImg = image.getImgUrl();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//    private String skuName;</span></span><br><span class="line">            <span class="comment">//    private BigDecimal price;</span></span><br><span class="line">            <span class="comment">//    private String skuTitle;</span></span><br><span class="line">            <span class="comment">//    private String skuSubtitle;</span></span><br><span class="line">            <span class="type">SkuInfoEntity</span> <span class="variable">skuInfoEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SkuInfoEntity</span>();</span><br><span class="line">            BeanUtils.copyProperties(item, skuInfoEntity);</span><br><span class="line">            skuInfoEntity.setBrandId(infoEntity.getBrandId());</span><br><span class="line">            skuInfoEntity.setCatalogId(infoEntity.getCatalogId());</span><br><span class="line">            skuInfoEntity.setSaleCount(<span class="number">0L</span>);</span><br><span class="line">            skuInfoEntity.setSpuId(infoEntity.getId());</span><br><span class="line">            skuInfoEntity.setSkuDefaultImg(defaultImg);</span><br><span class="line">            <span class="comment">//5.1）、sku的基本信息；pms_sku_info</span></span><br><span class="line">            skuInfoService.saveSkuInfo(skuInfoEntity);</span><br><span class="line">            <span class="type">Long</span> <span class="variable">skuId</span> <span class="operator">=</span> skuInfoEntity.getSkuId();</span><br><span class="line">            List&lt;SkuImagesEntity&gt; imagesEntities = item.getImages().stream().map(img -&gt; &#123;</span><br><span class="line">                <span class="type">SkuImagesEntity</span> <span class="variable">skuImagesEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SkuImagesEntity</span>();</span><br><span class="line">                skuImagesEntity.setSkuId(skuId);</span><br><span class="line">                skuImagesEntity.setImgUrl(img.getImgUrl());</span><br><span class="line">                skuImagesEntity.setDefaultImg(img.getDefaultImg());</span><br><span class="line">                <span class="keyword">return</span> skuImagesEntity;</span><br><span class="line">            &#125;).filter(entity-&gt;&#123;</span><br><span class="line">                <span class="comment">//返回true就是需要，false就是剔除</span></span><br><span class="line">                <span class="keyword">return</span> !StringUtils.isEmpty(entity.getImgUrl());</span><br><span class="line">            &#125;).collect(Collectors.toList());</span><br><span class="line">            <span class="comment">//5.2）、sku的图片信息；pms_sku_image</span></span><br><span class="line">            skuImagesService.saveBatch(imagesEntities);</span><br><span class="line">            <span class="comment">//没有图片路径的无需保存</span></span><br><span class="line">            List&lt;Attr&gt; attr = item.getAttr();</span><br><span class="line">            List&lt;SkuSaleAttrValueEntity&gt; skuSaleAttrValueEntities = attr.stream().map(a -&gt; &#123;</span><br><span class="line">                <span class="type">SkuSaleAttrValueEntity</span> <span class="variable">attrValueEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SkuSaleAttrValueEntity</span>();</span><br><span class="line">                BeanUtils.copyProperties(a, attrValueEntity);</span><br><span class="line">                attrValueEntity.setSkuId(skuId);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> attrValueEntity;</span><br><span class="line">            &#125;).collect(Collectors.toList());</span><br><span class="line">            <span class="comment">//5.3）、sku的销售属性信息：pms_sku_sale_attr_value</span></span><br><span class="line">            skuSaleAttrValueService.saveBatch(skuSaleAttrValueEntities);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//5.4）、sku的优惠、满减等信息；supermall_sms-&gt;sms_sku_ladder\sms_sku_full_reduction\sms_member_price</span></span><br><span class="line">    <span class="comment">//todo</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SkuInfoServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveSkuInfo</span><span class="params">(SkuInfoEntity skuInfoEntity)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.baseMapper.insert(skuInfoEntity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="调用远程服务保存优惠等信息"><a href="#调用远程服务保存优惠等信息" class="headerlink" title="调用远程服务保存优惠等信息"></a>调用远程服务保存优惠等信息</h4><p>1.product模块的处理</p>
<p>1.1 在product模块下创建feign包，新建一个CouponFeignService远程调用接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;supermall-coupon&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CouponFeignService</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1、CouponFeignService.saveSpuBounds(spuBoundTo);</span></span><br><span class="line"><span class="comment">     *      1）、<span class="doctag">@RequestBody</span>将这个对象转为json。</span></span><br><span class="line"><span class="comment">     *      2）、找到gulimall-coupon服务，给/coupon/spubounds/save发送请求。</span></span><br><span class="line"><span class="comment">     *          将上一步转的json放在请求体位置，发送请求；</span></span><br><span class="line"><span class="comment">     *      3）、对方服务收到请求。请求体里有json数据。</span></span><br><span class="line"><span class="comment">     *          (<span class="doctag">@RequestBody</span> SpuBoundsEntity spuBounds)；将请求体的json转为SpuBoundsEntity；</span></span><br><span class="line"><span class="comment">     * 只要json数据模型是兼容的。双方服务无需使用同一个to</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> spuBoundTo</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/coupon/spubounds/save&quot;)</span></span><br><span class="line">    R <span class="title function_">saveSpuBounds</span><span class="params">(<span class="meta">@RequestBody</span> SpuBoundTo spuBoundTo)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/coupon/skufullreduction/saveinfo&quot;)</span></span><br><span class="line">    R <span class="title function_">saveSkuReduction</span><span class="params">(<span class="meta">@RequestBody</span> SkuReductionTo skuReductionTo)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1.2 在common模块新建一个to包，在该包下新建涉及的TO类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpuBoundTo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long spuId;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal buyBounds;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal growBounds;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SkuReductionTo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long skuId;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> fullCount;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal discount;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> countStatus;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal fullPrice;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal reducePrice;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> priceStatus;</span><br><span class="line">    <span class="keyword">private</span> List&lt;MemberPrice&gt; memberPrice;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MemberPrice</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1.3 修改SpuInfoServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">CouponFeignService couponFeignService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveSpuInfo</span><span class="params">(SpuSaveVo vo)</span> &#123;</span><br><span class="line">    <span class="comment">//1、保存spu基本信息 pms_spu_info</span></span><br><span class="line">    <span class="type">SpuInfoEntity</span> <span class="variable">infoEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpuInfoEntity</span>();</span><br><span class="line">    BeanUtils.copyProperties(vo, infoEntity);</span><br><span class="line">    infoEntity.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    infoEntity.setUpdateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    <span class="built_in">this</span>.saveBaseSpuInfo(infoEntity);</span><br><span class="line">    <span class="comment">//2、保存Spu的描述图片 pms_spu_info_desc</span></span><br><span class="line">    List&lt;String&gt; decript = vo.getDecript();</span><br><span class="line">    <span class="type">SpuInfoDescEntity</span> <span class="variable">descEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpuInfoDescEntity</span>();</span><br><span class="line">    descEntity.setSpuId(infoEntity.getId());</span><br><span class="line">    descEntity.setDecript(String.join(<span class="string">&quot;,&quot;</span>, decript));</span><br><span class="line">    spuInfoDescService.saveSpuInfoDesc(descEntity);</span><br><span class="line">    <span class="comment">//3、保存spu的图片集 pms_spu_images</span></span><br><span class="line">    List&lt;String&gt; images = vo.getImages();</span><br><span class="line">    imagesService.saveImages(infoEntity.getId(), images);</span><br><span class="line">    <span class="comment">//4、保存spu的规格参数;pms_product_attr_value</span></span><br><span class="line">    List&lt;BaseAttrs&gt; baseAttrs = vo.getBaseAttrs();</span><br><span class="line">    List&lt;ProductAttrValueEntity&gt; collect = baseAttrs.stream().map(attr -&gt; &#123;</span><br><span class="line">        <span class="type">ProductAttrValueEntity</span> <span class="variable">valueEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProductAttrValueEntity</span>();</span><br><span class="line">        valueEntity.setAttrId(attr.getAttrId());</span><br><span class="line">        <span class="type">AttrEntity</span> <span class="variable">id</span> <span class="operator">=</span> attrService.getById(attr.getAttrId());</span><br><span class="line">        valueEntity.setAttrName(id.getAttrName());</span><br><span class="line">        valueEntity.setAttrValue(attr.getAttrValues());</span><br><span class="line">        valueEntity.setQuickShow(attr.getShowDesc());</span><br><span class="line">        valueEntity.setSpuId(infoEntity.getId());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> valueEntity;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    attrValueService.saveProductAttr(collect);</span><br><span class="line">    <span class="comment">//5、保存spu的积分信息；supermall_sms-&gt;sms_spu_bounds</span></span><br><span class="line">    <span class="type">Bounds</span> <span class="variable">bounds</span> <span class="operator">=</span> vo.getBounds();</span><br><span class="line">    <span class="type">SpuBoundTo</span> <span class="variable">spuBoundTo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpuBoundTo</span>();</span><br><span class="line">    BeanUtils.copyProperties(bounds,spuBoundTo);</span><br><span class="line">    spuBoundTo.setSpuId(infoEntity.getId());</span><br><span class="line">    <span class="type">R</span> <span class="variable">r</span> <span class="operator">=</span> couponFeignService.saveSpuBounds(spuBoundTo);</span><br><span class="line">    <span class="keyword">if</span>(r.getCode() != <span class="number">0</span>)&#123;</span><br><span class="line">        log.error(<span class="string">&quot;远程保存spu积分信息失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//5、保存当前spu对应的所有sku信息；</span></span><br><span class="line">    List&lt;Skus&gt; skus = vo.getSkus();</span><br><span class="line">    <span class="keyword">if</span> (skus != <span class="literal">null</span> &amp;&amp; skus.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        skus.forEach(item -&gt; &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">defaultImg</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">for</span> (Images image : item.getImages()) &#123;</span><br><span class="line">                <span class="keyword">if</span> (image.getDefaultImg() == <span class="number">1</span>) &#123;</span><br><span class="line">                    defaultImg = image.getImgUrl();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//    private String skuName;</span></span><br><span class="line">            <span class="comment">//    private BigDecimal price;</span></span><br><span class="line">            <span class="comment">//    private String skuTitle;</span></span><br><span class="line">            <span class="comment">//    private String skuSubtitle;</span></span><br><span class="line">            <span class="type">SkuInfoEntity</span> <span class="variable">skuInfoEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SkuInfoEntity</span>();</span><br><span class="line">            BeanUtils.copyProperties(item, skuInfoEntity);</span><br><span class="line">            skuInfoEntity.setBrandId(infoEntity.getBrandId());</span><br><span class="line">            skuInfoEntity.setCatalogId(infoEntity.getCatalogId());</span><br><span class="line">            skuInfoEntity.setSaleCount(<span class="number">0L</span>);</span><br><span class="line">            skuInfoEntity.setSpuId(infoEntity.getId());</span><br><span class="line">            skuInfoEntity.setSkuDefaultImg(defaultImg);</span><br><span class="line">            <span class="comment">//5.1）、sku的基本信息；pms_sku_info</span></span><br><span class="line">            skuInfoService.saveSkuInfo(skuInfoEntity);</span><br><span class="line">            <span class="type">Long</span> <span class="variable">skuId</span> <span class="operator">=</span> skuInfoEntity.getSkuId();</span><br><span class="line">            List&lt;SkuImagesEntity&gt; imagesEntities = item.getImages().stream().map(img -&gt; &#123;</span><br><span class="line">                <span class="type">SkuImagesEntity</span> <span class="variable">skuImagesEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SkuImagesEntity</span>();</span><br><span class="line">                skuImagesEntity.setSkuId(skuId);</span><br><span class="line">                skuImagesEntity.setImgUrl(img.getImgUrl());</span><br><span class="line">                skuImagesEntity.setDefaultImg(img.getDefaultImg());</span><br><span class="line">                <span class="keyword">return</span> skuImagesEntity;</span><br><span class="line">            &#125;).filter(entity-&gt;&#123;</span><br><span class="line">                <span class="comment">//返回true就是需要，false就是剔除</span></span><br><span class="line">                <span class="keyword">return</span> !StringUtils.isEmpty(entity.getImgUrl());</span><br><span class="line">            &#125;).collect(Collectors.toList());</span><br><span class="line">            <span class="comment">//5.2）、sku的图片信息；pms_sku_image</span></span><br><span class="line">            skuImagesService.saveBatch(imagesEntities);</span><br><span class="line">            <span class="comment">//没有图片路径的无需保存</span></span><br><span class="line">            List&lt;Attr&gt; attr = item.getAttr();</span><br><span class="line">            List&lt;SkuSaleAttrValueEntity&gt; skuSaleAttrValueEntities = attr.stream().map(a -&gt; &#123;</span><br><span class="line">                <span class="type">SkuSaleAttrValueEntity</span> <span class="variable">attrValueEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SkuSaleAttrValueEntity</span>();</span><br><span class="line">                BeanUtils.copyProperties(a, attrValueEntity);</span><br><span class="line">                attrValueEntity.setSkuId(skuId);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> attrValueEntity;</span><br><span class="line">            &#125;).collect(Collectors.toList());</span><br><span class="line">            <span class="comment">//5.3）、sku的销售属性信息：pms_sku_sale_attr_value</span></span><br><span class="line">            skuSaleAttrValueService.saveBatch(skuSaleAttrValueEntities);</span><br><span class="line">            <span class="type">SkuReductionTo</span> <span class="variable">skuReductionTo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SkuReductionTo</span>();</span><br><span class="line">            BeanUtils.copyProperties(item,skuReductionTo);</span><br><span class="line">            skuReductionTo.setSkuId(skuId);</span><br><span class="line">            <span class="keyword">if</span>(skuReductionTo.getFullCount() &gt;<span class="number">0</span> || skuReductionTo.getFullPrice().compareTo(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="string">&quot;0&quot;</span>)) == <span class="number">1</span>)&#123;</span><br><span class="line">                <span class="type">R</span> <span class="variable">r1</span> <span class="operator">=</span> couponFeignService.saveSkuReduction(skuReductionTo);</span><br><span class="line">                <span class="keyword">if</span>(r1.getCode() != <span class="number">0</span>)&#123;</span><br><span class="line">                    log.error(<span class="string">&quot;远程保存sku优惠信息失败&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1.4 在启动类加入@EnableFeignClients(basePackages &#x3D; “com.centersept.supermall.product.feign”)注解，开启远程调用功能。</p>
<p>2.处理coupon模块</p>
<p>2.1 在nacos上配置Coupon模块的配置文件，Coupon模块引入nacos的配置</p>
<p>2.2 修改SpuBoundsController 方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/save&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> SpuBoundsEntity spuBounds)</span>&#123;</span><br><span class="line">		spuBoundsService.save(spuBounds);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.ok();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>2.3 新增 SkuFullReductionController 和 SkuFullReductionServiceImpl 的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/saveinfo&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> R <span class="title function_">saveInfo</span><span class="params">(<span class="meta">@RequestBody</span> SkuReductionTo reductionTo)</span>&#123;</span><br><span class="line"></span><br><span class="line">       skuFullReductionService.saveSkuReduction(reductionTo);</span><br><span class="line">       <span class="keyword">return</span> R.ok();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">SkuLadderService skuLadderService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">MemberPriceService memberPriceService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveSkuReduction</span><span class="params">(SkuReductionTo reductionTo)</span> &#123;</span><br><span class="line">    <span class="comment">//1、// //5.4）、sku的优惠、满减等信息；gulimall_sms-&gt;sms_sku_ladder\sms_sku_full_reduction\sms_member_price</span></span><br><span class="line">    <span class="comment">//sms_sku_ladder</span></span><br><span class="line">    <span class="type">SkuLadderEntity</span> <span class="variable">skuLadderEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SkuLadderEntity</span>();</span><br><span class="line">    skuLadderEntity.setSkuId(reductionTo.getSkuId());</span><br><span class="line">    skuLadderEntity.setFullCount(reductionTo.getFullCount());</span><br><span class="line">    skuLadderEntity.setDiscount(reductionTo.getDiscount());</span><br><span class="line">    skuLadderEntity.setAddOther(reductionTo.getCountStatus());</span><br><span class="line">    <span class="keyword">if</span>(reductionTo.getFullCount() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">        skuLadderService.save(skuLadderEntity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2、sms_sku_full_reduction</span></span><br><span class="line">    <span class="type">SkuFullReductionEntity</span> <span class="variable">reductionEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SkuFullReductionEntity</span>();</span><br><span class="line">    BeanUtils.copyProperties(reductionTo,reductionEntity);</span><br><span class="line">    <span class="keyword">if</span>(reductionEntity.getFullPrice().compareTo(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="string">&quot;0&quot;</span>))==<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="built_in">this</span>.save(reductionEntity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3、sms_member_price</span></span><br><span class="line">    List&lt;MemberPrice&gt; memberPrice = reductionTo.getMemberPrice();</span><br><span class="line"></span><br><span class="line">    List&lt;MemberPriceEntity&gt; collect = memberPrice.stream().map(item -&gt; &#123;</span><br><span class="line">        <span class="type">MemberPriceEntity</span> <span class="variable">priceEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MemberPriceEntity</span>();</span><br><span class="line">        priceEntity.setSkuId(reductionTo.getSkuId());</span><br><span class="line">        priceEntity.setMemberLevelId(item.getId());</span><br><span class="line">        priceEntity.setMemberLevelName(item.getName());</span><br><span class="line">        priceEntity.setMemberPrice(item.getPrice());</span><br><span class="line">        priceEntity.setAddOther(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> priceEntity;</span><br><span class="line">    &#125;).filter(item-&gt;&#123;</span><br><span class="line">        <span class="keyword">return</span> item.getMemberPrice().compareTo(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="string">&quot;0&quot;</span>)) == <span class="number">1</span>;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">    memberPriceService.saveBatch(collect);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="商品保存debug完成"><a href="#商品保存debug完成" class="headerlink" title="商品保存debug完成"></a>商品保存debug完成</h4><ol>
<li>使用Idea一键启动全部项目</li>
</ol>
<p>1.1 打开 Edit Configuration… ，点击加号，选择Compound </p>
<p>1.2 在右边的界面点击加号添加需要运行的Application类</p>
<ol start="2">
<li>由于库表的id非自增的，修改 SpuInfoDescEntity 实体类 id 注解为 @TableId(type &#x3D; IdType.INPUT)</li>
</ol>
<h4 id="商品保存其他问题"><a href="#商品保存其他问题" class="headerlink" title="商品保存其他问题"></a>商品保存其他问题</h4><p>1.空图片的数据不需要保存到库中，需要做过滤</p>
<p>2.还有满减和折扣没有设置的，也需要过滤保存</p>
<p>3.还有会员价格。</p>
<h3 id="商品管理"><a href="#商品管理" class="headerlink" title="商品管理"></a>商品管理</h3><h4 id="SPU检索"><a href="#SPU检索" class="headerlink" title="SPU检索"></a>SPU检索</h4><p>1.SPU管理界面查询接口</p>
<p>SpuInfoController </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/list&quot;)</span></span><br><span class="line">    <span class="comment">//@RequiresPermissions(&quot;product:spuinfo:list&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">list</span><span class="params">(<span class="meta">@RequestParam</span> Map&lt;String, Object&gt; params)</span>&#123;</span><br><span class="line">        <span class="type">PageUtils</span> <span class="variable">page</span> <span class="operator">=</span> spuInfoService.queryPageByCondition(params);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.ok().put(<span class="string">&quot;page&quot;</span>, page);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>SpuInfoServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> PageUtils <span class="title function_">queryPageByCondition</span><span class="params">(Map&lt;String, Object&gt; params)</span> &#123;</span><br><span class="line"></span><br><span class="line">        QueryWrapper&lt;SpuInfoEntity&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty(key)) &#123;</span><br><span class="line">            wrapper.and((w) -&gt; &#123;</span><br><span class="line">                w.eq(<span class="string">&quot;id&quot;</span>, key).or().like(<span class="string">&quot;spu_name&quot;</span>, key);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// status=1 and (id=1 or spu_name like xxx)</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">status</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;status&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty(status)) &#123;</span><br><span class="line">            wrapper.eq(<span class="string">&quot;publish_status&quot;</span>, status);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">brandId</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;brandId&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty(brandId) &amp;&amp; !<span class="string">&quot;0&quot;</span>.equalsIgnoreCase(brandId)) &#123;</span><br><span class="line">            wrapper.eq(<span class="string">&quot;brand_id&quot;</span>, brandId);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">catelogId</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;catelogId&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty(catelogId) &amp;&amp; !<span class="string">&quot;0&quot;</span>.equalsIgnoreCase(catelogId)) &#123;</span><br><span class="line">            wrapper.eq(<span class="string">&quot;catalog_id&quot;</span>, catelogId);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * status: 2</span></span><br><span class="line"><span class="comment">         * key:</span></span><br><span class="line"><span class="comment">         * brandId: 9</span></span><br><span class="line"><span class="comment">         * catelogId: 225</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">        IPage&lt;SpuInfoEntity&gt; page = <span class="built_in">this</span>.page(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Query</span>&lt;SpuInfoEntity&gt;().getPage(params),</span><br><span class="line">                wrapper</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageUtils</span>(page);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>2.时间格式化，在application.yml 加入以下配置：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">jackson:</span></span><br><span class="line">    <span class="attr">date-format:</span> <span class="string">yyyy-MM-dd</span> <span class="string">HH:mm:ss</span></span><br></pre></td></tr></table></figure>

<h4 id="SKU检索"><a href="#SKU检索" class="headerlink" title="SKU检索"></a>SKU检索</h4><p>1.SKU管理界面查询</p>
<p>SkuInfoController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 列表</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="comment">//@RequiresPermissions(&quot;product:skuinfo:list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">list</span><span class="params">(<span class="meta">@RequestParam</span> Map&lt;String, Object&gt; params)</span>&#123;</span><br><span class="line">    <span class="type">PageUtils</span> <span class="variable">page</span> <span class="operator">=</span> skuInfoService.queryPageByCondition(params);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.ok().put(<span class="string">&quot;page&quot;</span>, page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SkuInfoServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> PageUtils <span class="title function_">queryPageByCondition</span><span class="params">(Map&lt;String, Object&gt; params)</span> &#123;</span><br><span class="line">    QueryWrapper&lt;SkuInfoEntity&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * key:</span></span><br><span class="line"><span class="comment">     * catelogId: 0</span></span><br><span class="line"><span class="comment">     * brandId: 0</span></span><br><span class="line"><span class="comment">     * min: 0</span></span><br><span class="line"><span class="comment">     * max: 0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!StringUtils.isEmpty(key))&#123;</span><br><span class="line">        queryWrapper.and((wrapper)-&gt;&#123;</span><br><span class="line">            wrapper.eq(<span class="string">&quot;sku_id&quot;</span>,key).or().like(<span class="string">&quot;sku_name&quot;</span>,key);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">catelogId</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;catelogId&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!StringUtils.isEmpty(catelogId)&amp;&amp;!<span class="string">&quot;0&quot;</span>.equalsIgnoreCase(catelogId))&#123;</span><br><span class="line"></span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;catalog_id&quot;</span>,catelogId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">brandId</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;brandId&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!StringUtils.isEmpty(brandId)&amp;&amp;!<span class="string">&quot;0&quot;</span>.equalsIgnoreCase(catelogId))&#123;</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;brand_id&quot;</span>,brandId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">min</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;min&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!StringUtils.isEmpty(min))&#123;</span><br><span class="line">        queryWrapper.ge(<span class="string">&quot;price&quot;</span>,min);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">max</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;max&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!StringUtils.isEmpty(max)  )&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="type">BigDecimal</span> <span class="variable">bigDecimal</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(max);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(bigDecimal.compareTo(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="string">&quot;0&quot;</span>))==<span class="number">1</span>)&#123;</span><br><span class="line">                queryWrapper.le(<span class="string">&quot;price&quot;</span>,max);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    IPage&lt;SkuInfoEntity&gt; page = <span class="built_in">this</span>.page(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Query</span>&lt;SkuInfoEntity&gt;().getPage(params),</span><br><span class="line">            queryWrapper</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageUtils</span>(page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="SPU规格维护"><a href="#SPU规格维护" class="headerlink" title="SPU规格维护"></a>SPU规格维护</h4><p>1.获取SPU规格接口编写</p>
<p>1.1 编写&#x2F;product&#x2F;attr&#x2F;base&#x2F;listforspu&#x2F;{spuId} </p>
<p>AttrController </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">ProductAttrValueService productAttrValueService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/base/listforspu/&#123;spuId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">baseAttrlistforspu</span><span class="params">(<span class="meta">@PathVariable(&quot;spuId&quot;)</span> Long spuId)</span>&#123;</span><br><span class="line">    List&lt;ProductAttrValueEntity&gt; entities = productAttrValueService.baseAttrlistforspu(spuId);</span><br><span class="line">    <span class="keyword">return</span> R.ok().put(<span class="string">&quot;data&quot;</span>,entities);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ProductAttrValueServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;ProductAttrValueEntity&gt; <span class="title function_">baseAttrlistforspu</span><span class="params">(Long spuId)</span> &#123;</span><br><span class="line">        List&lt;ProductAttrValueEntity&gt; entities = <span class="built_in">this</span>.baseMapper.selectList(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;ProductAttrValueEntity&gt;().eq(<span class="string">&quot;spu_id&quot;</span>, spuId));</span><br><span class="line">        <span class="keyword">return</span> entities;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>2.修改商品规格</p>
<p>2.1 编写 &#x2F;product&#x2F;attr&#x2F;update&#x2F;{spuId} 接口</p>
<p>AttrController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/update/&#123;spuId&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">updateSpuAttr</span><span class="params">(<span class="meta">@PathVariable(&quot;spuId&quot;)</span> Long spuId,</span></span><br><span class="line"><span class="params">                       <span class="meta">@RequestBody</span> List&lt;ProductAttrValueEntity&gt; entities)</span> &#123;</span><br><span class="line">    productAttrValueService.updateSpuAttr(spuId, entities);</span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ProductAttrValueServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(rollbackFor = RuntimeException.class)</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateSpuAttr</span><span class="params">(Long spuId, List&lt;ProductAttrValueEntity&gt; entities)</span> &#123;</span><br><span class="line">    <span class="comment">//1、删除这个spuId之前对应的所有属性</span></span><br><span class="line">    <span class="built_in">this</span>.baseMapper.delete(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;ProductAttrValueEntity&gt;().eq(<span class="string">&quot;spu_id&quot;</span>, spuId));</span><br><span class="line"></span><br><span class="line">    List&lt;ProductAttrValueEntity&gt; collect = entities.stream().map(item -&gt; &#123;</span><br><span class="line">        item.setSpuId(spuId);</span><br><span class="line">        <span class="keyword">return</span> item;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">    <span class="built_in">this</span>.saveBatch(collect);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="仓储服务"><a href="#仓储服务" class="headerlink" title="仓储服务"></a>仓储服务</h2><h3 id="仓库管理"><a href="#仓库管理" class="headerlink" title="仓库管理"></a>仓库管理</h3><h4 id="整合ware服务-amp-获取仓库列表"><a href="#整合ware服务-amp-获取仓库列表" class="headerlink" title="整合ware服务&amp;获取仓库列表"></a>整合ware服务&amp;获取仓库列表</h4><p>1.仓库管理页面查询</p>
<p>WareInfoServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> PageUtils <span class="title function_">queryPage</span><span class="params">(Map&lt;String, Object&gt; params)</span> &#123;</span><br><span class="line"></span><br><span class="line">        QueryWrapper&lt;WareInfoEntity&gt; wareInfoEntityQueryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty(key)) &#123;</span><br><span class="line">            wareInfoEntityQueryWrapper.eq(<span class="string">&quot;id&quot;</span>, key).or()</span><br><span class="line">                    .like(<span class="string">&quot;name&quot;</span>, key)</span><br><span class="line">                    .or().like(<span class="string">&quot;address&quot;</span>, key)</span><br><span class="line">                    .or().like(<span class="string">&quot;areacode&quot;</span>, key);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        IPage&lt;WareInfoEntity&gt; page = <span class="built_in">this</span>.page(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Query</span>&lt;WareInfoEntity&gt;().getPage(params),</span><br><span class="line">                wareInfoEntityQueryWrapper</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageUtils</span>(page);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="查询库存-amp-创建采购需求"><a href="#查询库存-amp-创建采购需求" class="headerlink" title="查询库存&amp;创建采购需求"></a>查询库存&amp;创建采购需求</h4><p>1.商品库存管理页面查询接口</p>
<p>修改 WareSkuServiceImpl 查询接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> PageUtils <span class="title function_">queryPage</span><span class="params">(Map&lt;String, Object&gt; params)</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * skuId: 1</span></span><br><span class="line"><span class="comment">     * wareId: 2</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    QueryWrapper&lt;WareSkuEntity&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    <span class="type">String</span> <span class="variable">skuId</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;skuId&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!StringUtils.isEmpty(skuId))&#123;</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;sku_id&quot;</span>,skuId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">wareId</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;wareId&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!StringUtils.isEmpty(wareId))&#123;</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;ware_id&quot;</span>,wareId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    IPage&lt;WareSkuEntity&gt; page = <span class="built_in">this</span>.page(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Query</span>&lt;WareSkuEntity&gt;().getPage(params),</span><br><span class="line">            queryWrapper</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageUtils</span>(page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.采购需求管理页面查询接口</p>
<p>修改 PurchaseDetailServiceImpl 查询方法 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> PageUtils <span class="title function_">queryPage</span><span class="params">(Map&lt;String, Object&gt; params)</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * status: 0,//状态</span></span><br><span class="line"><span class="comment">     *    wareId: 1,//仓库id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    QueryWrapper&lt;PurchaseDetailEntity&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;PurchaseDetailEntity&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!StringUtils.isEmpty(key))&#123;</span><br><span class="line">        <span class="comment">//purchase_id  sku_id</span></span><br><span class="line">        queryWrapper.and(w-&gt;&#123;</span><br><span class="line">            w.eq(<span class="string">&quot;purchase_id&quot;</span>,key).or().eq(<span class="string">&quot;sku_id&quot;</span>,key);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">status</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;status&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!StringUtils.isEmpty(status))&#123;</span><br><span class="line">        <span class="comment">//purchase_id  sku_id</span></span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;status&quot;</span>,status);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">wareId</span> <span class="operator">=</span> (String) params.get(<span class="string">&quot;wareId&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!StringUtils.isEmpty(wareId))&#123;</span><br><span class="line">        <span class="comment">//purchase_id  sku_id</span></span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;ware_id&quot;</span>,wareId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    IPage&lt;PurchaseDetailEntity&gt; page = <span class="built_in">this</span>.page(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Query</span>&lt;PurchaseDetailEntity&gt;().getPage(params),</span><br><span class="line">            queryWrapper</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageUtils</span>(page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="合并采购需求"><a href="#合并采购需求" class="headerlink" title="合并采购需求"></a>合并采购需求</h4><p>1.查询未领取得采购单</p>
<p>PurchaseController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/unreceive/list&quot;)</span></span><br><span class="line"><span class="comment">//@RequiresPermissions(&quot;ware:purchase:list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">unreceivelist</span><span class="params">(<span class="meta">@RequestParam</span> Map&lt;String, Object&gt; params)</span>&#123;</span><br><span class="line">    <span class="type">PageUtils</span> <span class="variable">page</span> <span class="operator">=</span> purchaseService.queryPageUnreceivePurchase(params);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.ok().put(<span class="string">&quot;page&quot;</span>, page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>PurchaseServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> PageUtils <span class="title function_">queryPageUnreceivePurchase</span><span class="params">(Map&lt;String, Object&gt; params)</span> &#123;</span><br><span class="line">    IPage&lt;PurchaseEntity&gt; page = <span class="built_in">this</span>.page(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Query</span>&lt;PurchaseEntity&gt;().getPage(params),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;PurchaseEntity&gt;().eq(<span class="string">&quot;status&quot;</span>,<span class="number">0</span>).or().eq(<span class="string">&quot;status&quot;</span>,<span class="number">1</span>)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageUtils</span>(page);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>2.合并采购单</p>
<p>2.1 Common 模块创建Ware模块枚举类WareConstant</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WareConstant</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span>  <span class="title class_">PurchaseStatusEnum</span>&#123;</span><br><span class="line">        CREATED(<span class="number">0</span>,<span class="string">&quot;新建&quot;</span>),ASSIGNED(<span class="number">1</span>,<span class="string">&quot;已分配&quot;</span>),</span><br><span class="line">        RECEIVE(<span class="number">2</span>,<span class="string">&quot;已领取&quot;</span>),FINISH(<span class="number">3</span>,<span class="string">&quot;已完成&quot;</span>),</span><br><span class="line">        HASERROR(<span class="number">4</span>,<span class="string">&quot;有异常&quot;</span>);</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> code;</span><br><span class="line">        <span class="keyword">private</span> String msg;</span><br><span class="line"></span><br><span class="line">        PurchaseStatusEnum(<span class="type">int</span> code,String msg)&#123;</span><br><span class="line">            <span class="built_in">this</span>.code = code;</span><br><span class="line">            <span class="built_in">this</span>.msg = msg;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> code;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getMsg</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> msg;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span>  <span class="title class_">PurchaseDetailStatusEnum</span>&#123;</span><br><span class="line">        CREATED(<span class="number">0</span>,<span class="string">&quot;新建&quot;</span>),ASSIGNED(<span class="number">1</span>,<span class="string">&quot;已分配&quot;</span>),</span><br><span class="line">        BUYING(<span class="number">2</span>,<span class="string">&quot;正在采购&quot;</span>),FINISH(<span class="number">3</span>,<span class="string">&quot;已完成&quot;</span>),</span><br><span class="line">        HASERROR(<span class="number">4</span>,<span class="string">&quot;采购失败&quot;</span>);</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> code;</span><br><span class="line">        <span class="keyword">private</span> String msg;</span><br><span class="line"></span><br><span class="line">        PurchaseDetailStatusEnum(<span class="type">int</span> code,String msg)&#123;</span><br><span class="line">            <span class="built_in">this</span>.code = code;</span><br><span class="line">            <span class="built_in">this</span>.msg = msg;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> code;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getMsg</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> msg;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.2 创建前端接收类MergeVo</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MergeVo</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> Long purchaseId; <span class="comment">//整单id</span></span><br><span class="line">   <span class="keyword">private</span> List&lt;Long&gt; items;<span class="comment">//[1,2,3,4] //合并项集合</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.3 PurchaseServiceImpl 添加合并接口逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">PurchaseDetailService detailService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Transactional(rollbackFor = RuntimeException.class)</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">mergePurchase</span><span class="params">(MergeVo mergeVo)</span> &#123;</span><br><span class="line">    <span class="type">Long</span> <span class="variable">purchaseId</span> <span class="operator">=</span> mergeVo.getPurchaseId();</span><br><span class="line">    <span class="keyword">if</span> (purchaseId == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">//1、新建一个</span></span><br><span class="line">        <span class="type">PurchaseEntity</span> <span class="variable">purchaseEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PurchaseEntity</span>();</span><br><span class="line"></span><br><span class="line">        purchaseEntity.setStatus(WareConstant.PurchaseStatusEnum.CREATED.getCode());</span><br><span class="line">        purchaseEntity.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        purchaseEntity.setUpdateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="built_in">this</span>.save(purchaseEntity);</span><br><span class="line">        purchaseId = purchaseEntity.getId();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    List&lt;Long&gt; items = mergeVo.getItems();</span><br><span class="line">    <span class="comment">// 确认采购单状态是0,1才可以合并</span></span><br><span class="line">    List&lt;Long&gt; itemsNew = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(items.size());</span><br><span class="line">    items.forEach(i -&gt; &#123;</span><br><span class="line">        <span class="type">PurchaseDetailEntity</span> <span class="variable">byId</span> <span class="operator">=</span> detailService.getById(i);</span><br><span class="line">        <span class="keyword">if</span> (byId.getStatus() == WareConstant.PurchaseDetailStatusEnum.CREATED.getCode() || byId.getStatus() == WareConstant.PurchaseDetailStatusEnum.ASSIGNED.getCode()) &#123;</span><br><span class="line">            itemsNew.add(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="type">Long</span> <span class="variable">finalPurchaseId</span> <span class="operator">=</span> purchaseId;</span><br><span class="line">    <span class="keyword">if</span> (itemsNew.size()==<span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    items = itemsNew;</span><br><span class="line">    List&lt;PurchaseDetailEntity&gt; collect = items.stream().map(i -&gt; &#123;</span><br><span class="line">        <span class="type">PurchaseDetailEntity</span> <span class="variable">detailEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PurchaseDetailEntity</span>();</span><br><span class="line"></span><br><span class="line">        detailEntity.setId(i);</span><br><span class="line">        detailEntity.setPurchaseId(finalPurchaseId);</span><br><span class="line">        detailEntity.setStatus(WareConstant.PurchaseDetailStatusEnum.ASSIGNED.getCode());</span><br><span class="line">        <span class="keyword">return</span> detailEntity;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">    detailService.updateBatchById(collect);</span><br><span class="line"></span><br><span class="line">    <span class="type">PurchaseEntity</span> <span class="variable">purchaseEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PurchaseEntity</span>();</span><br><span class="line">    purchaseEntity.setId(purchaseId);</span><br><span class="line">    purchaseEntity.setUpdateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    <span class="built_in">this</span>.updateById(purchaseEntity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.4 PurchaseController 增加接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/merge&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">merge</span><span class="params">(<span class="meta">@RequestBody</span> MergeVo mergeVo)</span>&#123;</span><br><span class="line">    purchaseService.mergePurchase(mergeVo);</span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="-1"><a href="#-1" class="headerlink" title=""></a></h4><h4 id="领取采购单"><a href="#领取采购单" class="headerlink" title="领取采购单"></a>领取采购单</h4><p>&#x2F;ware&#x2F;purchase&#x2F;received 接口 PurchaseController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 领取采购单</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/received&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R <span class="title function_">received</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;Long&gt; ids)</span>&#123;</span><br><span class="line">    purchaseService.received(ids);</span><br><span class="line">    <span class="keyword">return</span> R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编写领取逻辑 PurchaseServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ids 采购单id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">received</span><span class="params">(List&lt;Long&gt; ids)</span> &#123;</span><br><span class="line">    <span class="comment">//1、确认当前采购单是新建或者已分配状态</span></span><br><span class="line">    List&lt;PurchaseEntity&gt; collect = ids.stream().map(id -&gt; &#123;</span><br><span class="line">        <span class="type">PurchaseEntity</span> <span class="variable">byId</span> <span class="operator">=</span> <span class="built_in">this</span>.getById(id);</span><br><span class="line">        <span class="keyword">return</span> byId;</span><br><span class="line">    &#125;).filter(item -&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (item.getStatus() == WareConstant.PurchaseStatusEnum.CREATED.getCode() ||</span><br><span class="line">                item.getStatus() == WareConstant.PurchaseStatusEnum.ASSIGNED.getCode()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;).map(item-&gt;&#123;</span><br><span class="line">        item.setStatus(WareConstant.PurchaseStatusEnum.RECEIVE.getCode());</span><br><span class="line">        item.setUpdateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="keyword">return</span> item;</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2、改变采购单的状态</span></span><br><span class="line">    <span class="built_in">this</span>.updateBatchById(collect);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3、改变采购项的状态</span></span><br><span class="line">    collect.forEach((item)-&gt;&#123;</span><br><span class="line">        List&lt;PurchaseDetailEntity&gt; entities = detailService.listDetailByPurchaseId(item.getId());</span><br><span class="line">        List&lt;PurchaseDetailEntity&gt; detailEntities = entities.stream().map(entity -&gt; &#123;</span><br><span class="line">            <span class="type">PurchaseDetailEntity</span> <span class="variable">entity1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PurchaseDetailEntity</span>();</span><br><span class="line">            entity1.setId(entity.getId());</span><br><span class="line">            entity1.setStatus(WareConstant.PurchaseDetailStatusEnum.BUYING.getCode());</span><br><span class="line">            <span class="keyword">return</span> entity1;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line">        detailService.updateBatchById(detailEntities);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>PurchaseDetailService 根据puchaseId 查找数据接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;PurchaseDetailEntity&gt; <span class="title function_">listDetailByPurchaseId</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    List&lt;PurchaseDetailEntity&gt; purchaseId = <span class="built_in">this</span>.list(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;PurchaseDetailEntity&gt;().eq(<span class="string">&quot;purchase_id&quot;</span>, id));</span><br><span class="line">    <span class="keyword">return</span> purchaseId;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="完成采购"><a href="#完成采购" class="headerlink" title="完成采购"></a>完成采购</h4><p>1.新建两个接收前端信息的VO类 </p>
<p>PurchaseDoneVo</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PurchaseDoneVo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">private</span> Long id;<span class="comment">//采购单id</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;PurchaseItemDoneVo&gt; items;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>PurchaseItemDoneVo</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PurchaseItemDoneVo</span> &#123;</span><br><span class="line">    <span class="comment">//&#123;itemId:1,status:4,reason:&quot;&quot;&#125;</span></span><br><span class="line">    <span class="keyword">private</span> Long itemId;</span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line">    <span class="keyword">private</span> String reason;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>添加&#x2F;ware&#x2F;purchase&#x2F;done 完成采购单接口</p>
<p>PurchaseController</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@PostMapping(&quot;/done&quot;)</span><br><span class="line">public R finish(@RequestBody PurchaseDoneVo doneVo)&#123;</span><br><span class="line">    purchaseService.done(doneVo);</span><br><span class="line">    return R.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>业务逻辑</li>
</ol>
<p>PurchaseServiceImpl </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(rollbackFor = RuntimeException.class)</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">done</span><span class="params">(PurchaseDoneVo doneVo)</span> &#123;</span><br><span class="line">    <span class="type">Long</span> <span class="variable">id</span> <span class="operator">=</span> doneVo.getId();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2、改变采购项的状态</span></span><br><span class="line">    <span class="type">Boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    List&lt;PurchaseItemDoneVo&gt; items = doneVo.getItems();</span><br><span class="line"></span><br><span class="line">    List&lt;PurchaseDetailEntity&gt; updates = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (PurchaseItemDoneVo item : items) &#123;</span><br><span class="line">        <span class="type">PurchaseDetailEntity</span> <span class="variable">detailEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PurchaseDetailEntity</span>();</span><br><span class="line">        <span class="keyword">if</span> (item.getStatus() == WareConstant.PurchaseDetailStatusEnum.HASERROR.getCode()) &#123;</span><br><span class="line">            flag = <span class="literal">false</span>;</span><br><span class="line">            detailEntity.setStatus(item.getStatus());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            detailEntity.setStatus(WareConstant.PurchaseDetailStatusEnum.FINISH.getCode());</span><br><span class="line">            <span class="comment">////3、将成功采购的进行入库</span></span><br><span class="line">            <span class="type">PurchaseDetailEntity</span> <span class="variable">entity</span> <span class="operator">=</span> detailService.getById(item.getItemId());</span><br><span class="line">            wareSkuService.addStock(entity.getSkuId(), entity.getWareId(), entity.getSkuNum());</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        detailEntity.setId(item.getItemId());</span><br><span class="line">        updates.add(detailEntity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    detailService.updateBatchById(updates);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1、改变采购单状态</span></span><br><span class="line">    <span class="type">PurchaseEntity</span> <span class="variable">purchaseEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PurchaseEntity</span>();</span><br><span class="line">    purchaseEntity.setId(id);</span><br><span class="line">    purchaseEntity.setStatus(flag ? WareConstant.PurchaseStatusEnum.FINISH.getCode() :</span><br><span class="line">            WareConstant.PurchaseStatusEnum.HASERROR.getCode());</span><br><span class="line">    purchaseEntity.setUpdateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    <span class="built_in">this</span>.updateById(purchaseEntity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>WareSkuServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addStock</span><span class="params">(Long skuId, Long wareId, Integer skuNum)</span> &#123;</span><br><span class="line">    <span class="comment">//1、判断如果还没有这个库存记录新增</span></span><br><span class="line">    List&lt;WareSkuEntity&gt; entities = wareSkuDao.selectList(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;WareSkuEntity&gt;().eq(<span class="string">&quot;sku_id&quot;</span>, skuId).eq(<span class="string">&quot;ware_id&quot;</span>, wareId));</span><br><span class="line">    <span class="keyword">if</span>(entities == <span class="literal">null</span> || entities.size() == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="type">WareSkuEntity</span> <span class="variable">skuEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WareSkuEntity</span>();</span><br><span class="line">        skuEntity.setSkuId(skuId);</span><br><span class="line">        skuEntity.setStock(skuNum);</span><br><span class="line">        skuEntity.setWareId(wareId);</span><br><span class="line">        skuEntity.setStockLocked(<span class="number">0</span>);</span><br><span class="line">        wareSkuDao.insert(skuEntity);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        wareSkuDao.addStock(skuId,wareId,skuNum);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>WareSkuDao 添加方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">addStock</span><span class="params">(<span class="meta">@Param(&quot;skuId&quot;)</span> Long skuId, <span class="meta">@Param(&quot;wareId&quot;)</span> Long wareId, <span class="meta">@Param(&quot;skuNum&quot;)</span> Integer skuNum)</span>;</span><br></pre></td></tr></table></figure>

<p>WareSkuDao.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;addStock&quot;</span>&gt;</span></span><br><span class="line">    UPDATE `wms_ware_sku` SET stock=stock+#&#123;skuNum&#125; WHERE sku_id=#&#123;skuId&#125; AND ware_id=#&#123;wareId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>4.由于需要查询skuName ，需要调用Product模块的查询方法来获取</p>
<p>4.1 在feign包下新建 ProductFeignService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;supermall-product&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProductFeignService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *      /product/skuinfo/info/&#123;skuId&#125;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *   1)、让所有请求过网关；</span></span><br><span class="line"><span class="comment">     *          1、<span class="doctag">@FeignClient</span>(&quot;supermall-gateway&quot;)：给gulimall-gateway所在的机器发请求</span></span><br><span class="line"><span class="comment">     *          2、/api/product/skuinfo/info/&#123;skuId&#125;</span></span><br><span class="line"><span class="comment">     *   2）、直接让后台指定服务处理</span></span><br><span class="line"><span class="comment">     *          1、<span class="doctag">@FeignClient</span>(&quot;supermall-gateway&quot;)</span></span><br><span class="line"><span class="comment">     *          2、/product/skuinfo/info/&#123;skuId&#125;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/product/skuinfo/info/&#123;skuId&#125;&quot;)</span></span><br><span class="line">    R <span class="title function_">info</span><span class="params">(<span class="meta">@PathVariable(&quot;skuId&quot;)</span> Long skuId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.2 在启动类加入feign 开启注解</p>
<p>4.3 修改 WareSkuServiceImpl 逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ProductFeignService productFeignService;</span><br><span class="line">    </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addStock</span><span class="params">(Long skuId, Long wareId, Integer skuNum)</span> &#123;</span><br><span class="line">        <span class="comment">//1、判断如果还没有这个库存记录新增</span></span><br><span class="line">        List&lt;WareSkuEntity&gt; entities =</span><br><span class="line">                wareSkuDao.selectList(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;WareSkuEntity&gt;().eq(<span class="string">&quot;sku_id&quot;</span>, skuId).eq(<span class="string">&quot;ware_id&quot;</span>, wareId));</span><br><span class="line">        <span class="keyword">if</span> (entities == <span class="literal">null</span> || entities.size() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">WareSkuEntity</span> <span class="variable">skuEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WareSkuEntity</span>();</span><br><span class="line">            skuEntity.setSkuId(skuId);</span><br><span class="line">            skuEntity.setStock(skuNum);</span><br><span class="line">            skuEntity.setWareId(wareId);</span><br><span class="line">            skuEntity.setStockLocked(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//            //TODO 远程查询sku的名字，如果失败，整个事务无需回滚</span></span><br><span class="line"><span class="comment">//            //1、自己catch异常</span></span><br><span class="line"><span class="comment">//            //TODO 还可以用什么办法让异常出现以后不回滚？高级</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">R</span> <span class="variable">info</span> <span class="operator">=</span> productFeignService.info(skuId);</span><br><span class="line">                Map&lt;String,Object&gt; data = (Map&lt;String, Object&gt;) info.get(<span class="string">&quot;skuInfo&quot;</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(info.getCode() == <span class="number">0</span>)&#123;</span><br><span class="line">                    skuEntity.setSkuName((String) data.get(<span class="string">&quot;skuName&quot;</span>));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            wareSkuDao.insert(skuEntity);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            wareSkuDao.addStock(skuId, wareId, skuNum);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h1 id="分布式基础篇-总结"><a href="#分布式基础篇-总结" class="headerlink" title="分布式基础篇-总结"></a>分布式基础篇-总结</h1><ol>
<li>分布式基础概念</li>
</ol>
<p>微服务，注册中心，配置中心，远程调用，Feign的使用，网关</p>
<ol start="2">
<li>基础开发</li>
</ol>
<p>	</p>
<p>SpringBoot 2.0 ,SpringCloud，Mybatis-Plus，Vue组件化，阿里云对象存储</p>
<ol start="3">
<li>环境</li>
</ol>
<p>Vagrant &#x2F; VM，Linux，Docker，MySQL，Redis，逆向工程&amp;人人开源项目</p>
<ol start="4">
<li><p>开发规范</p>
<p>数据校验JSR303，全局异常处理，全局统一返回，全局跨域处理</p>
<p>枚举状态，业务状态码，VO与TO与PO的划分，逻辑删除</p>
<p>Lombok：@Data，@Slf4j</p>
</li>
</ol>

        </div>

        

        
            <ul class="post-tags-box">
                
                    <li class="tag-item">
                        <a href="/tags/SpringCloud-docker-vue/">#SpringCloud docker vue</a>&nbsp;
                    </li>
                
            </ul>
        

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                           rel="prev"
                           href="/2021/07/24/Docker%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BAZookeeper%E5%92%8Ckafka%E9%9B%86%E7%BE%A4/"
                        >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Docker快速搭建Zookeeper和kafka集群</span>
                                <span class="post-nav-item">上一篇</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/2020/06/24/Git%E6%8F%90%E4%BA%A4%E8%A7%84%E8%8C%83/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Git提交规范</span>
                                <span class="post-nav-item">下一篇</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
            <div class="comment-container">
                <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        <i class="fas fa-comments">&nbsp;评论</i>
    </div>
    

        
            
    <div class="valine-container">
        <script data-pjax
                src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script>
        <div id="vcomments"></div>
        <script data-pjax>
            function loadValine() {
                new Valine({
                    el: '#vcomments',
                    appId: 'NPvlU9qYYDAjLzhWKAVpcDt9-gzGzoHsz',
                    appKey: '9xsXsbHshMIXzFNYU9E9ANJB',
                    meta: ['nick', 'mail', 'link'],
                    avatar: 'wavatar',
                    enableQQ: true,
                    placeholder: '',
                    lang: 'zh-CN'.toLowerCase()
                });

                function getAuthor(language) {
                    switch (language) {
                        case 'en':
                            return 'Author';
                        case 'zh-CN':
                            return '博主';
                        default:
                            return 'Master';
                    }
                }

                // Add "Author" identify
                const getValineDomTimer = setInterval(() => {
                    const vcards = document.querySelectorAll('#vcomments .vcards .vcard');
                    if (vcards.length > 0) {
                        let author = 'center-sept';

                        if (author) {
                            for (let vcard of vcards) {
                                const vnick_dom = vcard.querySelector('.vhead .vnick');
                                const vnick = vnick_dom.innerHTML;
                                if (vnick === author) {
                                    vnick_dom.innerHTML = `${vnick} <span class="author">${getAuthor(KEEP.hexo_config.language)}</span>`
                                }
                            }
                        }
                        clearInterval(getValineDomTimer);
                    } else {
                        clearInterval(getValineDomTimer);
                    }
                }, 2000);
            }

            if ('true') {
                const loadValineTimeout = setTimeout(() => {
                    loadValine();
                    clearTimeout(loadValineTimeout);
                }, 1000);
            } else {
                window.addEventListener('DOMContentLoaded', loadValine);
            }
        </script>
    </div>



        
    
</div>

            </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2018</span>
              -
            
            2023&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">center-sept</a>
        </div>
        
            <script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        访问人数&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
                    <span id="busuanzi_container_site_pv">
                        总访问量&nbsp;<span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            由 <a target="_blank" href="https://hexo.io">Hexo</a> 驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.5</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fas fa-comment"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        
            <li class="tools-item rss flex-center">
                <a class="flex-center"
                   href="/atom.xml"
                   target="_blank"
                >
                    <i class="fas fa-rss"></i>
                </a>
            </li>
        

        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#docker%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="nav-number">1.</span> <span class="nav-text">docker环境搭建</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#docker-%E9%80%9A%E7%94%A8%E5%91%BD%E4%BB%A4%E9%9B%86"><span class="nav-number">1.1.</span> <span class="nav-text">docker 通用命令集</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#docker-%E5%AE%89%E8%A3%85-mysql"><span class="nav-number">1.2.</span> <span class="nav-text">docker 安装 mysql</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#docker-%E5%AE%89%E8%A3%85%E4%BB%A5%E5%8F%8A%E6%93%8D%E4%BD%9C-redis"><span class="nav-number">1.3.</span> <span class="nav-text">docker 安装以及操作 redis</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Maven"><span class="nav-number">2.</span> <span class="nav-text">Maven</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IDEA-amp-VSCode"><span class="nav-number">3.</span> <span class="nav-text">IDEA &amp; VSCode</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#idea-%E9%85%8D%E7%BD%AE-%EF%BC%88%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%EF%BC%89"><span class="nav-number">3.1.</span> <span class="nav-text">idea 配置 （后端开发工具）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#VSCode-%E9%85%8D%E7%BD%AE-%EF%BC%88%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%EF%BC%89"><span class="nav-number">3.2.</span> <span class="nav-text">VSCode 配置 （前端开发工具）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E6%8F%92%E4%BB%B6"><span class="nav-number">3.2.1.</span> <span class="nav-text">安装插件</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AEgit-ssh"><span class="nav-number">4.</span> <span class="nav-text">配置git-ssh</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#idea-%E6%90%AD%E5%BB%BA-%E5%90%8E%E7%AB%AF%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%E7%8E%AF%E5%A2%83"><span class="nav-number">5.</span> <span class="nav-text">idea 搭建 后端服务项目环境</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5%E7%A0%81%E4%BA%91%E4%B8%8A%E7%9A%84%E9%A1%B9%E7%9B%AE"><span class="nav-number">5.1.</span> <span class="nav-text">导入码云上的项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%8A%E6%96%B0%E5%BB%BA%E7%9B%B8%E5%BA%94%E7%9A%84%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE"><span class="nav-number">5.2.</span> <span class="nav-text">在项目上新建相应的微服务项目</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A8%A1%E5%9D%97"><span class="nav-number">5.2.1.</span> <span class="nav-text">创建微服务模块</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%96%E8%BE%91-gitignore"><span class="nav-number">5.2.2.</span> <span class="nav-text">编辑.gitignore</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93-%E6%90%AD%E5%BB%BA%E9%85%8D%E7%BD%AE"><span class="nav-number">5.3.</span> <span class="nav-text">数据库 搭建配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%90%AD%E5%BB%BA%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F"><span class="nav-number">5.4.</span> <span class="nav-text">搭建后台管理系统</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%BA%E4%BA%BA%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE"><span class="nav-number">5.4.1.</span> <span class="nav-text">人人开源项目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%95%E5%85%A5%E5%90%8E%E5%8F%B0%E9%A1%B9%E7%9B%AE%E4%B8%AD"><span class="nav-number">5.4.2.</span> <span class="nav-text">引入后台项目中</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE"><span class="nav-number">5.4.3.</span> <span class="nav-text">构建前端项目</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B3%A8%EF%BC%9Anode-sass-%E5%AE%89%E8%A3%85%E6%8A%A5%E9%94%99"><span class="nav-number">5.4.3.1.</span> <span class="nav-text">注：node-sass 安装报错</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%90%AD%E5%BB%BA-amp-%E4%BD%BF%E7%94%A8"><span class="nav-number">5.5.</span> <span class="nav-text">逆向工程搭建&amp;使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-amp-%E6%B5%8B%E8%AF%95%E6%A8%A1%E5%9D%97%E7%9A%84CRUD"><span class="nav-number">5.6.</span> <span class="nav-text">配置&amp;测试模块的CRUD</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE"><span class="nav-number">5.6.1.</span> <span class="nav-text">配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E6%98%AF%E5%90%A6%E8%83%BDcrud"><span class="nav-number">5.6.2.</span> <span class="nav-text">测试是否能crud</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E7%94%9F%E6%88%90%E5%85%A8%E9%83%A8%E6%A8%A1%E5%9D%97%E7%9A%84%E4%B8%9A%E5%8A%A1%E4%BB%A3%E7%A0%81"><span class="nav-number">5.7.</span> <span class="nav-text">逆向工程生成全部模块的业务代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E7%BB%84%E4%BB%B6"><span class="nav-number">6.</span> <span class="nav-text">分布式组件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring-cloud-netflix"><span class="nav-number">6.1.</span> <span class="nav-text">Spring-cloud-netflix</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring-cloud-alibaba-%E5%88%86%E5%B8%83%E5%BC%8F%E6%A1%86%E6%9E%B6%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-number">6.2.</span> <span class="nav-text">Spring-cloud-alibaba 分布式框架解决方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%95%E5%85%A5%E5%88%86%E5%B8%83%E5%BC%8F%E6%A1%86%E6%9E%B6Spring-cloud-alibaba"><span class="nav-number">6.3.</span> <span class="nav-text">引入分布式框架Spring-cloud-alibaba</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Nacos-%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83"><span class="nav-number">6.3.1.</span> <span class="nav-text">Nacos 注册中心</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#2-Nacos-server-%E9%85%8D%E7%BD%AE"><span class="nav-number">6.3.1.1.</span> <span class="nav-text">2.Nacos server 配置</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Nacos%E6%9C%8D%E5%8A%A1%E4%B8%AD%E5%BF%83-%E9%83%A8%E7%BD%B2%E5%88%B0-docker"><span class="nav-number">6.3.1.2.</span> <span class="nav-text">Nacos服务中心 部署到 docker</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#OpenFeigh-%E6%B5%8B%E8%AF%95%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8"><span class="nav-number">6.3.2.</span> <span class="nav-text">OpenFeigh 测试远程调用</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8E%9F%E7%90%86"><span class="nav-number">6.3.2.1.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8"><span class="nav-number">6.3.2.2.</span> <span class="nav-text">使用</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Nacos-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83"><span class="nav-number">6.3.3.</span> <span class="nav-text">Nacos 配置中心</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E9%85%8D%E7%BD%AE%E5%AE%9E%E4%BE%8B"><span class="nav-number">6.3.3.1.</span> <span class="nav-text">简单配置实例</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E4%B8%8E%E9%85%8D%E7%BD%AE%E5%88%86%E7%BB%84"><span class="nav-number">6.3.3.2.</span> <span class="nav-text">命名空间与配置分组</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4"><span class="nav-number">6.3.3.2.1.</span> <span class="nav-text">配置命名空间</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8A%A0%E8%BD%BD%E5%A4%9A%E9%85%8D%E7%BD%AE%E6%BA%90"><span class="nav-number">6.3.3.3.</span> <span class="nav-text">加载多配置源</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SpringCloud-Gateway-%E7%BD%91%E5%85%B3"><span class="nav-number">6.3.4.</span> <span class="nav-text">SpringCloud-Gateway 网关</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80"><span class="nav-number">7.</span> <span class="nav-text">前端基础</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8A%80%E6%9C%AF%E6%A0%88%E7%AE%80%E4%BB%8B"><span class="nav-number">7.1.</span> <span class="nav-text">技术栈简介</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ES6-%E8%AF%AD%E6%B3%95"><span class="nav-number">7.1.1.</span> <span class="nav-text">ES6 语法</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80-1"><span class="nav-number">7.1.1.1.</span> <span class="nav-text">前端基础</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#vue"><span class="nav-number">7.1.2.</span> <span class="nav-text">vue</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#MVVM"><span class="nav-number">7.1.2.1.</span> <span class="nav-text">MVVM</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#nodejs"><span class="nav-number">7.1.3.</span> <span class="nav-text">nodejs</span></a></li><li class="nav-item nav-level-4"><a class="nav-link"><span class="nav-number">7.1.4.</span> <span class="nav-text"></span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AF%E6%A8%A1%E5%9D%97"><span class="nav-number">8.</span> <span class="nav-text">开始搭建前端模块</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Vue%E6%A8%A1%E5%9D%97%E5%8C%96%E5%BC%80%E5%8F%91"><span class="nav-number">8.1.</span> <span class="nav-text">Vue模块化开发</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%90%AD%E5%BB%BAVue%E8%84%9A%E6%89%8B%E6%9E%B6"><span class="nav-number">8.1.1.</span> <span class="nav-text">搭建Vue脚手架</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%BB%84%E4%BB%B6"><span class="nav-number">8.1.2.</span> <span class="nav-text">创建一个组件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%95%E7%94%A8ElementUI"><span class="nav-number">8.1.3.</span> <span class="nav-text">引用ElementUI</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96"><span class="nav-number">8.1.3.1.</span> <span class="nav-text">安装依赖</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="nav-number">8.1.3.2.</span> <span class="nav-text">引入依赖</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8elementUI-%E6%8F%90%E4%BE%9B%E7%9A%84%E5%B8%83%E5%B1%80%E4%BB%A5%E5%8F%8A%E9%85%8D%E7%BD%AE%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1%E8%8F%9C%E5%8D%95"><span class="nav-number">8.2.</span> <span class="nav-text">使用elementUI 提供的布局以及配置动态路由菜单</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#VSCode-%E5%8A%A0%E5%85%A5vue%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5"><span class="nav-number">8.3.</span> <span class="nav-text">VSCode,加入vue代码片段</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%95%86%E5%93%81%E6%9C%8D%E5%8A%A1"><span class="nav-number">9.</span> <span class="nav-text">商品服务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89%E7%BA%A7%E5%88%86%E7%B1%BB"><span class="nav-number">9.1.</span> <span class="nav-text">三级分类</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E6%A0%91%E5%BD%A2%E5%B1%95%E7%A4%BA%E4%B8%89%E7%BA%A7%E5%88%86%E7%B1%BB%E6%95%B0%E6%8D%AE"><span class="nav-number">9.1.1.</span> <span class="nav-text">查询树形展示三级分类数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E7%BD%91%E5%85%B3%E8%B7%AF%E7%94%B1%E4%B8%8E%E8%B7%AF%E5%BE%84%E9%87%8D%E5%86%99%E5%92%8C%E7%BD%91%E5%85%B3%E7%BB%9F%E4%B8%80%E9%85%8D%E7%BD%AE%E8%B7%A8%E5%9F%9F"><span class="nav-number">9.1.2.</span> <span class="nav-text">配置网关路由与路径重写和网关统一配置跨域</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%91%E5%9E%8B%E5%B1%95%E7%A4%BA%E4%B8%89%E7%BA%A7%E5%88%86%E7%B1%BB%E6%95%B0%E6%8D%AE"><span class="nav-number">9.1.3.</span> <span class="nav-text">树型展示三级分类数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A1%B5%E9%9D%A2%E6%95%88%E6%9E%9C"><span class="nav-number">9.1.4.</span> <span class="nav-text">页面效果</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%BB%E8%BE%91%E5%88%A0%E9%99%A4"><span class="nav-number">9.1.5.</span> <span class="nav-text">逻辑删除</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E6%95%88%E6%9E%9C%E7%BB%86%E5%8C%96"><span class="nav-number">9.1.6.</span> <span class="nav-text">删除效果细化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%B0%E5%A2%9E%E6%95%88%E6%9E%9C%E5%AE%8C%E6%88%90"><span class="nav-number">9.1.7.</span> <span class="nav-text">新增效果完成</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E4%BF%AE%E6%94%B9%E6%95%88%E6%9E%9C%E5%AE%8C%E6%88%90"><span class="nav-number">9.1.8.</span> <span class="nav-text">基本修改效果完成</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8B%96%E6%8B%BD%E6%95%88%E6%9E%9C"><span class="nav-number">9.1.9.</span> <span class="nav-text">拖拽效果</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8B%96%E6%8B%BD%E6%95%B0%E6%8D%AE%E6%94%B6%E9%9B%86"><span class="nav-number">9.1.10.</span> <span class="nav-text">拖拽数据收集</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8B%96%E6%8B%BD%E5%8A%9F%E8%83%BD%E5%AE%8C%E6%88%90"><span class="nav-number">9.1.11.</span> <span class="nav-text">拖拽功能完成</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%80%E7%BB%88%E8%8F%9C%E5%8D%95%E9%A1%B5%E9%9D%A2%E5%AE%8C%E6%88%90%E4%BB%A3%E7%A0%81%E6%95%88%E6%9E%9C"><span class="nav-number">9.1.12.</span> <span class="nav-text">最终菜单页面完成代码效果</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%93%81%E7%89%8C%E7%AE%A1%E7%90%86"><span class="nav-number">9.2.</span> <span class="nav-text">品牌管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E7%9A%84%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81"><span class="nav-number">9.2.1.</span> <span class="nav-text">使用逆向工程的前后端代码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%88%E6%9E%9C%E4%BC%98%E5%8C%96%E4%B8%8E%E5%BF%AB%E9%80%9F%E6%98%BE%E7%A4%BA%E5%BC%80%E5%85%B3"><span class="nav-number">9.2.2.</span> <span class="nav-text">效果优化与快速显示开关</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%B3%E9%97%ADESLint-%E8%AF%AD%E6%B3%95%E6%A3%80%E6%9F%A5"><span class="nav-number">9.2.2.1.</span> <span class="nav-text">关闭ESLint 语法检查</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%91%E5%AD%98%E5%82%A8%E5%BC%80%E9%80%9A%E4%B8%8E%E4%BD%BF%E7%94%A8"><span class="nav-number">9.2.3.</span> <span class="nav-text">云存储开通与使用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#OSS-%E6%95%B4%E5%90%88%E6%B5%8B%E8%AF%95"><span class="nav-number">9.2.4.</span> <span class="nav-text">OSS 整合测试</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%99%AE%E9%80%9AMaven%E9%A1%B9%E7%9B%AE%E5%BC%95%E5%85%A5"><span class="nav-number">9.2.4.1.</span> <span class="nav-text">普通Maven项目引入</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#SpringCloud-Alibaba-OSS-%E5%BC%95%E5%85%A5"><span class="nav-number">9.2.4.2.</span> <span class="nav-text">SpringCloud Alibaba OSS 引入</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#OSS-%E8%8E%B7%E5%8F%96%E6%9C%8D%E5%8A%A1%E7%AB%AF%E7%AD%BE%E5%90%8D"><span class="nav-number">9.2.5.</span> <span class="nav-text">OSS 获取服务端签名</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#OSS-%E5%89%8D%E5%90%8E%E8%81%94%E8%B0%83%E6%B5%8B%E8%AF%95%E4%B8%8A%E4%BC%A0"><span class="nav-number">9.2.6.</span> <span class="nav-text">OSS 前后联调测试上传</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A1%A8%E5%8D%95%E6%A0%A1%E9%AA%8C-amp-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%A1%E9%AA%8C%E5%99%A8"><span class="nav-number">9.2.7.</span> <span class="nav-text">表单校验&amp;自定义校验器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#JSR303%E8%A1%A8%E5%8D%95%E9%AA%8C%E8%AF%81"><span class="nav-number">9.2.8.</span> <span class="nav-text">JSR303表单验证</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%9F%E4%B8%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="nav-number">9.2.9.</span> <span class="nav-text">统一异常处理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#JSR303%E5%88%86%E7%BB%84%E6%A0%A1%E9%AA%8C"><span class="nav-number">9.2.10.</span> <span class="nav-text">JSR303分组校验</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#JSR303%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%A1%E9%AA%8C%E6%B3%A8%E8%A7%A3"><span class="nav-number">9.2.11.</span> <span class="nav-text">JSR303自定义校验注解</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SPU-amp-SKU-amp-%E8%A7%84%E6%A0%BC%E5%8F%82%E6%95%B0-amp-%E9%94%80%E5%94%AE%E5%B1%9E%E6%80%A7"><span class="nav-number">9.2.12.</span> <span class="nav-text">SPU&amp;SKU&amp;规格参数&amp;销售属性</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B1%9E%E6%80%A7%E5%88%86%E7%BB%84"><span class="nav-number">9.3.</span> <span class="nav-text">属性分组</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%89%8D%E7%AB%AF%E7%BB%84%E4%BB%B6%E6%8A%BD%E5%8F%96-amp-%E7%88%B6%E5%AD%90%E7%BB%84%E4%BB%B6%E4%BA%A4%E4%BA%92"><span class="nav-number">9.3.1.</span> <span class="nav-text">前端组件抽取&amp;父子组件交互</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E5%88%86%E7%B1%BB%E5%B1%9E%E6%80%A7%E5%88%86%E7%BB%84"><span class="nav-number">9.3.2.</span> <span class="nav-text">获取分类属性分组</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E7%BB%84%E6%96%B0%E5%A2%9E-amp-%E7%BA%A7%E8%81%94%E9%80%89%E6%8B%A9%E5%99%A8"><span class="nav-number">9.3.3.</span> <span class="nav-text">分组新增&amp;级联选择器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E7%BB%84%E4%BF%AE%E6%94%B9-amp-%E7%BA%A7%E8%81%94%E9%80%89%E6%8B%A9%E5%99%A8%E5%9B%9E%E6%98%BE"><span class="nav-number">9.3.4.</span> <span class="nav-text">分组修改&amp;级联选择器回显</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%93%81%E7%89%8C%E5%88%86%E7%B1%BB%E5%85%B3%E8%81%94%E4%B8%8E%E7%BA%A7%E8%81%94%E6%9B%B4%E6%96%B0"><span class="nav-number">9.3.5.</span> <span class="nav-text">品牌分类关联与级联更新</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B9%B3%E5%8F%B0%E5%B1%9E%E6%80%A7"><span class="nav-number">9.4.</span> <span class="nav-text">平台属性</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%84%E6%A0%BC%E5%8F%82%E6%95%B0%E6%96%B0%E5%A2%9E%E4%B8%8EVO"><span class="nav-number">9.4.1.</span> <span class="nav-text">规格参数新增与VO</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%84%E6%A0%BC%E5%8F%82%E6%95%B0%E5%88%97%E8%A1%A8"><span class="nav-number">9.4.2.</span> <span class="nav-text">规格参数列表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%84%E6%A0%BC%E4%BF%AE%E6%94%B9"><span class="nav-number">9.4.3.</span> <span class="nav-text">规格修改</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%94%80%E5%94%AE%E5%B1%9E%E6%80%A7%E7%BB%B4%E6%8A%A4"><span class="nav-number">9.4.4.</span> <span class="nav-text">销售属性维护</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E5%88%86%E7%BB%84%E5%85%B3%E8%81%94%E5%B1%9E%E6%80%A7-amp-%E5%88%A0%E9%99%A4%E5%85%B3%E8%81%94"><span class="nav-number">9.4.5.</span> <span class="nav-text">查询分组关联属性&amp;删除关联</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E5%88%86%E7%BB%84%E6%9C%AA%E5%85%B3%E8%81%94%E5%B1%9E%E6%80%A7"><span class="nav-number">9.4.6.</span> <span class="nav-text">查询分组未关联属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%B0%E5%A2%9E%E5%88%86%E7%BB%84%E4%B8%8E%E5%B1%9E%E6%80%A7%E5%85%B3%E8%81%94"><span class="nav-number">9.4.7.</span> <span class="nav-text">新增分组与属性关联</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B0%E5%A2%9E%E5%95%86%E5%93%81"><span class="nav-number">9.5.</span> <span class="nav-text">新增商品</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B0%83%E8%AF%95%E4%BC%9A%E5%91%98%E7%AD%89%E7%BA%A7%E7%9B%B8%E5%85%B3%E6%8E%A5%E5%8F%A3"><span class="nav-number">9.5.1.</span> <span class="nav-text">调试会员等级相关接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E5%88%86%E7%B1%BB%E5%85%B3%E8%81%94%E7%9A%84%E5%93%81%E7%89%8C"><span class="nav-number">9.5.2.</span> <span class="nav-text">获取分类关联的品牌</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E5%88%86%E7%B1%BB%E4%B8%8B%E6%89%80%E6%9C%89%E5%88%86%E7%BB%84%E4%BB%A5%E5%8F%8A%E5%B1%9E%E6%80%A7"><span class="nav-number">9.5.3.</span> <span class="nav-text">获取分类下所有分组以及属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%95%86%E5%93%81%E6%96%B0%E5%A2%9EVO%E6%8A%BD%E5%8F%96"><span class="nav-number">9.5.4.</span> <span class="nav-text">商品新增VO抽取</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%95%86%E5%93%81%E6%96%B0%E5%A2%9E%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90"><span class="nav-number">9.5.5.</span> <span class="nav-text">商品新增业务流程分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BF%9D%E5%AD%98SPU%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF"><span class="nav-number">9.5.6.</span> <span class="nav-text">保存SPU基本信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BF%9D%E5%AD%98SKU%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF"><span class="nav-number">9.5.7.</span> <span class="nav-text">保存SKU基本信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B0%83%E7%94%A8%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1%E4%BF%9D%E5%AD%98%E4%BC%98%E6%83%A0%E7%AD%89%E4%BF%A1%E6%81%AF"><span class="nav-number">9.5.8.</span> <span class="nav-text">调用远程服务保存优惠等信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%95%86%E5%93%81%E4%BF%9D%E5%AD%98debug%E5%AE%8C%E6%88%90"><span class="nav-number">9.5.9.</span> <span class="nav-text">商品保存debug完成</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%95%86%E5%93%81%E4%BF%9D%E5%AD%98%E5%85%B6%E4%BB%96%E9%97%AE%E9%A2%98"><span class="nav-number">9.5.10.</span> <span class="nav-text">商品保存其他问题</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86"><span class="nav-number">9.6.</span> <span class="nav-text">商品管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#SPU%E6%A3%80%E7%B4%A2"><span class="nav-number">9.6.1.</span> <span class="nav-text">SPU检索</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SKU%E6%A3%80%E7%B4%A2"><span class="nav-number">9.6.2.</span> <span class="nav-text">SKU检索</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SPU%E8%A7%84%E6%A0%BC%E7%BB%B4%E6%8A%A4"><span class="nav-number">9.6.3.</span> <span class="nav-text">SPU规格维护</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%93%E5%82%A8%E6%9C%8D%E5%8A%A1"><span class="nav-number">10.</span> <span class="nav-text">仓储服务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%93%E5%BA%93%E7%AE%A1%E7%90%86"><span class="nav-number">10.1.</span> <span class="nav-text">仓库管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B4%E5%90%88ware%E6%9C%8D%E5%8A%A1-amp-%E8%8E%B7%E5%8F%96%E4%BB%93%E5%BA%93%E5%88%97%E8%A1%A8"><span class="nav-number">10.1.1.</span> <span class="nav-text">整合ware服务&amp;获取仓库列表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E5%BA%93%E5%AD%98-amp-%E5%88%9B%E5%BB%BA%E9%87%87%E8%B4%AD%E9%9C%80%E6%B1%82"><span class="nav-number">10.1.2.</span> <span class="nav-text">查询库存&amp;创建采购需求</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%88%E5%B9%B6%E9%87%87%E8%B4%AD%E9%9C%80%E6%B1%82"><span class="nav-number">10.1.3.</span> <span class="nav-text">合并采购需求</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#-1"><span class="nav-number">10.1.4.</span> <span class="nav-text"></span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A2%86%E5%8F%96%E9%87%87%E8%B4%AD%E5%8D%95"><span class="nav-number">10.1.5.</span> <span class="nav-text">领取采购单</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%8C%E6%88%90%E9%87%87%E8%B4%AD"><span class="nav-number">10.1.6.</span> <span class="nav-text">完成采购</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E5%9F%BA%E7%A1%80%E7%AF%87-%E6%80%BB%E7%BB%93"><span class="nav-number"></span> <span class="nav-text">分布式基础篇-总结</span></a>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>



<script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/dark-light-toggle.js"></script>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/local-search.js"></script>





    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/lazyload.js"></script>


<div class="post-scripts pjax">
    
        <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/left-side-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/libs/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/toc.js"></script>
    
</div>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.5/source/js/libs/pjax.min.js"></script>
<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>



</body>
</html>
